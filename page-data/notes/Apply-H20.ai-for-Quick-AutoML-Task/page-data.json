{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/Apply-H20.ai-for-Quick-AutoML-Task",
    "result": {"data":{"markdownRemark":{"html":"<p>AutoML is a process that you feed data into a machine, then it will automatically run a series of machine learning, and pick the best model for you. Still you need to do feature engineering, but it saves a lot of time for model establish, cross validation, testing .etc</p>\n<p>Since in my work, I constantly need to build machine learning models for classification or prediction, I want to write down a quick post here for using <a href=\"https://docs.h2o.ai/h2o/latest-stable/h2o-docs/welcome.html\">H2O.ai for AutoML</a> R package. Thus in the future I can quickly apply it to various scenarios. Basically, I followed <a href=\"https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html#\">this tutorial</a>.</p>\n<h2>1. Prepare Data</h2>\n<p>This step normally includes data cleaning, organise all data into a matrix. Below is my example, I have a <code class=\"language-text\">mlDF</code> data.frame, with rows are features, in my case a CpG, and columns as samples. Here I have done some feature engineering, like select most informative CpGs across whole genome.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>mlDF<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">1993</span>  <span class=\"token number\">216</span>\n<span class=\"token operator\">></span> mlDF<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n                    S0008     S0011     S0012     S0013     S0014\nchr12_617678    <span class=\"token number\">0.3750000</span> <span class=\"token number\">0.5686275</span> <span class=\"token number\">0.8500000</span> <span class=\"token number\">0.8026316</span> <span class=\"token number\">0.7200000</span>\nchr7_149415251  <span class=\"token number\">0.2000000</span> <span class=\"token number\">0.6231884</span> <span class=\"token number\">0.7631579</span> <span class=\"token number\">0.7887324</span> <span class=\"token number\">0.8600000</span>\nchr12_113478838 <span class=\"token number\">0.1714286</span> <span class=\"token number\">0.6938776</span> <span class=\"token number\">0.8500000</span> <span class=\"token number\">0.6756757</span> <span class=\"token number\">0.4035088</span>\nchr12_114736100 <span class=\"token number\">0.1159420</span> <span class=\"token number\">0.6455696</span> <span class=\"token number\">0.5731707</span> <span class=\"token number\">0.6363636</span> <span class=\"token number\">0.5609756</span>\nchr4_173501213  <span class=\"token number\">0.1363636</span> <span class=\"token number\">0.6216216</span> <span class=\"token number\">0.5333333</span> <span class=\"token number\">0.6310680</span> <span class=\"token number\">0.6444444</span>\n<span class=\"token operator\">></span></code></pre></div>\n<blockquote>\n<p>In my case, all rows are in same data distribution and have the same biolgical mearnings. Thus, I am not sure if we have multiple features from various sources, like Gender, Income, Race .etc, how to normalisaed them into a data.frame. This worth to look into.</p>\n</blockquote>\n<p>Also, I have a quite simple PD (patient data) object:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> head<span class=\"token punctuation\">(</span>mlPD<span class=\"token punctuation\">)</span>\n         ID    MLPheno\nS0008 S0008 Metastasis\nS0011 S0011 Metastasis\nS0012 S0012 Metastasis\nS0013 S0013 Metastasis\nS0014 S0014 Metastasis\nS0015 S0015 Metastasis</code></pre></div>\n<p><strong>Then, I merge them into one data.frame. A data frame contains both features and labels.</strong> After merging, each row is one sample, and each column is one feature (or label).</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">dfForH2O <span class=\"token operator\">&lt;-</span> data.frame<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">(</span>mlDF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Label\"</span><span class=\"token operator\">=</span>mlPD<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MLPheno\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># This MUST be data frame, Matrix will trigger error later.</span></code></pre></div>\n<p>This is my starting point. In the future, no matter what autoML task I met, I just need to prepare two data.frame like this.</p>\n<h2>2. AutoML Training</h2>\n<p>R package <code class=\"language-text\">h2o</code> can be very easily installed via command <code class=\"language-text\">install.package(\"h2o\")</code>.</p>\n<p>Then I can load and start to use it. The <code class=\"language-text\">h2o.init()</code> function will automatically connect to the H2O cluster I have previously download and started.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"h2o\"</span><span class=\"token punctuation\">)</span>\nh2o.init<span class=\"token punctuation\">(</span>max_mem_size <span class=\"token operator\">=</span> <span class=\"token string\">\"150G\"</span><span class=\"token punctuation\">)</span>\nh2o.clusterStatus<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then, I need to conver data.frame into H2O format. There seems many ways to do it. The one I am using is:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">all_data <span class=\"token operator\">&lt;-</span> as.h2o<span class=\"token punctuation\">(</span>dfForH2O<span class=\"token punctuation\">)</span>\nall_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Label\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;-</span> as.factor<span class=\"token punctuation\">(</span>all_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Label\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># For classification purpose, change it to factor.</span></code></pre></div>\n<p>Then, I split it into 80% vs 20%.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">data_split <span class=\"token operator\">&lt;-</span> h2o.splitFrame<span class=\"token punctuation\">(</span>all_data<span class=\"token punctuation\">,</span> ratios <span class=\"token operator\">=</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span>\ntrainData <span class=\"token operator\">&lt;-</span> data_split<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\ntestData <span class=\"token operator\">&lt;-</span> data_split<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Then, run training data. Here I specify to estimate 20 models, and maxium run for 5 mins.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">y <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"Label\"</span>\nx <span class=\"token operator\">&lt;-</span> setdiff<span class=\"token punctuation\">(</span>colnames<span class=\"token punctuation\">(</span>all_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Label\"</span><span class=\"token punctuation\">)</span>\naml <span class=\"token operator\">&lt;-</span> h2o.automl<span class=\"token punctuation\">(</span>x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> y<span class=\"token punctuation\">,</span> training_frame <span class=\"token operator\">=</span> trainData<span class=\"token punctuation\">,</span> max_models <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> seed <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> max_runtime_secs <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token operator\">*</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>3. Check Training Result</h2>\n<p>After training, we can collect some results.</p>\n<p><strong>Leader Board</strong> is the most important result, which shows us which model return best performance. In below result, it shows \"GLM_1_AutoML_9_20220818_02649\" model shows best.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> <span class=\"token comment\"># View the AutoML Leaderboard</span>\n<span class=\"token operator\">></span> lb <span class=\"token operator\">&lt;-</span> aml<span class=\"token operator\">@</span>leaderboard\n<span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>lb<span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">|</span>model_id                                            <span class=\"token operator\">|</span>       auc<span class=\"token operator\">|</span>   logloss<span class=\"token operator\">|</span>     aucpr<span class=\"token operator\">|</span> mean_per_class_error<span class=\"token operator\">|</span>      rmse<span class=\"token operator\">|</span>       mse<span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">:</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GLM_1_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.8916667</span><span class=\"token operator\">|</span> <span class=\"token number\">0.3746547</span><span class=\"token operator\">|</span> <span class=\"token number\">0.9507870</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.1737179</span><span class=\"token operator\">|</span> <span class=\"token number\">0.3483954</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1213793</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>DeepLearning_grid_1_AutoML_9_20220818_02649_model_1 <span class=\"token operator\">|</span> <span class=\"token number\">0.7966346</span><span class=\"token operator\">|</span> <span class=\"token number\">0.7616403</span><span class=\"token operator\">|</span> <span class=\"token number\">0.9149747</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.3698718</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4541096</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2062156</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>DeepLearning_grid_2_AutoML_9_20220818_02649_model_1 <span class=\"token operator\">|</span> <span class=\"token number\">0.7956731</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8362677</span><span class=\"token operator\">|</span> <span class=\"token number\">0.9047624</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.3012821</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4853948</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2356081</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>DRF_1_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.7539263</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5219917</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8798744</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4217949</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4216856</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1778187</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>DeepLearning_1_AutoML_9_20220818_02649              <span class=\"token operator\">|</span> <span class=\"token number\">0.7333333</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8538869</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8815236</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4272436</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4958518</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2458690</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_grid_1_AutoML_9_20220818_02649_model_2      <span class=\"token operator\">|</span> <span class=\"token number\">0.7314103</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5313998</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8687330</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.3794872</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4262241</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1816670</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_grid_1_AutoML_9_20220818_02649_model_2          <span class=\"token operator\">|</span> <span class=\"token number\">0.7165064</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5639670</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8663521</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4464744</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4389549</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1926814</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_3_AutoML_9_20220818_02649                   <span class=\"token operator\">|</span> <span class=\"token number\">0.7163462</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5853086</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8590006</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4205128</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4410992</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1945685</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_grid_1_AutoML_9_20220818_02649_model_3      <span class=\"token operator\">|</span> <span class=\"token number\">0.6935897</span><span class=\"token operator\">|</span> <span class=\"token number\">0.6025834</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8501436</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4560897</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4508583</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2032732</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_3_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.6850962</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5758231</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8457580</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4096154</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4426083</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1959021</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_2_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.6825321</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5725574</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8396044</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4615385</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4423293</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1956552</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XRT_1_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.6822917</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5526121</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8399612</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4259615</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4363727</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1904211</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_grid_1_AutoML_9_20220818_02649_model_1          <span class=\"token operator\">|</span> <span class=\"token number\">0.6788462</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5787583</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8417618</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4807692</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4450885</span><span class=\"token operator\">|</span> <span class=\"token number\">0.1981038</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_2_AutoML_9_20220818_02649                   <span class=\"token operator\">|</span> <span class=\"token number\">0.6741987</span><span class=\"token operator\">|</span> <span class=\"token number\">0.6278788</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8372321</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4041667</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4600278</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2116256</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_4_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.6665064</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5807562</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8455535</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4464744</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4473208</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2000959</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_grid_1_AutoML_9_20220818_02649_model_4      <span class=\"token operator\">|</span> <span class=\"token number\">0.6439103</span><span class=\"token operator\">|</span> <span class=\"token number\">0.6080102</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8175586</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4807692</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4550132</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2070370</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_grid_1_AutoML_9_20220818_02649_model_1      <span class=\"token operator\">|</span> <span class=\"token number\">0.6397436</span><span class=\"token operator\">|</span> <span class=\"token number\">0.6268736</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8186473</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4108974</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4644690</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2157314</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>GBM_5_AutoML_9_20220818_02649                       <span class=\"token operator\">|</span> <span class=\"token number\">0.6346154</span><span class=\"token operator\">|</span> <span class=\"token number\">0.6279713</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8233465</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.4711538</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4633673</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2147093</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>XGBoost_1_AutoML_9_20220818_02649                   <span class=\"token operator\">|</span> <span class=\"token number\">0.6283654</span><span class=\"token operator\">|</span> <span class=\"token number\">0.5879242</span><span class=\"token operator\">|</span> <span class=\"token number\">0.8236014</span><span class=\"token operator\">|</span>            <span class=\"token number\">0.5000000</span><span class=\"token operator\">|</span> <span class=\"token number\">0.4494019</span><span class=\"token operator\">|</span> <span class=\"token number\">0.2019621</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">></span></code></pre></div>\n<h2>4. AutoML Testing</h2>\n<p>After getting the best model, now it's time to test the performance with the <code class=\"language-text\">testData</code> data previously splitted. Then, the best model will be used for prediction.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">pred <span class=\"token operator\">&lt;-</span> h2o.predict<span class=\"token punctuation\">(</span>aml<span class=\"token punctuation\">,</span> testData<span class=\"token punctuation\">)</span>\npred <span class=\"token operator\">&lt;-</span> as.data.frame<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">)</span>\n\ntestResut <span class=\"token operator\">&lt;-</span> cbind<span class=\"token punctuation\">(</span>as.data.frame<span class=\"token punctuation\">(</span>testData<span class=\"token operator\">$</span>Label<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> as.data.frame<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note that, the returned \"prediction\" result may not be very realible. The below result shows, the threshold of Metastasis is not 0.5. Below result shows, the threshold cutoff is actually between 0.8675005 and 0.9052808.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> testResut\n        Label    predict      Healthy Metastasis\n<span class=\"token number\">1</span>  Metastasis Metastasis <span class=\"token number\">1.092303e-04</span>  <span class=\"token number\">0.9998908</span>\n<span class=\"token number\">2</span>  Metastasis Metastasis <span class=\"token number\">0.000000e+00</span>  <span class=\"token number\">1.0000000</span>\n<span class=\"token number\">3</span>  Metastasis Metastasis <span class=\"token number\">0.000000e+00</span>  <span class=\"token number\">1.0000000</span>\n<span class=\"token ellipsis\">...</span>\n<span class=\"token number\">40</span> Metastasis    Healthy <span class=\"token number\">2.331741e-01</span>  <span class=\"token number\">0.7668259</span>\n<span class=\"token number\">41</span> Metastasis    Healthy <span class=\"token number\">3.078612e-01</span>  <span class=\"token number\">0.6921388</span>\n<span class=\"token number\">42</span> Metastasis    Healthy <span class=\"token number\">8.539778e-01</span>  <span class=\"token number\">0.1460222</span>\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> range<span class=\"token punctuation\">(</span>testResut<span class=\"token operator\">$</span>Metastasis<span class=\"token punctuation\">[</span>testResut<span class=\"token operator\">$</span>predict <span class=\"token operator\">==</span> <span class=\"token string\">\"Metastasis\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># Show the probability range for Metastasis.</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.9052808</span> <span class=\"token number\">1.0000000</span>\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> range<span class=\"token punctuation\">(</span>testResut<span class=\"token operator\">$</span>Metastasis<span class=\"token punctuation\">[</span>testResut<span class=\"token operator\">$</span>predict <span class=\"token operator\">==</span> <span class=\"token string\">\"Healthy\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># Show the probability range for Healthy.</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.1347490</span> <span class=\"token number\">0.8675005</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>Apart from above prediction. Performace is also useful.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">perf &lt;- h2o.performance(aml@leader, test_dt)\nprint(perf)\n# plot(perf)</code></pre></div>\n<p>The performance will tell you the threshould should be used to achive different targerts. Like max Specificity, max Accuracy .etc</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> print<span class=\"token punctuation\">(</span>perf<span class=\"token punctuation\">)</span>\nH2OBinomialMetrics<span class=\"token operator\">:</span> glm\n\nMSE<span class=\"token operator\">:</span>  <span class=\"token number\">0.09460848</span>\nRMSE<span class=\"token operator\">:</span>  <span class=\"token number\">0.3075849</span>\nLogLoss<span class=\"token operator\">:</span>  <span class=\"token number\">0.2679102</span>\nMean Per<span class=\"token operator\">-</span>Class Error<span class=\"token operator\">:</span>  <span class=\"token number\">0.3135135</span>\nAUC<span class=\"token operator\">:</span>  <span class=\"token number\">0.8918919</span>\nAUCPR<span class=\"token operator\">:</span>  <span class=\"token number\">0.9854978</span>\nGini<span class=\"token operator\">:</span>  <span class=\"token number\">0.7837838</span>\nR<span class=\"token operator\">^</span><span class=\"token number\">2</span><span class=\"token operator\">:</span>  <span class=\"token number\">0.09789538</span>\nResidual Deviance<span class=\"token operator\">:</span>  <span class=\"token number\">22.50445</span>\nAIC<span class=\"token operator\">:</span>  <span class=\"token number\">4010.504</span>\n\nConfusion Matrix <span class=\"token punctuation\">(</span>vertical<span class=\"token operator\">:</span> actual<span class=\"token punctuation\">;</span> across<span class=\"token operator\">:</span> predicted<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> F1<span class=\"token operator\">-</span>optimal threshold<span class=\"token operator\">:</span>\n           Healthy Metastasis    Error   Rate\nHealthy          <span class=\"token number\">2</span>          <span class=\"token number\">3</span> <span class=\"token number\">0.600000</span>   <span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token operator\">/</span><span class=\"token number\">5</span>\nMetastasis       <span class=\"token number\">1</span>         <span class=\"token number\">36</span> <span class=\"token number\">0.027027</span>  <span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">37</span>\nTotals           <span class=\"token number\">3</span>         <span class=\"token number\">39</span> <span class=\"token number\">0.095238</span>  <span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token operator\">/</span><span class=\"token number\">42</span>\n\nMaximum Metrics<span class=\"token operator\">:</span> Maximum metrics at their respective thresholds\n                        metric threshold     value idx\n<span class=\"token number\">1</span>                       max f1  <span class=\"token number\">0.318830</span>  <span class=\"token number\">0.947368</span>  <span class=\"token number\">28</span>\n<span class=\"token number\">2</span>                       max f2  <span class=\"token number\">0.126710</span>  <span class=\"token number\">0.973684</span>  <span class=\"token number\">31</span>\n<span class=\"token number\">3</span>                 max f0point5  <span class=\"token number\">0.862650</span>  <span class=\"token number\">0.955414</span>  <span class=\"token number\">19</span>\n<span class=\"token number\">4</span>                 max accuracy  <span class=\"token number\">0.318830</span>  <span class=\"token number\">0.904762</span>  <span class=\"token number\">28</span>\n<span class=\"token number\">5</span>                max precision  <span class=\"token number\">1.000000</span>  <span class=\"token number\">1.000000</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">6</span>                   max recall  <span class=\"token number\">0.126710</span>  <span class=\"token number\">1.000000</span>  <span class=\"token number\">31</span>\n<span class=\"token number\">7</span>              max specificity  <span class=\"token number\">1.000000</span>  <span class=\"token number\">1.000000</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">8</span>             max absolute_mcc  <span class=\"token number\">0.862650</span>  <span class=\"token number\">0.581238</span>  <span class=\"token number\">19</span>\n<span class=\"token number\">9</span>   max min_per_class_accuracy  <span class=\"token number\">0.862650</span>  <span class=\"token number\">0.810811</span>  <span class=\"token number\">19</span>\n<span class=\"token number\">10</span> max mean_per_class_accuracy  <span class=\"token number\">0.862650</span>  <span class=\"token number\">0.905405</span>  <span class=\"token number\">19</span>\n<span class=\"token number\">11</span>                     max tns  <span class=\"token number\">1.000000</span>  <span class=\"token number\">5.000000</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">12</span>                     max fns  <span class=\"token number\">1.000000</span> <span class=\"token number\">26.000000</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">13</span>                     max fps  <span class=\"token number\">0.277832</span>  <span class=\"token number\">5.000000</span>  <span class=\"token number\">30</span>\n<span class=\"token number\">14</span>                     max tps  <span class=\"token number\">0.126710</span> <span class=\"token number\">37.000000</span>  <span class=\"token number\">31</span>\n<span class=\"token number\">15</span>                     max tnr  <span class=\"token number\">1.000000</span>  <span class=\"token number\">1.000000</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">16</span>                     max fnr  <span class=\"token number\">1.000000</span>  <span class=\"token number\">0.702703</span>   <span class=\"token number\">0</span>\n<span class=\"token number\">17</span>                     max fpr  <span class=\"token number\">0.277832</span>  <span class=\"token number\">1.000000</span>  <span class=\"token number\">30</span>\n<span class=\"token number\">18</span>                     max tpr  <span class=\"token number\">0.126710</span>  <span class=\"token number\">1.000000</span>  <span class=\"token number\">31</span></code></pre></div>\n<h2>5. Draw ROC Curve</h2>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"pROC\"</span><span class=\"token punctuation\">)</span>\n\nroc<span class=\"token punctuation\">(</span>testResult<span class=\"token operator\">$</span>Label<span class=\"token punctuation\">,</span> testResult<span class=\"token operator\">$</span>Metastasis<span class=\"token punctuation\">,</span> percent<span class=\"token operator\">=</span>F<span class=\"token punctuation\">,</span> boot.n<span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> ci.alpha<span class=\"token operator\">=</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span>\n    stratified<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> plot<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> grid<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> show.thres<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> legacy.axes <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>\n    reuse.auc <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> print.auc <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> print.thres.col <span class=\"token operator\">=</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span> ci<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> ci.type<span class=\"token operator\">=</span><span class=\"token string\">\"bars\"</span><span class=\"token punctuation\">,</span> print.thres.cex <span class=\"token operator\">=</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7483b3c91dafd897aa442b77eb8842a2/1bba8/ROC.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbUlEQVQ4y52U2Y6DMAxF+f9fpAKpD6xt2crWFlIdS0YEhaFMJAsS7JNrJ9ibpsm8Xi8zDIPp+/7Q8HNZ13Xy9ABWVWXatjUM5vM8y3NtrGFN05iyLC0jPkkSYXgKeT6fAtRA1yCTx+Mh/u/3e7FxHMVEIY4sqkJVhxLSYKM8z0UJT9SoH+Pz+SwxlMQDxq5Zlpn7/W6KopA5ADYBiDJVvjZiASlYFPKBSRzHVuB27MF0vgA1ACBO67RdqlwwC8hH0uSUUOhScwSzgFEUyQkBXCt0GUFas/W6VcPr9epMeRvAqYdhKHa5XEwQBMb3fYlToJwy6dZ1/afCvTSdKQOAvKfwF9hPp3wGZgEJ4I/YAs/ALCAv+nMr8CxsN2XuoV6NMzAFyikTDBmF3Mf/DqBLytoQtElqs9020aMGKwr14lJH7qPWlE2oJd2GzVgng9vtJgDeaWeA8KM7WcBtK8K0+dLGCE7TVDbVsS6RdvYvXJYhoJRagBkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ROC Curve\"\n        title=\"ROC Curve\"\n        src=\"/static/7483b3c91dafd897aa442b77eb8842a2/1bba8/ROC.png\"\n        srcset=\"/static/7483b3c91dafd897aa442b77eb8842a2/63868/ROC.png 250w,\n/static/7483b3c91dafd897aa442b77eb8842a2/0b533/ROC.png 500w,\n/static/7483b3c91dafd897aa442b77eb8842a2/1bba8/ROC.png 642w\"\n        sizes=\"(max-width: 642px) 100vw, 642px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Another way to draw ROC curve is this:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"ROCit\"</span><span class=\"token punctuation\">)</span>\n\nroc_empirical <span class=\"token operator\">&lt;-</span> rocit<span class=\"token punctuation\">(</span>score <span class=\"token operator\">=</span> testResult<span class=\"token operator\">$</span>Metastasis<span class=\"token punctuation\">,</span>\n                       class <span class=\"token operator\">=</span> testResult<span class=\"token operator\">$</span>Label<span class=\"token punctuation\">,</span>\n                       negref <span class=\"token operator\">=</span> <span class=\"token string\">\"Healthy\"</span><span class=\"token punctuation\">)</span>\n\nplot<span class=\"token punctuation\">(</span>roc_empirical<span class=\"token punctuation\">,</span> values <span class=\"token operator\">=</span> F<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"date":"August 16, 2022","slug":"/notes/Apply-H20.ai-for-Quick-AutoML-Task","title":"Apply H20.ai for Quick AutoML Task","tags":["Machine Learning","AutoML"],"abstract":"In many times I need to use Machine Learning to quickly create a model for classification. AutoML seems to be a really good way to do it. Here I want to record a bit my code snippets of running H2o.ai, then in the future I can apply this code quickly for prototyping."}}},"pageContext":{"slug":"/notes/Apply-H20.ai-for-Quick-AutoML-Task"}},
    "staticQueryHashes": ["63159454"]}