{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/ChAMP-3.0:-illumina-HumanMethylation-EPIC-V2",
    "result": {"data":{"markdownRemark":{"html":"<p>It's a big sorry for the community that I delayed this work for about 3 months.</p>\n<p>Basically, I don't quite like current ChAMP's code structure, especially the <a href=\"https://www.bioconductor.org/packages/release/bioc/html/ChAMP.html\">ChAMPdata package part</a>, which just holds all array's annotation, which includes 450K, EPIC v1, EPIC v2 (this post is about), and Mouse. And incredibly for each array, there are two R object saved: One <code class=\"language-text\">AnnoXXX</code> for IDAT file parsing, and a <code class=\"language-text\">probe.feature.xxx</code> for downstream analysis...</p>\n<p>This must be changed ASAP.</p>\n<p>So illumina released <a href=\"https://emea.support.illumina.com/array/array_kits/infinium-methylationepic-beadchip-kit/downloads.html\">EPIC V2</a> in November last year, which should have some difference when compared with V1. Mostly people emphasized the difference of probes between V1 and V2. However, by preparing manifest to ChAMP-usable R object, I found more things I should look into the coming future. Below are some comparison I did between V1 and V2, along with some issues on annotation side I should address in the future.</p>\n<h3>Genome Version</h3>\n<p>The first vital thing, is <b style=\"background-color: yellow\">the default CHR/MAPINO .etc are based on hg38</b>, previously the EPICv1 was based on hg19. This means that I better provide a hg19 version for user as well.</p>\n<h3>Name â‰  IlmnID</h3>\n<p>The illumina manifest always contains two columns, <strong>Name</strong> and <strong>IlmnID</strong>. In previous versions (except the mouse one), they are always the same. However, in EPIC V2, they are not exactly the same.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> length<span class=\"token punctuation\">(</span>unique<span class=\"token punctuation\">(</span>cpg<span class=\"token operator\">$</span>IlmnID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">937055</span>\n<span class=\"token operator\">></span> length<span class=\"token punctuation\">(</span>unique<span class=\"token punctuation\">(</span>cpg<span class=\"token operator\">$</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">930658</span>\n<span class=\"token operator\">></span> </code></pre></div>\n<p>I currently don't know why some Names are duplicated yet but will look into that. In ChAMP, I will only use the IlmnID for its uniqueness.</p>\n<h3>Number of CpGs</h3>\n<p>So this is a major difference between V1 and V2. Below comparison shows that EPICv2 have more CpGs then EPICv1. But not all CpGs in V1 are contained in V2. According to the official document from illumina, there are 143467 CpGs removed from EPICv1, and there are 209834 new CpGs added into V2.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> nrow<span class=\"token punctuation\">(</span>EPICv1<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">865918</span>\n<span class=\"token operator\">></span> nrow<span class=\"token punctuation\">(</span>EPICv2<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">937055</span>\n<span class=\"token operator\">></span> setdiff<span class=\"token punctuation\">(</span>rownames<span class=\"token punctuation\">(</span>EPICv1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> EPICv2<span class=\"token operator\">$</span>Name<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> length\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">144116</span>\n<span class=\"token operator\">></span> setdiff<span class=\"token punctuation\">(</span>EPICv2<span class=\"token operator\">$</span>Name<span class=\"token punctuation\">,</span> rownames<span class=\"token punctuation\">(</span>EPICv1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> length\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">208856</span>\n<span class=\"token operator\">></span> </code></pre></div>\n<p>Below is my code checking, the removed and new-added number seems slightly different, Why? Also, the illumina document listed that:</p>\n<ol>\n<li>Flagged probes: Approximately 49K probes did not meet performance expectations based on internal Illumina probe-level analysis.</li>\n<li>Probes with mapping inaccuracies: A subset of approximately 190 probes were identified with inaccurate mapping.</li>\n</ol>\n<p>Um...I have a lot of work to do in the future months.</p>\n<h3>UCSC vs GENCODEv41</h3>\n<p>Most analyses in ChAMP focus on CpG, but still, there are some of them are related to genes, so it relies on genome annotation. The default illumina manifest provided two genome annotation, UCSC and GENCODEv41. In my current version of ChAMPdata (2.31.1), I will use UCSC one. Also, currently I will only extract one gene (the first) of a CpG is related with multiple genes.</p>\n<h3>Genome Feature Information</h3>\n<p>In ChAMP's previous annotation, I need to know information like TSS200, TSS1500, Body, Exon .etc. However, I found that in the latest version of the UCSC CpG Island annotation (UCSC_RefGene_Group column), some tags are lost, like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>EPICv1<span class=\"token operator\">$</span>feature<span class=\"token punctuation\">)</span>\n\n<span class=\"token number\">1</span>stExon   <span class=\"token number\">3</span><span class=\"token string\">'UTR   5'</span>UTR    Body ExonBnd     IGR TSS1500  TSS200\n  <span class=\"token number\">26433</span>   <span class=\"token number\">21594</span>   <span class=\"token number\">73070</span>  <span class=\"token number\">318165</span>    <span class=\"token number\">5680</span>  <span class=\"token number\">249608</span>  <span class=\"token number\">107193</span>   <span class=\"token number\">65152</span>\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>EPICv2<span class=\"token operator\">$</span>feature<span class=\"token punctuation\">)</span>\n\n           <span class=\"token number\">3</span>UTR    <span class=\"token number\">5</span>UTR    Exon TSS1500  TSS200 \n <span class=\"token number\">614365</span>   <span class=\"token number\">13458</span>   <span class=\"token number\">29247</span>  <span class=\"token number\">101698</span>  <span class=\"token number\">122150</span>   <span class=\"token number\">56137</span> </code></pre></div>\n<p>So one key piece of information lost is <code class=\"language-text\">Body</code>... without body, I can't correctly annotate what CpGs are in IGR (Intergenic Gene Regions). This issue need to be solved. Also, I quickly checked the GENCODEv41 version feature annotation, it varies a lot when compared with UCSC one...</p>\n<h3>SNP Mask</h3>\n<p>As always, I am looking for the population-based SNP mask data from <a href=\"http://zwdzwd.github.io/InfiniumAnnotation\">Zhou's website</a>. However, for the EPICv2 Manifest, I only found 5 populations: AFR, AMR, EAS, EUR and SAS. Previous version of EPICv1 provided much more population. Again previously I put the general mask and population-based mask in two different files. It should be changed.</p>\n<p>Based on my summary:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>EPICv2_Mask<span class=\"token operator\">$</span>MASK_general<span class=\"token punctuation\">)</span> <span class=\"token comment\"># General mask</span>\n\n<span class=\"token boolean\">FALSE</span>  <span class=\"token boolean\">TRUE</span> \n<span class=\"token number\">49844</span> <span class=\"token number\">32896</span> \n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>EPICv2_Mask<span class=\"token operator\">$</span>MASK_general_AFR<span class=\"token punctuation\">)</span> <span class=\"token comment\"># AFR population mask</span>\n\n<span class=\"token boolean\">FALSE</span>  <span class=\"token boolean\">TRUE</span> \n<span class=\"token number\">41532</span> <span class=\"token number\">41208</span> </code></pre></div>\n<hr>\n<p>My script for preprocessing is <a href=\"https://github.com/YuanTian1991/ChAMP-Script/blob/master/Manifest2Annotation_EPIC_v2.R\">here</a>. It works and I should get EPICv2 done soon. However, it's vital to re-design the whole structure of ChAMP, along with the annotation supply system.</p>","frontmatter":{"date":"February 17, 2023","slug":"/notes/ChAMP-3.0:-illumina-HumanMethylation-EPIC-V2","title":"ChAMP 3.0: illumina HumanMethylation EPIC V2","tags":["ChAMP"],"abstract":"I am updating the ChAMP with the new illumina Human Methylation Array, V2. Here are some record"}}},"pageContext":{"slug":"/notes/ChAMP-3.0:-illumina-HumanMethylation-EPIC-V2"}},
    "staticQueryHashes": ["63159454"]}