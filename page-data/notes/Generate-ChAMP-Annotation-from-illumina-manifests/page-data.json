{"componentChunkName":"component---src-templates-note-template-js","path":"/notes/Generate-ChAMP-Annotation-from-illumina-manifests","result":{"data":{"markdownRemark":{"html":"<p>ChAMP is a tool for DNA Methylation array analysis, more specifically, it only work with Illumina Methylation. Previously Ilumina company only have Human Methylation array (<a href=\"https://emea.support.illumina.com/downloads/infinium_humanmethylation450_product_files.html\">450K</a> and <a href=\"https://emea.support.illumina.com/downloads/infinium-methylationepic-v1-0-product-files.html\">EPIC</a>), but recently it published <a href=\"https://emea.support.illumina.com/downloads/infinium-mouse-methylation-manifest-file-csv.html\">methylation array for Mouse</a>. So my task here now it to integrate these 3 manifest into ChAMP.</p>\n<h2>1. Issue between illumina file and it's manifest</h2>\n<p>Manifest contains many information, not all are used by ChAMP, users can get more detail from <a href=\"https://emea.support.illumina.com/content/dam/illumina-support/documents/downloads/productfiles/methylationepic/infinium-methylationepic-manifest-column-headings.pdf\">here</a>. However, <strong>most importantly, it indicates us how to fetch each CpG's methylation value (and unmethylated value) from each IDAT file</strong>. The IDAT file (which could be readed by <a href=\"https://bioconductor.org/packages/release/bioc/html/illuminaio.html\">R pacakge illuminaio</a>) contains probes that are designed to hybrid with DNA samples' bisulfite conversion bases. <strong>The hard part is: It's not that one probe in IDAT file is designed to match one CpG</strong>. As most people know, there are two types of <code class=\"language-text\">Assay</code> designed to finish this job: Infinium type-I and Infinium type-II. Type-I assay used two probes to match one CpG site, but Type-II assay use only one probe to match one CpG site. The whole methylation chip is mixed with these two type of assay, which means some part of CpGs' methylation status are measured by 2 probes, but some part are measured by just one probe. So obviously the number between probes in chip is NOT equal to number of CpGs eventually we can get.</p>\n<p>Secondly, there are two <code class=\"language-text\">colour channels</code> designed for each probe. In short, colour channels are measurement of colour intensity the illumina mechine. So each probe have 2 colour channel.</p>\n<p>Third, there are 2 <code class=\"language-text\">methylation status</code>: Methylated and Unmethylated for each CpG site, which means for one CpG in our body, there are a lot of fragments contain this CpG sites are flowing in cell everytime. Some part of these fragments are methylated (which means their C base is attached by a methyl), and the rest are not methylated. Yes there are only two status, Yes or No, there is no middle ground for one fragment (or we can say one CpG). So actually the so call \"methylation status\" we are trying to estimate is the ratio between methylated fragments and all estimated fragment: <strong>Methylated/(Methylated + Unmethylated)</strong>.</p>\n<p>So finally, in summary there are <code class=\"language-text\">2 types of assay</code>, each with <code class=\"language-text\">2 colour channel</code> in IDAT file. And we want to get <code class=\"language-text\">2 methylation status</code> for each CpG site. It took me quite a long time to figure out their relationship ( from various papers), I don't know why there is so little \"detailed\" information about it, which also means most DNA methylation researcher are purely relying on software's result, instead of question these very down-to-earth detail questions.</p>\n<h2>2. How exactly IDAT probes are matched with CpG Sites</h2>\n<p>The best paper I found to explain above issue is <a href=\"https://genomebiology.biomedcentral.com/articles/10.1186/s13059-016-1066-1\">this one</a>. And it presented below figure. I don't want to re-type everything here, but this is author's word:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94204898267a648e0d92016429b95855/7e4a6/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACr0lEQVQ4y21U6W7bOBjM+7/P/ukjdIG2SNFs6zaJFcu2DoqHSPHSMTuS6yYOSoCGBZLDmW/m4908z5BSQgixzRACch6hB41DW8K7CB8itOnh3LDN9X9KGeM0I+YJ87xgHcuy4A5vxjgSSCv0xuBUV/jn4wfc/9zheJb4dP8du8cSD7s9/v38ANEZNCrgR6Hg4/gKuDIMPsBZBz8EaJvIiBt4qXGOTP323ZOp82mbdlj3JMSYkcYZ03uG1SDwKAo8qRJ9CogpkeERtrcYhgHvh9ESTVWjt5TOEl3B/gCuh4qiQN02mMYJwjT4/vIfmrpFVdc3oHOe8VTuUO73UFUHWQvM03TL0EUWOlqaQQMo0wWHzggMNMCSRc6XA75XsJ2CUVxTBlkPiJy4KH4FbAeJ++cHNKZDKwUS6xnShMAaxbzAmie6qqE9L5bd5vDAtXVPTB69/nULuNB+z+Jv1Hlb3VXYFT9QVy3K4xlKnhiNdDmUZhT7nzg/HaAPHbqXM4JrXgHXn+uYxozmVG4X/G34wdLZ8Ne1K87GMHDT4XDAQIdlb+iuQU1pUlloxqX5do/Abztl6FZAdR2bwNBtD01T2q9fbiWvznq/Sr4wWw0pmxceMAywgCXYcnWSBp1PBdS5gW97mFOLbO1tsI01UEZBGk2GgR0DZBZ94CXTb6C3stY6r2vhjfwbyY2X+NXu8axLpIXt5wjeS8hObhm8hnZTwwtqeYbuNUTTYlomLPN8Kzn6iPpUwVLiGtwTO+ZYHyitQke5a4//MY6RKY+PEHRXFBWidJjfA/bJQaUenpnSbKvEgKcxYcyZoc5kcJGdGHLPhyOliJkPwsh+XtJ04/bdWg/pNZ5pgmXHKL42TrEbnEcjekobIPZfaNzIkEeWguUgsGICWslQdzXk4eHSlrz4f/Ug1D47oZQ5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ArrayDesign\"\n        title=\"ArrayDesign\"\n        src=\"/static/94204898267a648e0d92016429b95855/5a190/figure1.png\"\n        srcset=\"/static/94204898267a648e0d92016429b95855/772e8/figure1.png 200w,\n/static/94204898267a648e0d92016429b95855/e17e5/figure1.png 400w,\n/static/94204898267a648e0d92016429b95855/5a190/figure1.png 800w,\n/static/94204898267a648e0d92016429b95855/7e4a6/figure1.png 952w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div style=\"background-color: #eeeeee;padding: 20px; border-radius: 5px; font-size: 13px; margin-bottom: 10px;margin-top:10px\">\n\"C: DNA methylation measurement with Infinium I probes is carried out by two beads – the unmethylated (U) bead measures the unmethylated signal and methylated (M) bead measures the methylated signal. The unmethylated signal detection for the cg21253966 probe is schematically represented on the left panel. Briefly, the unmethylated bead probe (U) sequence is designed to match bisulphite converted DNA sequence of the unmethylated locus. (Note that cytosines in both the target CpG site and all other CpG sites bound by the 50 bp probe are assumed to be unmethylated and therefore converted to Ts during bisulphite reaction.) <b>The hybridisation of a bisulphite converted unmethylated DNA fragment to the bead enables single base extension and incorporation of a ddNTP labelled nucleotide matching the nucleotide immediately upstream of the target CpG site; in this case incorporation of an A nucleotide and signal detection in the RED channel</b>. Hybridisation of the methylated bead probe (M), on the other hand, results in mismatch at the 3′ end of the probe and inhibition of single base extension. Detection of the methylated signal, shown on the right panel, follows similar steps. D: For Infinium II probes the unmethylated and methylated signals are measured by the same bead (U/M). The bead probe sequence is designed to match bisulphite converted DNA of both the methylated and unmethylated locus. This is achieved by making the cytosine of the target CpG site the single base extension locus and replacing cytosines of all other CpG sites within the probe sequence with degenerate R bases that hybridises to both T (representing unmethylated and converted cytosine) and C (representing methylated and protected cytosine) bases. The unmethylated signal detection for the cg04110421 probe is schematically represented on the left panel. The hybridisation of the bisulphite converted unmethylated DNA fragment enables single base extension and incorporation of ddNTP labelled A nucleotide matching the unmethylated and converted cytosine at the target CpG site and signal detection on the RED channel. The detection of the methylation signal, shown on the right panel, is the same except that in this case single base extension results in incorporation of ddNTP labelled G nucleotide matching the methylated and protected cytosine at the target CpG site and signal detection on the GREEN channel\"\n</div>\n<p>The hard part here is to understand how two Infinum type-I probes could measure one CpG's 2 status. In short for one CpG sites, one \"methylated-probe\" (probe_A) would try hybrid the CpG site, if this site is methylated, this probe would have intensity. Let's assumed it would show in RED channel (forget another green colour now), which could be detected later, indicating this CpG's is methylated. So eventually we detected Red_Channel of probe_A as CpG's Methylated status. At the same time, there is another \"unmethylated_probe\" (probe_B) would try hybrid the same CpG site, it will only work if this site is NOT methylated. And eventualy, if this site is indeed not methylated, probe_B would also show Red_Channel. So now we know, The Red_Channel of probe_A indicates methylated, and Red_Channel of probe_B indicates Unmethylated status. <strong>For this CpG site, Green_Channel for both probe_A and probe_B are useless for us</strong>.</p>\n<p>So how about the second colour, the Green? Yes there are 2 different kinds of type-I assay: The green channel type and red channel type. For the first type, we only check the two probe's green channel for meth/unmeth status. For the second type, we only check the red channel for meth/unmeth status. For each CpG sites, when we are trying to get it's meth/unmeth information from IDAT, we must firstly check it's colour chanenl. Why there are two types of type-I assay? I previuosly googled one word somewhere that it's because of primer design, but since my biological background is weak, I don't fully understand, I will try figure it out in the future.</p>\n<p>Then, the Infinium type-II is much easier. Just one probe (matching each CpG site), with two colour channel both useful. While Green channel indicates this CpG site is methylated (C after BS conversion), and Red indicates it's not (T after BS conversion).</p>\n<h2>3 Code to preprocess Manifest</h2>\n<p>After figuring out above issue, I can now write code to generate \"probe 2 CpG annotation\". Let's have a look at how the manifest looks like. Below is an example of EPIC array B5 version manifest. There are 3 part in this manifest: <code class=\"language-text\">Heading</code>, <code class=\"language-text\">Assay</code> and <code class=\"language-text\">Control</code>. Heading is not very useful, then Assay contains all information of CpG and Probe. Control are probes that are designed in chip, but merely used to do quality control for each chip.</p>\n<p>I firstly address the Assay part. After skipping Header information, I now can read assay into R.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">manifest_directory <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"../Manifests/infinium-methylationepic-v-1-0-b5-manifest-file.csv\"</span>\n\nskipline <span class=\"token operator\">&lt;-</span> which<span class=\"token punctuation\">(</span>substr<span class=\"token punctuation\">(</span>readLines<span class=\"token punctuation\">(</span>manifest_directory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"[Assay]\"</span><span class=\"token punctuation\">)</span>\nManifest <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span>manifest_directory<span class=\"token punctuation\">,</span> head<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> skip<span class=\"token operator\">=</span>skipline<span class=\"token punctuation\">,</span> as.is<span class=\"token operator\">=</span>T<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The Manifest contains too much information, much more than CpG's position or it's probe information, but sometimes included information like gene, TSS status, CpG Island .etc <strong>And for different manifest (version or species), there are different columns of annotation included. For example, I found there is no gene information in Mouse information, but gene is such a commonly used information everyone would ask...</strong>. Here I just focus on CpG-to-Probe mapping, so I just extract below some key columns:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> Anno <span class=\"token operator\">&lt;-</span> Manifest<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"IlmnID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AddressA_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AddressB_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Infinium_Design_Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Color_Channel\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">(</span>Anno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token operator\">|</span>IlmnID     <span class=\"token operator\">|</span>AddressA_ID <span class=\"token operator\">|</span>AddressB_ID <span class=\"token operator\">|</span>Infinium_Design_Type <span class=\"token operator\">|</span>Color_Channel <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg07881041 <span class=\"token operator\">|</span><span class=\"token number\">0085713262</span>  <span class=\"token operator\">|</span>            <span class=\"token operator\">|</span>II                   <span class=\"token operator\">|</span>              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg18478105 <span class=\"token operator\">|</span><span class=\"token number\">0046761277</span>  <span class=\"token operator\">|</span><span class=\"token number\">0086644198</span>  <span class=\"token operator\">|</span>I                    <span class=\"token operator\">|</span>Grn           <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg23229610 <span class=\"token operator\">|</span><span class=\"token number\">0021717843</span>  <span class=\"token operator\">|</span>            <span class=\"token operator\">|</span>II                   <span class=\"token operator\">|</span>              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg03513874 <span class=\"token operator\">|</span><span class=\"token number\">0029622133</span>  <span class=\"token operator\">|</span>            <span class=\"token operator\">|</span>II                   <span class=\"token operator\">|</span>              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg09835024 <span class=\"token operator\">|</span><span class=\"token number\">0016745152</span>  <span class=\"token operator\">|</span><span class=\"token number\">0081631976</span>  <span class=\"token operator\">|</span>I                    <span class=\"token operator\">|</span>Red           <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg05451842 <span class=\"token operator\">|</span><span class=\"token number\">0016681196</span>  <span class=\"token operator\">|</span>            <span class=\"token operator\">|</span>II                   <span class=\"token operator\">|</span>              <span class=\"token operator\">|</span></code></pre></div>\n<p>Above are all information I need for CpG-to-Probe mapping, colour channel, Infinium type, AddressA_ID and AddressB_ID are 1-2 probes designed for each CpG, and the first column is CpG name world-wide is using. In above code black we already can see 3 types of CpGs:</p>\n<ol>\n<li>cg07881041 is Infinium type-II assay, so it has only one probe (AddressA_ID), but two colour chanenls are used for it. So eventually the Green channel (read from Grn_IDAT file) indicate this CpG's methylation status, and Red channel indicates it's unmethylated status.</li>\n<li>cg18478105 is Infinium type-I assay, and the colour_channel for this CpG is Green (Grn), this CpG have 2 probes (AddressA_ID and AddressB_ID). So for this CpG, the AddressB_ID indicates it's methylation status, and AddressA_ID indicates it's unmethylated status.</li>\n<li>cg09835024 is Infinium type-I asssay, and the color channel is Red, this CpG have 2 probes (AddressA_ID and AddressB<em>\\ID). So for this CpG, the AddressB\\</em>ID indicates it's methylated status, and AddressA_ID indicate it's unmethylated status.</li>\n</ol>\n<blockquote>\n<p>There is a vital problem here: <strong>How can I know AddressB equals to Methylated? and AddressA equals to Unmethylated? I did not found any document for this</strong>, apart from original minfi package's loading function. I have decided to ask Illumina for answer.</p>\n</blockquote>\n<p>Anyway, below is the core code to convert manifest into CpG information.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">message<span class=\"token punctuation\">(</span><span class=\"token string\">\"Extract Annotation for ChAMP from original Illumina Human or Mouse Methylation Array\"</span><span class=\"token punctuation\">)</span>\nmessage<span class=\"token punctuation\">(</span><span class=\"token string\">\"Read CSV manifest into R.\"</span><span class=\"token punctuation\">)</span>\nskipline <span class=\"token operator\">&lt;-</span> which<span class=\"token punctuation\">(</span>substr<span class=\"token punctuation\">(</span>readLines<span class=\"token punctuation\">(</span>manifest_directory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"[Assay]\"</span><span class=\"token punctuation\">)</span>\nManifest <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span>manifest_directory<span class=\"token punctuation\">,</span> head<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> skip<span class=\"token operator\">=</span>skipline<span class=\"token punctuation\">,</span> as.is<span class=\"token operator\">=</span>T<span class=\"token punctuation\">)</span>\n    \nAnno <span class=\"token operator\">&lt;-</span> Manifest<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"IlmnID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AddressA_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AddressB_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Infinium_Design_Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Color_Channel\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nmessage<span class=\"token punctuation\">(</span><span class=\"token string\">\"Total Rows in this manifest: \"</span><span class=\"token punctuation\">,</span> nrow<span class=\"token punctuation\">(</span>Anno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \nmessage<span class=\"token punctuation\">(</span><span class=\"token string\">\"There are totally 3 types of Probes, Type-II, Type-I-Green and Type-I-Red\"</span><span class=\"token punctuation\">)</span>\nType_II <span class=\"token operator\">&lt;-</span> Anno<span class=\"token punctuation\">[</span>which<span class=\"token punctuation\">(</span>Anno<span class=\"token operator\">$</span>Infinium_Design_Type<span class=\"token operator\">==</span><span class=\"token string\">\"II\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># Find Type-II CpGs.</span>\nType_I.Red <span class=\"token operator\">&lt;-</span> Anno<span class=\"token punctuation\">[</span>which<span class=\"token punctuation\">(</span>Anno<span class=\"token operator\">$</span>Infinium_Design_Type <span class=\"token operator\">==</span> <span class=\"token string\">\"I\"</span> <span class=\"token operator\">&amp;</span> Anno<span class=\"token operator\">$</span>Color_Channel<span class=\"token operator\">==</span><span class=\"token string\">\"Red\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># Find Type-I CpGs with Green Channel</span>\nType_I.Grn <span class=\"token operator\">&lt;-</span> Anno<span class=\"token punctuation\">[</span>which<span class=\"token punctuation\">(</span>Anno<span class=\"token operator\">$</span>Infinium_Design_Type <span class=\"token operator\">==</span> <span class=\"token string\">\"I\"</span> <span class=\"token operator\">&amp;</span> Anno<span class=\"token operator\">$</span>Color_Channel<span class=\"token operator\">==</span><span class=\"token string\">\"Grn\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># Find Type-I CpGs with Red Channel</span>\n    \nCpG.ID <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>as.character<span class=\"token punctuation\">(</span>Type_II<span class=\"token operator\">$</span>IlmnID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>as.character<span class=\"token punctuation\">(</span>Type_I.Red<span class=\"token operator\">$</span>IlmnID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>as.character<span class=\"token punctuation\">(</span>Type_I.Grn<span class=\"token operator\">$</span>IlmnID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \nmessage<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"Get mapping index between Manifest and Illuminano pacakge output to generate Methylated Signal\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nM.index <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span>Type_II<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span>Type_I.Red<span class=\"token operator\">$</span>AddressB_ID<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span>Type_I.Grn<span class=\"token operator\">$</span>AddressB_ID<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \nmessage<span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"Get mapping index between Manifest and Illuminano pacakge output to generate UnMethylated Signal\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nU.index <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span>Type_II<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span>Type_I.Red<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span>Type_I.Grn<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nmessage<span class=\"token punctuation\">(</span><span class=\"token string\">\"generate Colour Channel distribution\"</span><span class=\"token punctuation\">)</span>\nP.Channal <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">(</span><span class=\"token string\">\"g+r\"</span><span class=\"token punctuation\">,</span>nrow<span class=\"token punctuation\">(</span>Type_II<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>rep<span class=\"token punctuation\">(</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span>nrow<span class=\"token punctuation\">(</span>Type_I.Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>rep<span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">,</span>nrow<span class=\"token punctuation\">(</span>Type_I.Grn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nmessage<span class=\"token punctuation\">(</span><span class=\"token string\">\"Merge them into one Data.Frame for future usage.\"</span><span class=\"token punctuation\">)</span>\nProbeInfo <span class=\"token operator\">&lt;-</span> data.frame<span class=\"token punctuation\">(</span>CpG<span class=\"token operator\">=</span>CpG.ID<span class=\"token punctuation\">,</span> M.index<span class=\"token operator\">=</span>M.index<span class=\"token punctuation\">,</span> U.index<span class=\"token operator\">=</span>U.index<span class=\"token punctuation\">,</span> Channel<span class=\"token operator\">=</span>P.Channal<span class=\"token punctuation\">)</span>\nrownames<span class=\"token punctuation\">(</span>ProbeInfo<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> ProbeInfo<span class=\"token operator\">$</span>CpG</code></pre></div>\n<p>Now we can have a look at the final <code class=\"language-text\">ProbeInfo</code> object:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">(</span>ProbeInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>CpG        <span class=\"token operator\">|</span>M.index      <span class=\"token operator\">|</span>U.index      <span class=\"token operator\">|</span>Channel <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg07881041 <span class=\"token operator\">|</span>cg07881041 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0085713262</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0085713262</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg23229610 <span class=\"token operator\">|</span>cg23229610 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0021717843</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0021717843</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg03513874 <span class=\"token operator\">|</span>cg03513874 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0029622133</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0029622133</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg05451842 <span class=\"token operator\">|</span>cg05451842 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0016681196</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0016681196</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg14797042 <span class=\"token operator\">|</span>cg14797042 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0007767973</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0007767973</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg09838562 <span class=\"token operator\">|</span>cg09838562 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0025809572</span> <span class=\"token operator\">|</span>R<span class=\"token operator\">-</span><span class=\"token number\">0025809572</span> <span class=\"token operator\">|</span>g<span class=\"token operator\">+</span>r     <span class=\"token operator\">|</span>\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>tail<span class=\"token punctuation\">(</span>ProbeInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>CpG        <span class=\"token operator\">|</span>M.index      <span class=\"token operator\">|</span>U.index      <span class=\"token operator\">|</span>Channel <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg03736928 <span class=\"token operator\">|</span>cg03736928 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0067692127</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0010668981</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg06272054 <span class=\"token operator\">|</span>cg06272054 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0059709585</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0075798594</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg07255356 <span class=\"token operator\">|</span>cg07255356 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0096765967</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0022689283</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg26501858 <span class=\"token operator\">|</span>cg26501858 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0072705864</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0089651984</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg24220897 <span class=\"token operator\">|</span>cg24220897 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0038809193</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0041808189</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>cg12325588 <span class=\"token operator\">|</span>cg12325588 <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0035621935</span> <span class=\"token operator\">|</span>G<span class=\"token operator\">-</span><span class=\"token number\">0078754334</span> <span class=\"token operator\">|</span>g       <span class=\"token operator\">|</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>So now I organize the origin manifest (which contain 1-2 probes, 2 colour chanenl) into a nice table format. For each CpG, there is <code class=\"language-text\">colour-probe</code> indicates its methylated status (M.index), and another <code class=\"language-text\">colour-probe</code> indicates its unmethylated status (U.index).</p>\n<p>It's not a complicated thing at all, but I have wasted couple ways on this small task. I only want to make sure these matching are correct. From my point of view, this is the most important part for manifest, the <code class=\"language-text\">Control</code> is also important, so does other annotated information (gene's CpG Island .etc). I will not discuss them here.</p>","frontmatter":{"date":"January 01, 2021","slug":"/notes/Generate-ChAMP-Annotation-from-illumina-manifests","title":"Generate ChAMP Annotation from illumina manifests","abstract":"I am coding the thrird version of ChAMP, here is the first task I am encounter now. I need to convert the illumina CSV to ChAMP Annotation, previously I only use some random code to achive this, but this time I decided to form them into some script for future usage."}}},"pageContext":{"slug":"/notes/Generate-ChAMP-Annotation-from-illumina-manifests"}}}