{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/My-R-Data.Table-Quick-Code",
    "result": {"data":{"markdownRemark":{"html":"<p>I started to use <a href=\"https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html\">data.table</a> when I found base R code can not fulfill my computational purpose. And I like it, I think in the future I will replace all my code with data.table. It may be a bit slow to start using it. However, I hope it will work smoothly in the future.</p>\n<h2>1. Transfer data.frame to data.table</h2>\n<p>Assume I have a data.table as below, the <code class=\"language-text\">cl</code> column in the table is the index used to \"collapse\" data:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"data.table\"</span><span class=\"token punctuation\">)</span>\n\nCNT.dt <span class=\"token operator\">&lt;-</span> setDT<span class=\"token punctuation\">(</span>CNT.df<span class=\"token punctuation\">)</span> <span class=\"token comment\"># data.frame to data.table</span>\n\nCNT.df <span class=\"token operator\">&lt;-</span> as.data.frame<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">)</span> <span class=\"token comment\"># data.table to data.frame</span></code></pre></div>\n<h2>2. Aggregate function</h2>\n<p>This is a key reason I use data.table.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> RegionCollapse\n                             chr start   end   pos     NC_cnt NC_ocp\n       <span class=\"token number\">1</span><span class=\"token operator\">:</span>                   chr1 <span class=\"token number\">10922</span> <span class=\"token number\">10972</span> <span class=\"token number\">10947</span>  <span class=\"token number\">0.1613736</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">2</span><span class=\"token operator\">:</span>                   chr1 <span class=\"token number\">10972</span> <span class=\"token number\">11022</span> <span class=\"token number\">10997</span>  <span class=\"token number\">0.6423164</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">3</span><span class=\"token operator\">:</span>                   chr1 <span class=\"token number\">11022</span> <span class=\"token number\">11072</span> <span class=\"token number\">11047</span>  <span class=\"token number\">0.1613736</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">4</span><span class=\"token operator\">:</span>                   chr1 <span class=\"token number\">11072</span> <span class=\"token number\">11122</span> <span class=\"token number\">11097</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">5</span><span class=\"token operator\">:</span>                   chr1 <span class=\"token number\">11122</span> <span class=\"token number\">11172</span> <span class=\"token number\">11147</span>  <span class=\"token number\">0.1822201</span>      <span class=\"token number\">3</span>\n      <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n<span class=\"token number\">39065421</span><span class=\"token operator\">:</span> chrY_KI270740v1_random <span class=\"token number\">36374</span> <span class=\"token number\">36424</span> <span class=\"token number\">36399</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">0</span>\n<span class=\"token number\">39065422</span><span class=\"token operator\">:</span> chrY_KI270740v1_random <span class=\"token number\">36424</span> <span class=\"token number\">36474</span> <span class=\"token number\">36449</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">1</span>\n<span class=\"token number\">39065423</span><span class=\"token operator\">:</span> chrY_KI270740v1_random <span class=\"token number\">36648</span> <span class=\"token number\">36698</span> <span class=\"token number\">36673</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">1</span>\n<span class=\"token number\">39065424</span><span class=\"token operator\">:</span> chrY_KI270740v1_random <span class=\"token number\">36947</span> <span class=\"token number\">36997</span> <span class=\"token number\">36972</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">0</span>\n<span class=\"token number\">39065425</span><span class=\"token operator\">:</span> chrY_KI270740v1_random <span class=\"token number\">36997</span> <span class=\"token number\">37047</span> <span class=\"token number\">37022</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3090061</span>      <span class=\"token number\">0</span>\n          NC_fraction     TC_cnt TC_ocp TC_fraction      LT_cnt LT_ocp\n       <span class=\"token number\">1</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n       <span class=\"token number\">2</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n       <span class=\"token number\">3</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n       <span class=\"token number\">4</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n       <span class=\"token number\">5</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.4285714</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n      <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n<span class=\"token number\">39065421</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">1</span>\n<span class=\"token number\">39065422</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span>  <span class=\"token number\">1.40105038</span>      <span class=\"token number\">0</span>\n<span class=\"token number\">39065423</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.1428571</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">0</span>   <span class=\"token number\">0.0000000</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n<span class=\"token number\">39065424</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.04391415</span>      <span class=\"token number\">2</span>   <span class=\"token number\">0.2857143</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n<span class=\"token number\">39065425</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.58206031</span>      <span class=\"token number\">1</span>   <span class=\"token number\">0.1428571</span> <span class=\"token operator\">-</span><span class=\"token number\">0.04849291</span>      <span class=\"token number\">0</span>\n          LT_fraction     cl\n       <span class=\"token number\">1</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">2</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">3</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">4</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span>      <span class=\"token number\">1</span>\n       <span class=\"token number\">5</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span>      <span class=\"token number\">1</span>\n      <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n<span class=\"token number\">39065421</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.3333333</span> <span class=\"token number\">372600</span>\n<span class=\"token number\">39065422</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">372600</span>\n<span class=\"token number\">39065423</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">372600</span>\n<span class=\"token number\">39065424</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">372600</span>\n<span class=\"token number\">39065425</span><span class=\"token operator\">:</span>   <span class=\"token number\">0.0000000</span> <span class=\"token number\">372600</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>It's easy to do, just put <code class=\"language-text\">cl</code> in the third comma, then we can modify columns as much as we want. It's really fast, compared with troditional aggregate function.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">RegionAggre <span class=\"token operator\">&lt;-</span> RegionCollapse<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> .<span class=\"token punctuation\">(</span>chr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> min<span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">(</span>end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                .N<span class=\"token punctuation\">,</span>\n                                mean<span class=\"token punctuation\">(</span>NC_cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                mean<span class=\"token punctuation\">(</span>TC_cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                mean<span class=\"token punctuation\">(</span>LT_cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                sum<span class=\"token punctuation\">(</span>NC_fraction <span class=\"token operator\">>=</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                sum<span class=\"token punctuation\">(</span>TC_fraction <span class=\"token operator\">>=</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                sum<span class=\"token punctuation\">(</span>LT_fraction <span class=\"token operator\">>=</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> by <span class=\"token operator\">=</span> .<span class=\"token punctuation\">(</span>cl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<blockquote>\n<p>Note that I have not find a way to dynamically set columns into function, that's why in above code, I have to write <code class=\"language-text\">sum(NC_fraction >= 0.75)</code>, <code class=\"language-text\">sum(NC_fraction >= 0.75)</code> ... one by one. I think there must be a way. I will udpate this part later.</p>\n</blockquote>\n<h2>3. Create new column</h2>\n<p>This is a very good feature. The <code class=\"language-text\">:=</code> operation do the job. Below example added one more column from just created string.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"peakID\"</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span> paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID_\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>nrow<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Below example added one more column by calculate mean position of a region (start and end).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CNT.dt[, \"pos\" := (start + end)/2]</code></pre></div>\n<h2>4. cbind two data.table</h2>\n<p>In below code, I selected couple columns from each data.table, and cbind them togather <strong>into a data frame</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">AvgPeaks.dt <span class=\"token operator\">&lt;-</span> cbind.data.frame<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"chrom\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_cnt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> with <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                Occupancy.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span> paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_ocp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_fraction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> with <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>If you want to merge two data.table into one data.table, \"key\" is a must thing for two data.tables. It seems you can specify one columns as key, but I think it's a good idea to always have a key in each data.table. So it's more similar to SQL table.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"peakID\"</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span> paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID_\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>nrow<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nOccupancy.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"peakID\"</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span> paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID_\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>nrow<span class=\"token punctuation\">(</span>Occupancy.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\nsetkey<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">,</span> peakID<span class=\"token punctuation\">)</span> <span class=\"token comment\"># Unexpectively, this step is a bit slow, take 20 seconds in my 39,065,425 matrix</span>\nsetkey<span class=\"token punctuation\">(</span>Occupancy.dt<span class=\"token punctuation\">,</span> peakID<span class=\"token punctuation\">)</span>\n\nAvgPeaks.dt <span class=\"token operator\">&lt;-</span> merge<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"chrom\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_cnt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> with <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                     Occupancy.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID\"</span><span class=\"token punctuation\">,</span>paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_ocp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  paste0<span class=\"token punctuation\">(</span>phenos<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_fraction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> with <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>5. Remove columns from data.table</h2>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"peakID\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>6: Row calculation</h2>\n<p>One limitation for data.table is to do row calculation. The way to do it (dynamically) is to subset columns, then do data.frame function, then added new created column(s) into data.table. The <strong>.SDcols</strong> and <strong>.SD</strong> are two reserved word, that will select only columns needed for calculation. Then the .SD is a normal data.frame for any action. For example, in my case, I select columns, then use matrxStats for row-Mean calculation.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">phenos <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LT\"</span><span class=\"token punctuation\">)</span>\n\nCNT.dt <span class=\"token operator\">&lt;-</span> setDT<span class=\"token punctuation\">(</span>CNT<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> phenos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message<span class=\"token punctuation\">(</span><span class=\"token string\">\"Averaging \"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> <span class=\"token string\">' ...'</span><span class=\"token punctuation\">)</span>\n    CNT.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_cnt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span>  matrixStats<span class=\"token operator\">::</span>rowMeans2<span class=\"token punctuation\">(</span>as.matrix<span class=\"token punctuation\">(</span>.SD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> .SDcols<span class=\"token operator\">=</span>grep<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>CNT.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\nOccupancy.dt <span class=\"token operator\">&lt;-</span> setDT<span class=\"token punctuation\">(</span>Occupancy<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> phenos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message<span class=\"token punctuation\">(</span><span class=\"token string\">\"Calculate Occupancy Fraction \"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> <span class=\"token string\">' ...'</span><span class=\"token punctuation\">)</span>\n    tmpN <span class=\"token operator\">&lt;-</span> length<span class=\"token punctuation\">(</span>grep<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>Occupancy.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    Occupancy.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_ocp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span>  matrixStats<span class=\"token operator\">::</span>rowSums2<span class=\"token punctuation\">(</span>as.matrix<span class=\"token punctuation\">(</span>.SD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> .SDcols<span class=\"token operator\">=</span>grep<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>Occupancy.dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    Occupancy.dt<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>paste0<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_fraction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span>  .SD<span class=\"token operator\">/</span>tmpN<span class=\"token punctuation\">,</span> .SDcols<span class=\"token operator\">=</span>paste0<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_ocp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>6: Update subset of column</h2>\n<p>This situation happen if I want to just update part of one column, for example only a column show TRUE or FALSE.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">tmpTable<span class=\"token punctuation\">[</span>strand <span class=\"token operator\">==</span> <span class=\"token string\">\"+\"</span><span class=\"token punctuation\">,</span> strand <span class=\"token operator\">:</span><span class=\"token operator\">=</span> <span class=\"token string\">\"F\"</span><span class=\"token punctuation\">]</span>\ntmpTable<span class=\"token punctuation\">[</span>strand <span class=\"token operator\">==</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> strand <span class=\"token operator\">:</span><span class=\"token operator\">=</span> <span class=\"token string\">\"R\"</span><span class=\"token punctuation\">]</span></code></pre></div>","frontmatter":{"date":"October 19, 2021","slug":"/notes/My-R-Data.Table-Quick-Code","title":"My R Data.Table Quick Code","tags":["R"],"abstract":"Finally I started to use Data.Table, it is really fast and cool. However, learning to use data.table is a bit similar to learn some key functions like aggregate .etc. Here I record a bit my key code."}}},"pageContext":{"slug":"/notes/My-R-Data.Table-Quick-Code"}},
    "staticQueryHashes": ["63159454"]}