{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/Nextflow:-nf-core-sarek",
    "result": {"data":{"markdownRemark":{"html":"<p>So <a href=\"https://www.nextflow.io/\">nextflow</a> is a tool to \"link\" various of software, to chain them up into a \"pipeline\", for data analysis. This is a definition and understanding from my side. It looks like this tools is specificaly designed for tasks like Bioinformatic, which relies on various of open source softwares, scripts, packages or libraries. Different software would create different output and require different input, so nextflow would \"arrange\" and \"link\" these input/output correctly.</p>\n<p>So, in theory, if I develop a nextflow pipeline, it should be able to run analysis on corresponding data smoothly. However, in practice, I guess it can't be that easy and softwares may upgrade, and a pipeline may need to be upgraded again and again...</p>\n<h2>1. Installation of nextflow</h2>\n<p>Anyway, firstly I need to install and try nextflow a bit, by following the here. It's super simple, just <strong>make sure I have java installed</strong>. Then type one command in the folder I want the nextflow installed. In my case, I put it in Software folder under my working directory, it's where I put all software I need for work.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s https://get.nextflow.io <span class=\"token operator\">|</span> <span class=\"token function\">bash</span></code></pre></div>\n<p>I know there are other ways like Github or Bioconda for installation, but I did not try them. Finally, I add the path of nextflow in my bash. The way to run test data is quite simple:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nextflow run hello</code></pre></div>\n<p>After typing this command, it looks nextflow will directly download file from internet, and start running. Well...then I need to figure out how to config input.</p>\n<blockquote>\n<p>Actually, a feature for nextflow I like is <code class=\"language-text\">resume</code>, which allow nextflow pipeline to rerun the modified or unfinished part, without rerun whole pipeline.</p>\n</blockquote>\n<h2>2. Run nf-core sarek</h2>\n<p>Apparently, someone would get the idea that they write \"perfect\" next-flow first, then publish it online for everyone to use. <a href=\"https://nf-co.re/\">nf-core</a> is exactly a platform for this. They provided a list (roughtly 50) nextflow pipeline for different bioinformatic data analysis, for example, sarek for WGS analysis, rnaseq fo RNA-seq analysis .etc</p>\n<p>In my work (UK Personal Genomic Project), I would start with WGS analysis, by using <a href=\"https://nf-co.re/sarek\">nf-core sarek</a> analysis. In the future, I may try other pipeline like WGBS, Methylation .etc Like the above test demo from nextflow, the way to run sarek is also just one command, so I guess the key thing here is to figure out input.</p>\n<h3>2.1. Create SampleSheet.tsv</h3>\n<p><a href=\"https://nf-co.re/sarek/2.7.1/usage\">The usage of nf-core sarek</a> is here. In theory, <strong>the only thing I should do it to create a tsv file</strong>, which is a tab separated normal file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ERR1726424  XY  <span class=\"token number\">0</span>   ERR1726424  group_1 /scratch1/Tian/PGP/1.DownloadWGS/WGS/ERR1726424_1.fastq.gz  /scratch1/Tian/PGP/1.DownloadWGS/WGS/ERR1726424_2.fastq.gz</code></pre></div>\n<p><b style=\"background-color: yellow\">Note that this file MUST be tab separated. And the fastq files can't be raw fastq format. For example, it must be .gz format, which should be arranged from initial download moment.</b></p>\n<h3>2.2. Modify docker profile</h3>\n<p>In theory, nf-core sarek run on docker or other contianer softwares. However, after tailed couple times trying and help from collegue, I know I need to add come extra line on the default profile config file located at <code class=\"language-text\">~/.nextflow/assets/nf-core/sarek/conf</code>. Add below lines at the bottom:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker {\n  enabled = true\n  runOptions = \" -v /scratch1/Tian/PGP/2.Sarek:/scratch1/Tian/PGP/2.Sarek\"\n}</code></pre></div>\n<p>Sadly now I don't know why just add the directory to docker.</p>\n<h3>2.3. Run nf-core command</h3>\n<p>Finally, below command could trigger sarek <strong>for the first step</strong>. There are some parameters can be used to accelerate like:</p>\n<ul>\n<li><code class=\"language-text\">--cpus</code> as number of CpGs.</li>\n<li><code class=\"language-text\">-resume</code> to restart unfinished pipeline.</li>\n<li><code class=\"language-text\">--single_cpu_mem</code>, each CpG's memory. For example 456.GB.</li>\n<li><code class=\"language-text\">--max_memory</code>, total memory size. For example 1900.GB.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nextflow run nf-core/sarek --input SampleSheet.tsv -profile <span class=\"token function\">docker</span> --cpus <span class=\"token number\">30</span></code></pre></div>\n<p>It works for me, it took me 15h 55m to finish just one WGS data. Well, at least it's a good start. Out of my expectation, this is just the first step, for the rest, we should step-by-step run other steps. For example, the second step is to do variant calling.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nextflow run nf-core/sarek --input /scratch1/Tian/PGP/2.Sarek/results/Preprocessing/TSV/recalibrated.tsv -profile <span class=\"token function\">docker</span> -resume --step variant_calling --cpus <span class=\"token number\">30</span> --tools <span class=\"token string\">'HaplotypeCaller,Manta,Strelka'</span></code></pre></div>\n<p>After above command, vcf files are generated in different folder in Variant folder. Final step is to annotate them with below command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nextflow run nf-core/sarek --input <span class=\"token string\">\"results/VariantCalling/*/{HaplotypeCaller,Manta,Strelka}/*.vcf.gz\"</span> -profile <span class=\"token function\">docker</span> -resume --step annotate --tools merge --cpus <span class=\"token number\">30</span></code></pre></div>\n<p>That's it, these are commands can be used to run nf-core sarek. It contains so much software/steps that I should spend time to check on them.</p>","frontmatter":{"date":"January 27, 2022","slug":"/notes/Nextflow:-nf-core-sarek","title":"Nextflow: nf-core sarek","tags":["nextflow","WGS"],"abstract":"For many years I want to learn nextflow, never got a chance, now it is time. My task it to run nf-core sarek on PGP-UK WGS/WES data. Also it is my first time try to call SNP information out of WGS data."}}},"pageContext":{"slug":"/notes/Nextflow:-nf-core-sarek"}},
    "staticQueryHashes": ["63159454"]}