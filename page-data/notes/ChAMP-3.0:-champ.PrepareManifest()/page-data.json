{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/ChAMP-3.0:-champ.PrepareManifest()",
    "result": {"data":{"markdownRemark":{"html":"<p>After years of maintain of ChAMP, I am tired of changing manifest over and over again. So here I formated a bit my previous function to automatically preprocess raw manifest downloaded from illumina. For example, the EPIC array manifest is <a href=\"https://emea.support.illumina.com/array/array_kits/infinium-methylationepic-beadchip-kit/downloads.html\">here</a>. And mouse manifest is <a href=\"https://emea.support.illumina.com/array/array_kits/infinium-mouse-methylation-beadchip-kit/downloads.html\">here</a>.</p>\n<p>Manifest is the most important file for DNA methylation array research, as it provided mapping information between probes to CpGs. However, those information are not well organised, that I need to read them into R, format a bit, generate a object called <code class=\"language-text\">probeInfo</code> for future IDAT file loading usage. <a href=\"https://github.com/YuanTian1991/ChAMPLite/blob/master/R/champ.PrepareManifest.R\">champ.PrepareManifest()</a> is a function will be used in the future to do this work, even if illumina release more and more manifest, it should be able to handle them.</p>\n<hr>\n<h2>Function Usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">myManifest <span class=\"token operator\">&lt;-</span> champ.PrepareManifest<span class=\"token punctuation\">(</span>manifestPath<span class=\"token operator\">=</span><span class=\"token string\">\"./infinium-methylationepic-v-1-0-b5-manifest-file.csv\"</span><span class=\"token punctuation\">,</span> skip<span class=\"token operator\">=</span><span class=\"token string\">'auto'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>Parameters:</em></p>\n<ul>\n<li>\n<p><strong>manifestPath</strong>: path to illumina raw manifest. It can be used for online file, for example <a href=\"https://s3.eu-west-1.wasabisys.com/tian-champ-manifest/IlluminaManifest/infinium-methylationepic-v-1-0-b5-manifest-file.csv\">EPIC_B5</a>, <a href=\"https://s3.eu-west-1.wasabisys.com/tian-champ-manifest/IlluminaManifest/MouseMethylation-12v1-0_A2.csv\">Mouse_v2</a> and <a href=\"https://s3.eu-west-1.wasabisys.com/tian-champ-manifest/IlluminaManifest/humanmethylation450_15017482_v1-2.csv\">450K</a>, these are three manifest I downloaded and uploaded to S3 service, convinient for download or directly loading.</p>\n</li>\n<li>\n<p><strong>skip</strong>: Illumina version manifest contains a lot of extra information. They key information is stored after [Assay] and [Controls]. This function will automatically identify lines of these two markers, and read correct information between them. However, user may also identify their own skip lines, for example if you are using customed manifest. This value must be \"auto\", or a two length integer array like <code class=\"language-text\">c(7, 865927)</code>.</p>\n</li>\n</ul>\n<p><em>Outputs:</em></p>\n<ul>\n<li>\n<p><strong>probeInfo</strong>: A data frame contains colour channel, probe information for each CpG, will be used in champ.import() or champ.load() to extract methylated/unmethylated information.</p>\n</li>\n<li>\n<p><strong>controlProbes</strong>: A data frame contains all control probes, which will be used in future quality check, detected P value generation .etc.</p>\n</li>\n</ul>\n<hr>\n<p>In theory this function support customed manifest. The manifest must contain following columns: \"IlmnID\", \"AddressA_ID\", \"AddressB_ID\", \"Infinium_Design_Type\", \"Color_Channel\". <strong>If there is no control probes, just set skip parameter as c(0,0)</strong>.</p>\n<p>Actually, the manifest contains much more information than above columns, but they are mostly CpG's annotation, like what genes they are related, if they are SNPs .etc. The complete column explaination can be found <a href=\"https://emea.support.illumina.com/content/dam/illumina-support/documents/downloads/productfiles/methylationepic/infinium-methylationepic-manifest-column-headings.pdf\">here</a>. We will process these information later in other functions, or directly use other annotations for array analysis, like <a href=\"https://zwdzwd.github.io/InfiniumAnnotation\">this one</a> recommanded by illumina staff.</p>\n<h2>1. Convert probe information.</h2>\n<p>In the manifest, there are two parts, one is CpG information, and the other is Control probes. Firstly, champ.PrepareManifest() will parse probe-2-CpG information. Importantly, DNA methylation array contains 2 types of probes, Type-II and Type-I. They are using different design to capture CpG information from DNA. Even, there are two types of Type-I probes, one is based on Red channel, and the other is based on Green chanel. Thus, to prepare probe information, these 3 types of CpGs need to be separately preprocessed.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 922px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d55ee9f3cdfb3a9bd4deee521830351/6da96/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz1WRW4/SUBSF+SM6GqBAL7Q97TktpS0FBii3CsKMzmRmnGA0Jr6Z+OKf/8w5+OLDl72ys7PWSnbr/OmFu4cv3D++cjg9sm6O7M8HdifN0cz9+TrrpmF92LH5uGN9aAx1c2S1PTFd7vn1+w+t5eZAVsyZLrbMljumy5pZvWZW11TLFZPFgsnyFqEUscpIKoWcSAKVYAeC9sCjY/u8aQ9MqVZRrahuN9Q7nbJFFiOcMGaoItxY4IgYT4Y4UYAXKfxEMlSSII3xIokdCjwp6PkeT6/fadl+Qt/TiQVBUuKFGZ4Y4/gjXK3DDDe44vip2dl+SteOsDROTM+VvOsOeXj+Smu22CLTkkJNyVSFVDnZeE6sctJ8hsoqQ5yW5k5roXL6boTlarPIFHpv/TPUD2k+3DO+UYw6KUM7ZtiN8b2EUOV0+gGWLbAcgS9GWE5k9MDTZlf+M3y5/GDX3FG8TRi3RwwH2lAaQ5GUdAahMenawjTTrbTuOcLMrgmLuOm4fH660Fo3Z/PdPKjIxRSpSuK4RCYVST4nkAWhKglVgcqmJkRrYXZXomSCG6Rcvv3kL36WDcT+iBkaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Three types of CpG\"\n        title=\"Three types of CpG\"\n        src=\"/static/7d55ee9f3cdfb3a9bd4deee521830351/6da96/figure1.png\"\n        srcset=\"/static/7d55ee9f3cdfb3a9bd4deee521830351/63868/figure1.png 250w,\n/static/7d55ee9f3cdfb3a9bd4deee521830351/0b533/figure1.png 500w,\n/static/7d55ee9f3cdfb3a9bd4deee521830351/6da96/figure1.png 922w\"\n        sizes=\"(max-width: 922px) 100vw, 922px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>1.1. Type-II Probe to CpG mapping</h3>\n<p>We can see that for Type-II CpG (cg07881041) above, there is only a AddressA_ID, which means for Type-II CpG, there is only one probe (AddressA_ID) designed to attach both methylation and unmethylation CpG. Different methylation status will be reflected in colour channel. More specifically, <strong>AddressA_ID in Red Chanel = Unmethylated, AddressA_ID in Green Chanel = methylated</strong>.</p>\n<p>Thus, for Type-II probes, I create index <code class=\"language-text\">G-0085713262</code> to indicate the methylation status of CpG cg07881041. Vise-versa, <code class=\"language-text\">R-0085713262</code> indicates unmethylation status for this CpG.</p>\n<h3>1.2. Type-I Probe to CpG mapping</h3>\n<p>As we can see, in above manifest, for Type-I CpGs, there is a colour-channel labelled. cg18478105 is labelled Grn, while cg09835024 is labelled Red. According to <a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5389466/\">some paper</a>, this is because \"colour channels of Type I probes are entirely dependent on the extension base, A and T bases are both labeled with red and C (complementary to G) is labeled with green fluorophores.\"</p>\n<blockquote>\n<p>I don't quite understand this, since for a long time, I think array probe only estimate T (unmethylated CpG, will be bisulfite-converted to T) or C (methylated CpG, will not be bisulfite-converted, remain as C). So in this case, I think just one colour possibility should exist. However, according to the author, actually, Type-I probe may integrate with A, T, or C.</p>\n</blockquote>\n<p>But anyway, for Type-I probe, both methylated and unmethylated signals are reflected by same colour, but in different probes (AddressA_ID and AddressB_ID). Below is my organised Colour-Probe information. <code class=\"language-text\">mIndex</code> represent methylated signal for each CpG. And <code class=\"language-text\">uIndex</code> represent unmethylated signal for each CpG.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">    mIndex <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span> typeII<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span> typeIRed<span class=\"token operator\">$</span>AddressB_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span> typeIGrn<span class=\"token operator\">$</span>AddressB_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    uIndex <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span> typeII<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span> typeIRed<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span> typeIGrn<span class=\"token operator\">$</span>AddressA_ID<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>After organising, eventually champ.PrepareManifest() will return an object as this:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> head<span class=\"token punctuation\">(</span>myManifest<span class=\"token operator\">$</span>probeInfo<span class=\"token punctuation\">)</span>\n                  CpG     mIndex     uIndex channel\ncg07881041 cg07881041 G<span class=\"token operator\">-</span><span class=\"token number\">85713262</span> R<span class=\"token operator\">-</span><span class=\"token number\">85713262</span>     g<span class=\"token operator\">+</span>r\ncg23229610 cg23229610 G<span class=\"token operator\">-</span><span class=\"token number\">21717843</span> R<span class=\"token operator\">-</span><span class=\"token number\">21717843</span>     g<span class=\"token operator\">+</span>r\ncg03513874 cg03513874 G<span class=\"token operator\">-</span><span class=\"token number\">29622133</span> R<span class=\"token operator\">-</span><span class=\"token number\">29622133</span>     g<span class=\"token operator\">+</span>r\ncg05451842 cg05451842 G<span class=\"token operator\">-</span><span class=\"token number\">16681196</span> R<span class=\"token operator\">-</span><span class=\"token number\">16681196</span>     g<span class=\"token operator\">+</span>r\ncg14797042 cg14797042  G<span class=\"token operator\">-</span><span class=\"token number\">7767973</span>  R<span class=\"token operator\">-</span><span class=\"token number\">7767973</span>     g<span class=\"token operator\">+</span>r\ncg09838562 cg09838562 G<span class=\"token operator\">-</span><span class=\"token number\">25809572</span> R<span class=\"token operator\">-</span><span class=\"token number\">25809572</span>     g<span class=\"token operator\">+</span>r\n<span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>myManifest<span class=\"token operator\">$</span>probeInfo<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">865918</span>      <span class=\"token number\">4</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>This is much simpler version of data.frame, with all three information (CpG name, Colour channel, and Probe) organised. Totally there are 865918 CpGs in EPIC array, without any filtering.</p>\n<h2>2. Prepare Control Probe samples.</h2>\n<p>Finally, this function will also extract all control probes in manifest, which will be used in future quality control steps.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> head<span class=\"token punctuation\">(</span>myManifest<span class=\"token operator\">$</span>controlProbes<span class=\"token punctuation\">)</span>\n     probe     type colour         value\n<span class=\"token number\">1</span> <span class=\"token number\">21630339</span> STAINING    <span class=\"token operator\">-</span><span class=\"token number\">99</span>      DNP<span class=\"token punctuation\">(</span><span class=\"token number\">20</span>K<span class=\"token punctuation\">)</span>\n<span class=\"token number\">2</span> <span class=\"token number\">24669308</span> STAINING    <span class=\"token operator\">-</span><span class=\"token number\">99</span>    Biotin<span class=\"token punctuation\">(</span><span class=\"token number\">5</span>K<span class=\"token punctuation\">)</span>\n<span class=\"token number\">3</span> <span class=\"token number\">27630314</span> STAINING    Red    DNP <span class=\"token punctuation\">(</span>High<span class=\"token punctuation\">)</span>\n<span class=\"token number\">4</span> <span class=\"token number\">34648333</span> STAINING   Blue  Biotin <span class=\"token punctuation\">(</span>Bkg<span class=\"token punctuation\">)</span>\n<span class=\"token number\">5</span> <span class=\"token number\">41666334</span> STAINING  Green Biotin <span class=\"token punctuation\">(</span>High<span class=\"token punctuation\">)</span>\n<span class=\"token number\">6</span> <span class=\"token number\">43603326</span> STAINING Purple     DNP <span class=\"token punctuation\">(</span>Bkg<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>myManifest<span class=\"token operator\">$</span>controlProbes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">635</span>   <span class=\"token number\">4</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>In methylation array, there are many types of control probes:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>myManifest<span class=\"token operator\">$</span>controlProbes<span class=\"token operator\">$</span>type<span class=\"token punctuation\">)</span>\n\n BISULFITE CONVERSION I BISULFITE CONVERSION II               EXTENSION\n                     <span class=\"token number\">10</span>                       <span class=\"token number\">4</span>                       <span class=\"token number\">4</span>\n          HYBRIDIZATION                NEGATIVE         NON<span class=\"token operator\">-</span>POLYMORPHIC\n                      <span class=\"token number\">3</span>                     <span class=\"token number\">411</span>                       <span class=\"token number\">9</span>\n                 NORM_A                  NORM_C                  NORM_G\n                     <span class=\"token number\">27</span>                      <span class=\"token number\">58</span>                      <span class=\"token number\">27</span>\n                 NORM_T             RESTORATION           SPECIFICITY I\n                     <span class=\"token number\">58</span>                       <span class=\"token number\">1</span>                      <span class=\"token number\">12</span>\n         SPECIFICITY II                STAINING          TARGET REMOVAL\n                      <span class=\"token number\">3</span>                       <span class=\"token number\">6</span>                       <span class=\"token number\">2</span></code></pre></div>","frontmatter":{"date":"February 06, 2022","slug":"/notes/ChAMP-3.0:-champ.PrepareManifest()","title":"ChAMP 3.0: champ.PrepareManifest()","tags":["ChAMP"],"abstract":"A new function added to ChAMP family, champ.PrepareManifest() will read into raw illumina manifest (or custom ones) to create ChAMP readable probe-2-CpG mapping information."}}},"pageContext":{"slug":"/notes/ChAMP-3.0:-champ.PrepareManifest()"}},
    "staticQueryHashes": ["63159454"]}