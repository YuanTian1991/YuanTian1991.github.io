{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/Modify-Image-exif-Information",
    "result": {"data":{"markdownRemark":{"html":"<p>In the last day of 2021, a year seems many thing happened to me but seem nothing accomplished eventually, I made a website for my lovely doggy Mountain. When I am organising the photos from mobile phone and camera, I noticed all photoes from my camera have a wrong time stamp. For example, I just quickly took a photo last night, and it shows the modified time is 22 October 2019 at 11:34, roughtly 2 years ago.</p>\n<p>So, I need to find way to: Fistly read all image's <code class=\"language-text\">mtime</code>, which exist in image's <a href=\"https://en.wikipedia.org/wiki/Exif\">exif</a> meta information. Then, re-calculate the correct time, the idea is use the last photo I took as a comparison. Third, find a way to \"modify\" the timestamp for each image ago. And since I am good at R, I am thinking if I can find a R solution for it.</p>\n<h2>1. Read Exif information from Image</h2>\n<p>Firstly I found I can use pacakge exiftoolr to read exif information from images. After installation, the package need to be loaded like:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span>exiftoolr<span class=\"token punctuation\">)</span>\ninstall_exiftool<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then the information can be extracted as:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">images <span class=\"token operator\">&lt;-</span> dir<span class=\"token punctuation\">(</span><span class=\"token string\">\"./Cannon/\"</span><span class=\"token punctuation\">,</span> full.names<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span>\n\ndat <span class=\"token operator\">&lt;-</span> exif_read<span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span>\ntimeStamp <span class=\"token operator\">&lt;-</span> dat<span class=\"token operator\">$</span>CreateDate</code></pre></div>\n<h2>2. Convert between date and unix time</h2>\n<p>Then I need to convert the date back to unix time, add up the \"missing time gap\". The way to convert date to unix time is:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">dates <span class=\"token operator\">&lt;-</span> unname<span class=\"token punctuation\">(</span>sapply<span class=\"token punctuation\">(</span>timeStamp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> strsplit<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> split<span class=\"token operator\">=</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ntimes <span class=\"token operator\">&lt;-</span> unname<span class=\"token punctuation\">(</span>sapply<span class=\"token punctuation\">(</span>timeStamp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> strsplit<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> split<span class=\"token operator\">=</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ndates <span class=\"token operator\">&lt;-</span> gsub<span class=\"token punctuation\">(</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> dates<span class=\"token punctuation\">)</span>\n\nuTime <span class=\"token operator\">&lt;-</span> as.numeric<span class=\"token punctuation\">(</span>as.POSIXct<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span>dates<span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ngap <span class=\"token operator\">&lt;-</span> <span class=\"token number\">1640912569</span> <span class=\"token operator\">-</span> max<span class=\"token punctuation\">(</span>uTime<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The <code class=\"language-text\">gap</code> is the time for the last image I took last night, so I know the exact date and time, which is the unix time 1640912569, since the timestamp for the origin photo is 2019-10-something. I can calculate the gap between real time and the delay of my camera. Finally, convert the unix time back to date:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"lubridate\"</span><span class=\"token punctuation\">)</span>\nnewDate <span class=\"token operator\">&lt;-</span> as_datetime<span class=\"token punctuation\">(</span>uTime <span class=\"token operator\">+</span> gap<span class=\"token punctuation\">)</span>\nnewDate <span class=\"token operator\">&lt;-</span> substr<span class=\"token punctuation\">(</span>newDate<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>3. Modify exif information</h2>\n<p>Finally, I find a way to modify the JPG information. The solution is <code class=\"language-text\">exiftool</code>, thanks for this <a href=\"https://stackoverflow.com/questions/53926085/how-to-change-media-created-date-in-exiftool\">post</a>. I use linux software to do it, by use R to execute linux command.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"glue\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>length<span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cmd <span class=\"token operator\">&lt;-</span> glue<span class=\"token punctuation\">(</span><span class=\"token string\">\"exiftool \\\"-CreateDate={newDate[i]}\\\" -overwrite_original {images[i]}\"</span><span class=\"token punctuation\">)</span>\n    message<span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">)</span>\n    system<span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>","frontmatter":{"date":"December 31, 2021","slug":"/notes/Modify-Image-exif-Information","title":"Modify Image exif Information","tags":["R"],"abstract":"In the last day of 2021, I made a website for my lovely doggy Mountain. However, when I am organising his two-year ranges photos, I noticed all images from my camera time are all wrong. So I tried to solve it a bit, re-annotated image timestamp."}}},"pageContext":{"slug":"/notes/Modify-Image-exif-Information"}},
    "staticQueryHashes": ["63159454"]}