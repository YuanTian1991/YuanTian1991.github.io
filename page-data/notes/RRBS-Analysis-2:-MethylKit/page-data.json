{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/RRBS-Analysis-2:-MethylKit",
    "result": {"data":{"markdownRemark":{"html":"<p>Following in the last document, now what I want to do is to load the preprocessed BAM files into R session, a recommended software is <a href=\"https://www.bioconductor.org/packages/release/bioc/html/methylKit.html\">MethylKit</a>. After a set of actions, the final bam file for each sample looks like below. The folder is in <strong>RRBS-pipeline/1.Preprocess/NUDUP/Ready:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token constant\">RRBS</span><span class=\"token operator\">-</span>pipeline<span class=\"token operator\">/</span><span class=\"token number\">1.</span>Preprocess<span class=\"token operator\">/</span><span class=\"token constant\">NUDUP</span><span class=\"token operator\">/</span>Ready$ ls\nBc<span class=\"token operator\">-</span><span class=\"token number\">01</span>_S1<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam  Bc<span class=\"token operator\">-</span><span class=\"token number\">03</span>_S3<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam  Bc<span class=\"token operator\">-</span><span class=\"token number\">05</span>_S5<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam\nBc<span class=\"token operator\">-</span><span class=\"token number\">02</span>_S2<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam  Bc<span class=\"token operator\">-</span><span class=\"token number\">04</span>_S4<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam  Bc<span class=\"token operator\">-</span><span class=\"token number\">06</span>_S6<span class=\"token punctuation\">.</span>sorted<span class=\"token punctuation\">.</span>dedup<span class=\"token punctuation\">.</span>bam</code></pre></div>\n<h2>1. Process Bismark Alignment Result</h2>\n<p>According to methylkit package manual, the first step we should do it process Bismark results, since Bismark only do alignment work, so the function <code class=\"language-text\">processBismarkAln</code> is designed to call CpG's methylation value from these bam file. It would return the results of each sample in a format as <code class=\"language-text\">XXX_cpg.txt</code> format. Below is a script is written do apply this function.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"># Script to run processBismarkAln\n<span class=\"token function\">library</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"methylKit\"</span><span class=\"token punctuation\">)</span>\n\ndirectory <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token string\">\"../1.Preprocess/NUDUP/Ready/\"</span>\n\nfiles <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token function\">dir</span><span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span>\n\n# This line is only used to extract Sample Name<span class=\"token punctuation\">.</span>\nfile<span class=\"token punctuation\">.</span>name <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token keyword\">as</span><span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token function\">unname</span><span class=\"token punctuation\">(</span><span class=\"token function\">sapply</span><span class=\"token punctuation\">(</span>files<span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token function\">strsplit</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>split<span class=\"token operator\">=</span><span class=\"token string\">\"_\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nfiles <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token keyword\">as</span><span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token function\">paste</span><span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">,</span>files<span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Processing Bismark Alignment...\"</span><span class=\"token punctuation\">)</span>\nmy<span class=\"token punctuation\">.</span>methRaw<span class=\"token operator\">=</span><span class=\"token function\">processBismarkAln</span><span class=\"token punctuation\">(</span>location<span class=\"token operator\">=</span>files<span class=\"token punctuation\">,</span>\n                             sample<span class=\"token punctuation\">.</span>id<span class=\"token operator\">=</span>file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n                             assembly<span class=\"token operator\">=</span><span class=\"token string\">\"danRer11\"</span><span class=\"token punctuation\">,</span>\n                             save<span class=\"token punctuation\">.</span>context<span class=\"token operator\">=</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>\n                             read<span class=\"token punctuation\">.</span>context<span class=\"token operator\">=</span><span class=\"token string\">\"CpG\"</span><span class=\"token punctuation\">,</span>\n                             mincov<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n                             minqual<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n                             treatment<span class=\"token operator\">=</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                             save<span class=\"token punctuation\">.</span>folder<span class=\"token operator\">=</span><span class=\"token string\">\"./\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Above script would take some time, roughly 1 hour for 6 samples. Then for each sample, a cpg.txt file would be generated. I remember GemBS software also would generate this kind of file, which means if I use GemBS file, I can directly input it into Methylkit for future analysis. Also, in above script, I applied some parameter, like <code class=\"language-text\">mincov=10</code>, and <code class=\"language-text\">minqual=20</code>. These are default settings from the software manual.</p>\n<p>These cpg.txt loos like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">Bc<span class=\"token operator\">-</span><span class=\"token number\">01</span>_CpG.txt\nchrBase chr base    strand  coverage    freqC   freqT\n<span class=\"token number\">1.1110</span>  <span class=\"token number\">1</span>   <span class=\"token number\">1110</span>    F   <span class=\"token number\">40</span>  <span class=\"token number\">97.50</span>   <span class=\"token number\">2.50</span>\n<span class=\"token number\">1.1167</span>  <span class=\"token number\">1</span>   <span class=\"token number\">1167</span>    R   <span class=\"token number\">78</span>  <span class=\"token number\">87.18</span>   <span class=\"token number\">12.82</span>\n<span class=\"token number\">1.11585</span> <span class=\"token number\">1</span>   <span class=\"token number\">11585</span>   F   <span class=\"token number\">12</span>  <span class=\"token number\">0.00</span>    <span class=\"token number\">100.00</span>\n<span class=\"token number\">1.11603</span> <span class=\"token number\">1</span>   <span class=\"token number\">11603</span>   F   <span class=\"token number\">12</span>  <span class=\"token number\">0.00</span>    <span class=\"token number\">100.00</span>\n<span class=\"token number\">1.11621</span> <span class=\"token number\">1</span>   <span class=\"token number\">11621</span>   F   <span class=\"token number\">12</span>  <span class=\"token number\">0.00</span>    <span class=\"token number\">100.00</span></code></pre></div>\n<h2>2. Read CpG</h2>\n<p>After CpG calling, then we can try read them all into R session, to form an matrix for downstream analysis. This part of code is:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">message<span class=\"token punctuation\">(</span><span class=\"token string\">\"Reading CpG into R with methylKit...\"</span><span class=\"token punctuation\">)</span>\nCpGFiles <span class=\"token operator\">&lt;-</span> as.list<span class=\"token punctuation\">(</span>paste<span class=\"token punctuation\">(</span><span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>unlist<span class=\"token punctuation\">(</span>file.name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"_CpG.txt\"</span><span class=\"token punctuation\">,</span>sep<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nsampleName <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"WildType_1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"WildType_2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"WildType_3\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mutation_1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mutation_2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mutation_3\"</span><span class=\"token punctuation\">)</span>\n\nmyobj <span class=\"token operator\">&lt;-</span> methRead<span class=\"token punctuation\">(</span>CpGFiles<span class=\"token punctuation\">,</span>\n                  sample.id<span class=\"token operator\">=</span> as.list<span class=\"token punctuation\">(</span>sampleName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  assembly<span class=\"token operator\">=</span><span class=\"token string\">\"danRer11\"</span><span class=\"token punctuation\">,</span>\n                  treatment<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  context<span class=\"token operator\">=</span><span class=\"token string\">\"CpG\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>One amazing part for MethylKit is that we don't need to prepare reference genome ourselves. In above code, the sampleName is important. <strong>And <code class=\"language-text\">treatment</code> parameter indicates case/control status, which is quite important and will be used across the whole project</strong>.</p>\n<h2>3. Density Plot and Coverage Plot</h2>\n<p>This step is similar to QC plot check in methylation array, here I plotted the density histogram for these samples. MethylKit provided a function to do so:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">par<span class=\"token punctuation\">(</span>mfrow<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>length<span class=\"token punctuation\">(</span>myobj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> getMethylationStats<span class=\"token punctuation\">(</span>myobj<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>plot<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span>both.strands<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c91934884992fe5c44dd8c4c9a260b0d/5f7fb/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8UlEQVQoz2WSS2/UMBSF88sRP4EVm64q2IAEi7IoKhuoKoqEELTVAH3ODDNNZhwnTiYvP2J/KJm24nE2Vz7Hvtc+x1EIAe89SiniOGazKWm1o+3syPd9T5qmo9a27agZY/EhoLUmSRKEEBhj0LYnMkZzj773Yz08K7hY1BDMgzY0H/D2c4ZUNXi35UMYa6M9HycFUa5Ker8lw93hveOMybSkqhtCeOiJ6z277wSrtEBkNX9CKM2LDxnR+VwxSzb0zmKsRWQVj3ZnTFcdJ5cZxaZBa4N3hsMTyePnCzZ1x6eJxFpL22mc1Tw7uGVnXxA1nUXIApnlxMmam4XkYlHiXE9RdQipWAvJIhYMw+ermhA8UjWkUpGsBPOl4PtUIfKOyPt+vHJdV6SpwOh2XBvrHkwoCjUGE7zdPt31d547pJQUSg1uMvSKmqblPun7jTdxw3XcEHozmt7fpT3sOzpTZEWL793o78APg4vKcvAlJ6qqin/x/rRkMi3wTv+nvTrKWMsSZ+1ffFoYXh7mRDfLnDitcdbQaUPbdjzdW3Idt/yc5WyqdgzFOcvVsuTJ61uKTcvX820oTashWN4cr9nZXxMNxq9SRa4GnzLmt5Jvl/n4sVNVI2Q+BpbKjPNZxo9ZibWORJRbPs1YiYzTq4xf64bfExD5V7Tv8LMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Density Histgram\"\n        title=\"Density Histgram\"\n        src=\"/static/c91934884992fe5c44dd8c4c9a260b0d/00d43/figure1.png\"\n        srcset=\"/static/c91934884992fe5c44dd8c4c9a260b0d/63868/figure1.png 250w,\n/static/c91934884992fe5c44dd8c4c9a260b0d/0b533/figure1.png 500w,\n/static/c91934884992fe5c44dd8c4c9a260b0d/00d43/figure1.png 1000w,\n/static/c91934884992fe5c44dd8c4c9a260b0d/aa440/figure1.png 1500w,\n/static/c91934884992fe5c44dd8c4c9a260b0d/5f7fb/figure1.png 1889w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>According to above plot, it seems the density plot looks very good, it shows the two peak I have been looking for. <strong>This is possiblly the most convinient function to check density plot for RRBS/WGBS data</strong>. Simiarly, I can get coverage plot:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/247df404dbe2d96f66831b4d3cf403fd/5f7fb/figure2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJ0lEQVQoz01SS2sTURS+2/4FV7pUENxY0I3QhYhLFy5c6EZQurEiRd0oGrFg0U3FFxihIkgXLbpIMS0mBEPio8RHzcPHUNNkmmYmcR53MjN37swn92Yy9cDl3Dkfd875vu+QgUcRcB+GaaDdboNSChFRFGHgOQgCDl3XoaoqfN+XGA85OOcIeQR1S0W320UYhhIjxe8ZFKpL8iPgTOYwGoKLxYe4tXBa/lycUXAeIr1yE7qlJs1HmeQ+L+LU3B7Umh/jYogw4vL+6M1VHLlOQF3rv0YRogA493gcFSUf13nSjKz9zOHQNYJjM2P4oryTRc93ZX6en8GBaYL06g0EjIMFDAEPJDaVnsCFpxPQ/m5J+gITmdCBifrmGiq/CqgpFZiGCcdxIFjoZgfrG2V8qufRbG/AMi143rBZc/sHxDDV3xWpsW3b8DwPROghqTJA13pwXTfRQ3QU4dguNE0Hj6dL9IwAo2+i3+/tUP6qlJB6eQZtXRnqEXJ5RLzIzaJUy8i7z7zYnOEAC4U5zC6dj03iiXGkXM1i7xTBvdeTifCjRw+WL+PEnV2wHTMxTIwVMmDyyWEcTY3BYzEjRDumjF8hOHl3NyxqyJUYmTL/9jb2XSQ4e/8gesa2xFgw3MXp+ePYf4ng2WoKwmSf+XIXiUl7+NBYQbmeRavzB7ZFYdmWNKWlKXhfz6Lw7RWUVgPUduTii0EbmxWUassormfQ1TqgNgVjPv4BxT/Oma789i0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Coverage Plot\"\n        title=\"Coverage Plot\"\n        src=\"/static/247df404dbe2d96f66831b4d3cf403fd/00d43/figure2.png\"\n        srcset=\"/static/247df404dbe2d96f66831b4d3cf403fd/63868/figure2.png 250w,\n/static/247df404dbe2d96f66831b4d3cf403fd/0b533/figure2.png 500w,\n/static/247df404dbe2d96f66831b4d3cf403fd/00d43/figure2.png 1000w,\n/static/247df404dbe2d96f66831b4d3cf403fd/aa440/figure2.png 1500w,\n/static/247df404dbe2d96f66831b4d3cf403fd/5f7fb/figure2.png 1889w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>4. Coverage Filtering and Normalisation</h2>\n<p>This step is important, it will filter CpGs with too low coverage (below 10), or redicularsly high (based on a null distribution). And normalisation would be apply afterward to across all samples to removed bias. The code is below:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">message<span class=\"token punctuation\">(</span><span class=\"token string\">\"Filtering Coverage\"</span><span class=\"token punctuation\">)</span>\nfiltered.myobj <span class=\"token operator\">&lt;-</span> filterByCoverage<span class=\"token punctuation\">(</span>myobj<span class=\"token punctuation\">,</span>lo.count<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>lo.perc<span class=\"token operator\">=</span><span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span> hi.count<span class=\"token operator\">=</span><span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>hi.perc<span class=\"token operator\">=</span><span class=\"token number\">99.9</span><span class=\"token punctuation\">)</span>\nfiltered.normed.myobj <span class=\"token operator\">&lt;-</span> normalizeCoverage<span class=\"token punctuation\">(</span>filtered.myobj<span class=\"token punctuation\">)</span></code></pre></div>\n<p>After filtering, I tried to plot the coverage again, clearly some very high coverage bases are removed. This step is important, otherwise the comparision analysis later would be hugely biased.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6c7f269b978643b825aa63d4b8a0d9e2/5f7fb/figure3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQoz12S3UtTcRjHf0E3EdF9/RHdVGZFKCgh4k3RXbddRUVEoaiMsNCEKKGrbso0CSqQGpnpAhVdc9NCNufc1kqPa823nbN5tp23T5xz1oF6+MED3+f5Pi/f5yfUyh6aXkGWZSRpnVKphG2maTp+Ty2ykd0gm81SrVb5a0W1QLmiksvlyOfzXr5Yz6cZme73Ei0sxxuGjqnDvTeXeTrR4WKmjmm5xNezA4STn2q44XItC5GSolx8eIQB/3V+70q1oib2i2ZC1HUJLj0+iqZrLtnSnZid3z7Syv8m5hOTnPUJTnUJWnsPM744TG0Ihqd6qe8WNPQIHr2/Sn5nA8Nwp7kz1EJjzz7GFgZRSjK6rjtri6IqsyItEP0eIhSfZCkdRCkq9phsyVniaxEHC8bGSUsxT8f1zSRLmTnm4wHSawkURUHTNIS9t2M6qLKOoZmeHk7MgvKexu62TE1ePA6ws1VALiie9iL2Y57uVxfoH73idHRqG65eS5lZ2ofb0DXjH9xebyb6jvaXbQz4r3kHc44SXB6j3ic42S1o6TvIihRxWxvwNT3F8U7BrRdN5HbWvH+gVy1uPm/kWIeg9cEhdov52uQmIpIMcO6uoOn+fk502eRmypVy7Sh91HUKTvsEzT0HeDv3BMt0Zbg9dN7Bz/gEN541kPkVd49SKG0TSQUIr04QXp0kuDJGdvOnU1DaTPEl8ZGF5Gdml/3MxT8gFwtOLCEtEkqME14NMB0b5VtqhnJZ5Q8AlK1w3yXDkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Filtered &amp; Normalised Coverage Plot\"\n        title=\"Filtered &amp; Normalised Coverage Plot\"\n        src=\"/static/6c7f269b978643b825aa63d4b8a0d9e2/00d43/figure3.png\"\n        srcset=\"/static/6c7f269b978643b825aa63d4b8a0d9e2/63868/figure3.png 250w,\n/static/6c7f269b978643b825aa63d4b8a0d9e2/0b533/figure3.png 500w,\n/static/6c7f269b978643b825aa63d4b8a0d9e2/00d43/figure3.png 1000w,\n/static/6c7f269b978643b825aa63d4b8a0d9e2/aa440/figure3.png 1500w,\n/static/6c7f269b978643b825aa63d4b8a0d9e2/5f7fb/figure3.png 1889w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>5. Create Meth Object</h2>\n<p>Then finally we can create a <code class=\"language-text\">meth</code> object, this is the first human readable object we can create from methylKit package. The code is simply:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> meth <span class=\"token operator\">&lt;-</span> unite<span class=\"token punctuation\">(</span>filtered.myobj<span class=\"token punctuation\">,</span> destrand<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">></span> meth\nmethylBase object with <span class=\"token number\">554917</span> rows\n<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n  chr start   end strand coverage1 numCs1 numTs1 coverage2 numCs2 numTs2\n<span class=\"token number\">1</span>   <span class=\"token number\">1</span>  <span class=\"token number\">1110</span>  <span class=\"token number\">1110</span>      <span class=\"token operator\">+</span>        <span class=\"token number\">46</span>     <span class=\"token number\">45</span>      <span class=\"token number\">1</span>        <span class=\"token number\">55</span>     <span class=\"token number\">45</span>     <span class=\"token number\">10</span>\n<span class=\"token number\">2</span>   <span class=\"token number\">1</span>  <span class=\"token number\">1167</span>  <span class=\"token number\">1167</span>      <span class=\"token operator\">-</span>        <span class=\"token number\">89</span>     <span class=\"token number\">78</span>     <span class=\"token number\">11</span>        <span class=\"token number\">35</span>     <span class=\"token number\">33</span>      <span class=\"token number\">2</span>\n<span class=\"token number\">3</span>   <span class=\"token number\">1</span> <span class=\"token number\">12008</span> <span class=\"token number\">12008</span>      <span class=\"token operator\">+</span>       <span class=\"token number\">197</span>      <span class=\"token number\">1</span>    <span class=\"token number\">196</span>        <span class=\"token number\">86</span>      <span class=\"token number\">1</span>     <span class=\"token number\">85</span>\n<span class=\"token number\">4</span>   <span class=\"token number\">1</span> <span class=\"token number\">12023</span> <span class=\"token number\">12023</span>      <span class=\"token operator\">+</span>       <span class=\"token number\">198</span>      <span class=\"token number\">0</span>    <span class=\"token number\">198</span>        <span class=\"token number\">86</span>      <span class=\"token number\">0</span>     <span class=\"token number\">86</span>\n<span class=\"token number\">5</span>   <span class=\"token number\">1</span> <span class=\"token number\">12038</span> <span class=\"token number\">12038</span>      <span class=\"token operator\">+</span>       <span class=\"token number\">198</span>      <span class=\"token number\">0</span>    <span class=\"token number\">198</span>        <span class=\"token number\">83</span>      <span class=\"token number\">0</span>     <span class=\"token number\">83</span>\n<span class=\"token number\">6</span>   <span class=\"token number\">1</span> <span class=\"token number\">12039</span> <span class=\"token number\">12039</span>      <span class=\"token operator\">-</span>       <span class=\"token number\">218</span>      <span class=\"token number\">0</span>    <span class=\"token number\">218</span>       <span class=\"token number\">104</span>      <span class=\"token number\">0</span>    <span class=\"token number\">104</span>\n<span class=\"token ellipsis\">...</span></code></pre></div>\n<p>Also meth object contains the number of total CpGs we get across all samples:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>meth<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">554917</span>     <span class=\"token number\">22</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p><strong>A very important step is here, to generate beta matrix, this matrix may not help for DMR/DMP calling, but it's definitly useful for visualisation.</strong> A beta matrix here could allow me to implement a lot of array based algorithm on to sequence based data.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> beta <span class=\"token operator\">&lt;-</span> percMethylation<span class=\"token punctuation\">(</span>meth<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">100</span>\n<span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>beta<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">554917</span>      <span class=\"token number\">6</span>\n<span class=\"token operator\">></span> head<span class=\"token punctuation\">(</span>beta<span class=\"token punctuation\">)</span>\n      WildType_1 WildType_2 WildType_3 Mutation_1  Mutation_2  Mutation_3\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.978260870</span> <span class=\"token number\">0.81818182</span>  <span class=\"token number\">0.8333333</span>  <span class=\"token number\">0.9302326</span> <span class=\"token number\">0.907216495</span> <span class=\"token number\">0.846153846</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.876404494</span> <span class=\"token number\">0.94285714</span>  <span class=\"token number\">0.9428571</span>  <span class=\"token number\">0.9056604</span> <span class=\"token number\">0.862385321</span> <span class=\"token number\">0.830188679</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.005076142</span> <span class=\"token number\">0.01162791</span>  <span class=\"token number\">0.0000000</span>  <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.003649635</span> <span class=\"token number\">0.005263158</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.000000000</span> <span class=\"token number\">0.00000000</span>  <span class=\"token number\">0.0000000</span>  <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.007272727</span> <span class=\"token number\">0.005263158</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.000000000</span> <span class=\"token number\">0.00000000</span>  <span class=\"token number\">0.0000000</span>  <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.003663004</span> <span class=\"token number\">0.000000000</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> <span class=\"token number\">0.000000000</span> <span class=\"token number\">0.00000000</span>  <span class=\"token number\">0.0000000</span>  <span class=\"token number\">0.0000000</span> <span class=\"token number\">0.006211180</span> <span class=\"token number\">0.000000000</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>So above are two very important file generate from methylKit, <code class=\"language-text\">meth</code> and <code class=\"language-text\">beta</code>. A lot of downstream analysis would be done based on them.</p>","frontmatter":{"date":"September 14, 2020","slug":"/notes/RRBS-Analysis-2:-MethylKit","title":"RRBS Analysis 2: MethylKit","tags":["RRBS","methylkit"],"abstract":"Continuing my RRBS analysis, now what I need to do is work with the Bismark mapped bam file, transfer them into readable CpG information. The package I am using here is MethylKit."}}},"pageContext":{"slug":"/notes/RRBS-Analysis-2:-MethylKit"}},
    "staticQueryHashes": ["63159454"]}