{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/Generate-Single-Cell-Reference-for-EpiSCORE",
    "result": {"data":{"markdownRemark":{"html":"<p>Previously I have recorded <a href=\"https://yuantian1991.github.io/notes/Using-MethylCIBERSORT-for-Cell-Type-Deconvolution\">how to use methylCIBERSORT for cell type deconvolution</a>, which is easy to use but this time I want to use <a href=\"https://github.com/aet21/EpiSCORE\">EpiSCORE</a>. The idea of EpiSCORE is to use single-cell RNA-seq data as surrogate of methylation data (the underlying assumption is that a group of genes in each cell line to show high correlation between expression and methylation), then \"infer\" corresponding methylation reference. So in situations that we don't have corresponding purified cell type methylation reference for cell type deconvolution, for example using CIBERSORT, Projection, or any other algorithms, EpiSCORE will use corresponding single-cell RNA-seq expression value (only those high correlation genes), to \"tranform\" into a methylation reference, then use this \"inferred\" reference for cell type deconvolution.</p>\n<p>Honestly, all cell type deconvolution methods are black boxes to me... they are hard to be trace back or visualised. When I have time, I will create some In silico data for test.</p>\n<p>One key thing I need to find out is how to reproduced the EpiSCORE reference. It only provided some reference in the package, but I think I need more.</p>\n<h2>1. Demo Data in EpiSCORE</h2>\n<p>After loading the library, there is a default single-cell RNA-seq data can be loaded, <strong>however, this data set (15845 genes across 1641 single cell) contains only 4 cell types: Epi Endo Fib, and IC</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> library<span class=\"token punctuation\">(</span><span class=\"token string\">\"EpiSCORE\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">></span> dim<span class=\"token punctuation\">(</span>lungSS2mca1.m<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">(</span>celltypeSS2.idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n Endoth   Epith  Immune Stromal \n    <span class=\"token number\">693</span>     <span class=\"token number\">138</span>     <span class=\"token number\">387</span>     <span class=\"token number\">423</span> \n<span class=\"token operator\">></span></code></pre></div>\n<h2>2. Get origin single-cell RNA-seq Expression data.</h2>\n<p>So since I am working on Glioblastoma, I can't use this reference. I need look for the reference deeper. According to the EpiSCORE paper, the single-cell data were obtained from <a href=\"https://tabula-muris.ds.czbiohub.org/\">this link</a>. More specifically, I downloaded both the annotation file (annotations_FACS.\ncsv) and FACTS.zip files. In theory, the demo <code class=\"language-text\">lungSS2mca1</code> single cell RNA-seq data is generated from here. So I should be able to use them to generate more reference for EpiSCORE as I want.</p>\n<p>Firstly I want to confirm my understanding is correct. In the unzip FACS.zip folder, there are many tissue's single cell expression data.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ls</span>\nAorta-counts.csv          Brain_Non-Myeloid-counts.csv  Heart-counts.csv            Limb_Muscle-counts.csv  Mammary_Gland-counts.csv  Skin-counts.csv    Tongue-counts.csv\nBladder-counts.csv        Diaphragm-counts.csv          Kidney-counts.csv           Liver-counts.csv        Marrow-counts.csv         Spleen-counts.csv  Trachea-counts.csv\nBrain_Myeloid-counts.csv  Fat-counts.csv                Large_Intestine-counts.csv  Lung-counts.csv         Pancreas-counts.csv       Thymus-counts.csv\n</code></pre></div>\n<p>So, I suspect above lung demo data is generated from <code class=\"language-text\">Lung-counts.csv</code>, however, after loading, I noticed this table actually have 23433 genes and 1924 cells.  All cell line's name (colname) can be find in the annotation file (annotations_FACS.csv) below (first column), <strong>which contains tissue and cell_ontology_class to check.</strong>. So I suspect to create the demo, the author only select 4 types of cells, but actually the Lung-counts have more types of cells contained.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">(</span>anno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">|</span>cell                    <span class=\"token operator\">|</span>tissue <span class=\"token operator\">|</span>cell_ontology_class  <span class=\"token operator\">|</span>cell_ontology_term_iri                    <span class=\"token operator\">|</span>cell_ontology_id <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>A21.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>fibroblast           <span class=\"token operator\">|</span>http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>purl.obolibrary.org<span class=\"token operator\">/</span>obo<span class=\"token operator\">/</span>CL_0000057 <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span><span class=\"token number\">0000057</span>       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>F8.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span>  <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>unknown              <span class=\"token operator\">|</span><span class=\"token keyword\">NA</span>                                        <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span>.             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>H11.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>unknown              <span class=\"token operator\">|</span><span class=\"token keyword\">NA</span>                                        <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span>.             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>A22.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>unknown              <span class=\"token operator\">|</span><span class=\"token keyword\">NA</span>                                        <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span>.             <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>H12.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>epicardial adipocyte <span class=\"token operator\">|</span>http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>purl.obolibrary.org<span class=\"token operator\">/</span>obo<span class=\"token operator\">/</span>CL_1000309 <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span><span class=\"token number\">1000309</span>       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>L9.MAA000594.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span>  <span class=\"token operator\">|</span>Aorta  <span class=\"token operator\">|</span>unknown              <span class=\"token operator\">|</span><span class=\"token keyword\">NA</span>                                        <span class=\"token operator\">|</span>CL<span class=\"token operator\">:</span>.             <span class=\"token operator\">|</span>\n<span class=\"token operator\">></span> </code></pre></div>\n<p>A quick validation of my idea. By checking, indeed all columns (cells) in lungSS2mca1.m data can be find in the annotation. <strong>However, some cell types are merged into only 4 cell types.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> tmp2 <span class=\"token operator\">&lt;-</span> anno<span class=\"token punctuation\">[</span>match<span class=\"token punctuation\">(</span>colnames<span class=\"token punctuation\">(</span>lungSS2mca1.m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> anno<span class=\"token operator\">$</span>cell<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>tmp2<span class=\"token operator\">$</span>cell_ontology_class<span class=\"token punctuation\">,</span> celltypeSS2.idx<span class=\"token punctuation\">)</span>\n                                                 celltypeSS2.idx\n                                                    <span class=\"token number\">1</span>   <span class=\"token number\">2</span>   <span class=\"token number\">3</span>   <span class=\"token number\">4</span>\n  B cell                                            <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">57</span>\n  ciliated columnar cell of tracheobronchial tree  <span class=\"token number\">25</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>\n  classical monocyte                                <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">90</span>\n  epithelial cell of lung                         <span class=\"token number\">113</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>\n  lung endothelial cell                             <span class=\"token number\">0</span> <span class=\"token number\">693</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>\n  monocyte                                          <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">65</span>\n  myeloid cell                                      <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">85</span>\n  natural killer cell                               <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">37</span>\n  stromal cell                                      <span class=\"token number\">0</span>   <span class=\"token number\">0</span> <span class=\"token number\">423</span>   <span class=\"token number\">0</span>\n  T cell                                            <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>  <span class=\"token number\">53</span>\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> <span class=\"token comment\"># 1 is Epith; 2 is Endoth; 3 is Stromal; 4 is Immune.</span>\n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>tmp2<span class=\"token operator\">$</span>tissue<span class=\"token punctuation\">)</span>\nLung \n<span class=\"token number\">1545</span> \n<span class=\"token operator\">></span> </code></pre></div>\n<h2>3. Select cell types and tissues.</h2>\n<p><strong>Now it's more clear, if I want to research on certain tissues, I need to firstly find corresponding tissue in this table, then select cell lines I am interested.</strong> Below are all avaliable tissues.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>anno<span class=\"token operator\">$</span>tissue<span class=\"token punctuation\">)</span>\n\n          Aorta         Bladder Brain_Microglia   Brain_Neurons           Colon \n            <span class=\"token number\">364</span>            <span class=\"token number\">1287</span>            <span class=\"token number\">4365</span>            <span class=\"token number\">3000</span>            <span class=\"token number\">3459</span> \n      Diaphragm             Fat           Heart          Kidney           Liver \n            <span class=\"token number\">870</span>            <span class=\"token number\">4709</span>            <span class=\"token number\">4221</span>             <span class=\"token number\">517</span>             <span class=\"token number\">710</span> \n           Lung         Mammary          Marrow          Muscle        Pancreas \n           <span class=\"token number\">1620</span>            <span class=\"token number\">2304</span>            <span class=\"token number\">4897</span>            <span class=\"token number\">1067</span>            <span class=\"token number\">1327</span> \n           Skin          Spleen          Thymus          Tongue         Trachea \n           <span class=\"token number\">2263</span>            <span class=\"token number\">1689</span>            <span class=\"token number\">1283</span>            <span class=\"token number\">1394</span>             <span class=\"token number\">846</span> \n<span class=\"token operator\">></span> </code></pre></div>\n<p>Now I am working on Glioma data, so I want to get corresponding <code class=\"language-text\">Brain_Microglia</code> or <code class=\"language-text\">Brain_Neurons</code> cells (maybe I can merge them togather?)</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>anno<span class=\"token punctuation\">[</span>which<span class=\"token punctuation\">(</span>anno<span class=\"token operator\">$</span>tissue <span class=\"token operator\">==</span> <span class=\"token string\">\"Brain_Microglia\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cell_ontology_class\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n     macrophage microglial cell \n             <span class=\"token number\">36</span>            <span class=\"token number\">4329</span> \n<span class=\"token operator\">></span> table<span class=\"token punctuation\">(</span>anno<span class=\"token punctuation\">[</span>which<span class=\"token punctuation\">(</span>anno<span class=\"token operator\">$</span>tissue <span class=\"token operator\">==</span> <span class=\"token string\">\"Brain_Neurons\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cell_ontology_class\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nastrocyte of the cerebral cortex              Bergmann glial cell \n                             <span class=\"token number\">403</span>                               <span class=\"token number\">30</span> \n                  brain pericyte                 endothelial cell \n                             <span class=\"token number\">132</span>                              <span class=\"token number\">625</span> \n                          neuron               neuronal stem cell \n                             <span class=\"token number\">196</span>                               <span class=\"token number\">36</span> \n                 oligodendrocyte   oligodendrocyte precursor cell \n                            <span class=\"token number\">1186</span>                              <span class=\"token number\">202</span> \n              smooth muscle cell                          unknown \n                              <span class=\"token number\">14</span>                              <span class=\"token number\">176</span> \n<span class=\"token operator\">></span> </code></pre></div>\n<h2>4. Mosue to Human gene name mapping</h2>\n<p>Apart from the annotation (columns), rownames are also need to be checked the sc-RNAseq data are from Mouse, but we are working on human, so I need to find a way convert the mouse name (first two in each csv file) into human symbol. I coded a quick script to do it:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">LungCounts <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span><span class=\"token string\">\"./FACS/Lung-counts.csv\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> row.names<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># rownames(LungCounts) &lt;- toupper(rownames(LungCounts))</span>\nmm <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span><span class=\"token string\">\"http://www.informatics.jax.org/downloads/reports/HOM_MouseHumanSequence.rpt\"</span><span class=\"token punctuation\">,</span> header<span class=\"token operator\">=</span>T<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\nmatchIndex <span class=\"token operator\">&lt;-</span> mm<span class=\"token punctuation\">[</span>match<span class=\"token punctuation\">(</span>rownames<span class=\"token punctuation\">(</span>LungCounts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mm<span class=\"token operator\">$</span>Symbol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"DB.Class.Key\"</span><span class=\"token punctuation\">]</span>\nmHuman <span class=\"token operator\">&lt;-</span> mm<span class=\"token punctuation\">[</span>mm<span class=\"token operator\">$</span><span class=\"token string\">\"DB.Class.Key\"</span> <span class=\"token percent-operator operator\">%in%</span> matchIndex <span class=\"token operator\">&amp;</span> mm<span class=\"token operator\">$</span><span class=\"token string\">\"Common.Organism.Name\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"human\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"DB.Class.Key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Symbol\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nmMouse <span class=\"token operator\">&lt;-</span> mm<span class=\"token punctuation\">[</span>mm<span class=\"token operator\">$</span><span class=\"token string\">\"DB.Class.Key\"</span> <span class=\"token percent-operator operator\">%in%</span> matchIndex <span class=\"token operator\">&amp;</span> mm<span class=\"token operator\">$</span><span class=\"token string\">\"Common.Organism.Name\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"mouse, laboratory\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"DB.Class.Key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Symbol\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nMouse2Human <span class=\"token operator\">&lt;-</span> merge<span class=\"token punctuation\">(</span>mMouse<span class=\"token punctuation\">,</span> mHuman<span class=\"token punctuation\">,</span>by<span class=\"token operator\">=</span><span class=\"token string\">\"DB.Class.Key\"</span><span class=\"token punctuation\">)</span>\nMouse2Human <span class=\"token operator\">&lt;-</span> Mouse2Human<span class=\"token punctuation\">[</span>Mouse2Human<span class=\"token operator\">$</span>Symbol.y <span class=\"token percent-operator operator\">%in%</span> names<span class=\"token punctuation\">(</span>which<span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">(</span>Mouse2Human<span class=\"token operator\">$</span>Symbol.y<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>5. Normalisation Count Matrix</h2>\n<p>After running this script, I can get <code class=\"language-text\">Mouse2Human</code> object, which is a perfect name match between human to mouse. Finally, according to the paper, the origin RNA-seq matrix (LungCounts above) need to be normalised:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">W <span class=\"token operator\">&lt;-</span> LungCounts\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>ncol<span class=\"token punctuation\">(</span>LungCounts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> W<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;-</span> W<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">5531351</span> <span class=\"token operator\">/</span> sum<span class=\"token punctuation\">(</span>W<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># for 1</span>\nlog2<span class=\"token punctuation\">(</span>W <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>6. Compare between my result with the demo data</h2>\n<p>So finally, I replace the <code class=\"language-text\">W</code> matrix (normalised lungCounts) rowname to mouse (I know the code is quite ugly here):</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">A <span class=\"token operator\">&lt;-</span> Mouse2Human<span class=\"token punctuation\">[</span>match<span class=\"token punctuation\">(</span>rownames<span class=\"token punctuation\">(</span>LungCounts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Mouse2Human<span class=\"token operator\">$</span>Symbol.x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Symbol.y\"</span><span class=\"token punctuation\">]</span>\nindex <span class=\"token operator\">&lt;-</span> which<span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is.na<span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nW2 <span class=\"token operator\">&lt;-</span> W<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span>\nrownames<span class=\"token punctuation\">(</span>W2<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> A<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span></code></pre></div>\n<p>That's it! Finally I can quickly compare my result with the demo <code class=\"language-text\">lungSS2mca1</code> data provided by EpiSCORE package. Below is the origin demo matrix.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> lungSS2mca1.m<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n        A1.MAA000526.<span class=\"token number\">3</span>_9_M.<span class=\"token number\">1.1</span> A1.MAA000530.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> A1.MAA001847.<span class=\"token number\">3</span>_39_F.<span class=\"token number\">1.1</span>\nA4GALT                <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nA4GNT                 <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAAAS                  <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAACS                  <span class=\"token number\">1.887504</span>               <span class=\"token number\">3.401663</span>                       <span class=\"token number\">0</span>\nAADAC                 <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAADACL2               <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\n        A1.MAA001889.<span class=\"token number\">3</span>_38_F.<span class=\"token number\">1.1</span> A1.MAA001892.<span class=\"token number\">3</span>_38_F.<span class=\"token number\">1.1</span>\nA4GALT                        <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nA4GNT                         <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAAAS                          <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAACS                          <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAADAC                         <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAADACL2                       <span class=\"token number\">0</span>                       <span class=\"token number\">0</span></code></pre></div>\n<p>Below is my preprocessed matrix.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> W2<span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"A4GALT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A4GNT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AACS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AADAC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AADACL2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"A1.MAA000526.3_9_M.1.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A1.MAA000530.3_8_M.1.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A1.MAA001847.3_39_F.1.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A1.MAA001889.3_38_F.1.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A1.MAA001892.3_38_F.1.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        A1.MAA000526.<span class=\"token number\">3</span>_9_M.<span class=\"token number\">1.1</span> A1.MAA000530.<span class=\"token number\">3</span>_8_M.<span class=\"token number\">1.1</span> A1.MAA001847.<span class=\"token number\">3</span>_39_F.<span class=\"token number\">1.1</span>\nA4GALT                <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nA4GNT                 <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAAAS                  <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAACS                  <span class=\"token number\">1.921577</span>               <span class=\"token number\">3.404416</span>                       <span class=\"token number\">0</span>\nAADAC                 <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\nAADACL2               <span class=\"token number\">0.000000</span>               <span class=\"token number\">0.000000</span>                       <span class=\"token number\">0</span>\n        A1.MAA001889.<span class=\"token number\">3</span>_38_F.<span class=\"token number\">1.1</span> A1.MAA001892.<span class=\"token number\">3</span>_38_F.<span class=\"token number\">1.1</span>\nA4GALT                        <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nA4GNT                         <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAAAS                          <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAACS                          <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAADAC                         <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\nAADACL2                       <span class=\"token number\">0</span>                       <span class=\"token number\">0</span>\n<span class=\"token operator\">></span> </code></pre></div>\n<p>That's is, in the future I can use above solution to generate all cell type reference for EpiSCORE. Still it's too complicate, I think I will try write a script to do it...</p>","frontmatter":{"date":"December 07, 2021","slug":"/notes/Generate-Single-Cell-Reference-for-EpiSCORE","title":"Generate Single Cell Reference for EpiSCORE","tags":["cell-type-deconvolution","methylation"],"abstract":"This is my trace back on how to reproduce EpiSCORE single cell matrix, I will use this note to create tissue cell type fraction matrix in the future."}}},"pageContext":{"slug":"/notes/Generate-Single-Cell-Reference-for-EpiSCORE"}},
    "staticQueryHashes": []}