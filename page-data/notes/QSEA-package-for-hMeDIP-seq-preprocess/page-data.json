{"componentChunkName":"component---src-templates-note-template-js","path":"/notes/QSEA-package-for-hMeDIP-seq-preprocess","result":{"data":{"markdownRemark":{"html":"<p>I want to compare 3 methods: <a href=\"http://bioconductor.org/packages/release/bioc/html/qsea.html\">QSEA</a>, DiffBind, and <a href=\"https://github.com/tushiqi/MAnorm2\">MAnorm2</a>. This is the first post about QSEA, QSEA is an important benck mark, because it will not require peak calling, so in my idea it will return all peaks as I expected. QSEA comprises functionality for data normalization that accounts for the effect of CNVs on the read-counts as well as for the detection and annotation of differently methylated regions (DMRs). That's perfect and exactly what I want. One very important feature for QSEA is that it does not require peak calling. So I assume it will take all enriched fragments into consideration. That's really important and fit my assumption.</p>\n<p>Honestly I think QSEA is not very famous, and there are less discussion on platforms like BiStars, but I still think it worth trying. </p>\n<h2>1. Load BAM files</h2>\n<p>Firstly I need to prepare a SampleSheet data frame like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> knitr<span class=\"token operator\">::</span>kable<span class=\"token punctuation\">(</span>SampleSheet<span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">|</span>   <span class=\"token operator\">|</span>sample_name   <span class=\"token operator\">|</span>group        <span class=\"token operator\">|</span>file_name                                                              <span class=\"token operator\">|</span>input_files                                                       <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">3</span>  <span class=\"token operator\">|</span>LT52_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT52_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT52_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">4</span>  <span class=\"token operator\">|</span>LT53_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT53_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT53_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">5</span>  <span class=\"token operator\">|</span>LT55_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT55_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>LT55_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">6</span>  <span class=\"token operator\">|</span>NL49_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NL49_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">7</span>  <span class=\"token operator\">|</span>NL51_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NL51_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">8</span>  <span class=\"token operator\">|</span>NL55_bnd      <span class=\"token operator\">|</span>Liver<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NL55_bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">10</span> <span class=\"token operator\">|</span>NC42_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC42_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">11</span> <span class=\"token operator\">|</span>NC44_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC44_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">12</span> <span class=\"token operator\">|</span>TC24_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC24_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC35_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">13</span> <span class=\"token operator\">|</span>TC35_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC35_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC35_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">14</span> <span class=\"token operator\">|</span>TC42_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC42_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC42_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">15</span> <span class=\"token operator\">|</span>TC44_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Tumour <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC44_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>TC42_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">16</span> <span class=\"token operator\">|</span>NC24_Bnd_Away <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Bnd_Away.grey_filtered.sorted.bam <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">17</span> <span class=\"token operator\">|</span>NC24_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">18</span> <span class=\"token operator\">|</span>NC37_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC37_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC24_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token number\">19</span> <span class=\"token operator\">|</span>NC35_Bnd      <span class=\"token operator\">|</span>Colon<span class=\"token operator\">-</span>Normal <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC35_Bnd.grey_filtered.sorted.bam      <span class=\"token operator\">|</span>..<span class=\"token operator\">/</span><span class=\"token number\">13.</span>PreparedJoinData<span class=\"token operator\">/</span>myBigWig<span class=\"token operator\">/</span>NC35_Inp.grey_filtered.sorted.bam <span class=\"token operator\">|</span>\n<span class=\"token operator\">></span></code></pre></div>\n<p>As above information shows, there is no requirement for peak information. Basically I just went through the vignette. First step is to created QSEA Set:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">qseaSet <span class=\"token operator\">&lt;-</span> createQseaSet<span class=\"token punctuation\">(</span>sampleTable<span class=\"token operator\">=</span>SampleSheet<span class=\"token punctuation\">,</span>\n                         BSgenome<span class=\"token operator\">=</span><span class=\"token string\">\"BSgenome.Hsapiens.UCSC.hg38\"</span><span class=\"token punctuation\">,</span>\n                         chr.select<span class=\"token operator\">=</span>paste0<span class=\"token punctuation\">(</span><span class=\"token string\">\"chr\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"X\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Y\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                         window_size<span class=\"token operator\">=</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Here the <code class=\"language-text\">[chr.select](http://chr.select)</code> is vital and must be selected like this, otherwise there would have a error later. I set the window-size as 500 because in DiffBind I also used this threshold, I think it's a reasonable window-frame.</p>\n<h2>2. Add attribtues</h2>\n<p>Then QSEA need to do some calculation based on the QSEA objects we just created in last step. Like:</p>\n<ul>\n<li>Calcualte Coverage: <code class=\"language-text\">addCoverage()</code></li>\n<li>Copy Number Aberation: <code class=\"language-text\">addCNV()</code>. This step is important, for example, the <code class=\"language-text\">normal_idx</code> parameter should be normal/control samples in my data set, which need to be set by me manually.</li>\n<li>Scaling Library Factor QSEA accounts for differences in sequencing depth and library: <code class=\"language-text\">addLibraryFactors()</code></li>\n<li>The average CpG density per fragment for each genomic window: <code class=\"language-text\">addPatternDensity()</code>. <strong>This function is failed in my test, I am trying to fix it...</strong></li>\n<li>Offset for regions without CpG: <code class=\"language-text\">addOffset()</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\"># This should be the step to generate count, which means number of reads mapped on one window.</span>\nqseaSet <span class=\"token operator\">&lt;-</span> addCoverage<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">,</span> uniquePos<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> paired<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span>fragment_length<span class=\"token operator\">=</span><span class=\"token number\">36</span><span class=\"token punctuation\">,</span> parallel<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Calculate CNV note that here I am calculating the CNA compared to NC.</span>\nqseaSet <span class=\"token operator\">&lt;-</span> addCNV<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">,</span> file_name<span class=\"token operator\">=</span><span class=\"token string\">\"file_name\"</span><span class=\"token punctuation\">,</span>\n                  window_size<span class=\"token operator\">=</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">,</span> paired<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span>\n                  fragment_length<span class=\"token operator\">=</span><span class=\"token number\">36</span><span class=\"token punctuation\">,</span>\n                  parallel<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> MeDIP<span class=\"token operator\">=</span><span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span>\n                  normal_idx<span class=\"token operator\">=</span>which<span class=\"token punctuation\">(</span>substr<span class=\"token punctuation\">(</span>SampleSheet<span class=\"token operator\">$</span>sample_name<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nqseaSet <span class=\"token operator\">&lt;-</span> addLibraryFactors<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Failed in my test</span>\nqseaSet <span class=\"token operator\">&lt;-</span> addPatternDensity<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">,</span> <span class=\"token string\">\"CG\"</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">\"CpG\"</span><span class=\"token punctuation\">)</span>\n\nqseaSet <span class=\"token operator\">&lt;-</span> addOffset<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">,</span> enrichmentPattern <span class=\"token operator\">=</span> <span class=\"token string\">\"CpG\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Besides, there is a function to use CpG density to estimate the relative enrichment, I am thinking if this step suitable for hMeDIP-seq.</p>\n<h2>3. CNA Plot</h2>\n<p>Amazingly, QSEA provided a CNA calculation function. And the result looks interesting as TC have chromosome applification strongly in chrY, while LT have chromosome deletion in some chromosomes. I don't know if I have other tools to validate this result but this is important and what I want.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">plotCNV<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/abf7941ca1542e7b411cca66cfd331cd/3e992/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABz0lEQVQozz2QTWsTURSGJx8tmrTGBqqUgojgf/BnFEsSKNWIKO2muBFXWmttNB+FIrjTpUhdxIqCSF2UIpP0Q1ArCAqJTDrJREjRRtOZTGfm8d6JeOHhvOdweHnPVdpum5bbQu/q1A5raKZG/WCXZkfH+FWn2Wpi/NhD1/doGS1+Ngx+12uYjRqWruHWNZzdCqZRxdvXUZDPAfvAxrP9jseP3jM+tkIy9YoLiWXSyaekE09IJZ8zmV7hfOIF6YtFZqaeMT5RZCxV5OHEdRo7n1Acx8G2bSzLwrS6ws5i8tIyinJLMC+480/fEMwJ7vqElVlGYzeFvu3vnAsk2Xi9jiLNPM/zk9m2g+t2mJ5+KZbu09+3SDicJxgqEApLXSAWK/iz40OLnDq9xJFInkg0y9GhB7xZ3UHpdru+YS+lvNnk6hVpmCEQyIuaE2T/E430ZtGBAiOjS0RDGSLhDIMDOVbffugllKadTgfTlCfbTF2TJy+IVHkCfcI4mCUYzPkMxhcI9N9jOD7L2TNznBy5THx4hmMn5llTP6LIdPIfJa7jCkOPimZQKmmUyzXU8ndKospeVcVsq8o7tcrmZoXt7a+sb31hrfwZdeMb++0//AX0D4MTd1TBOwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CNV\"\n        title=\"CNV\"\n        src=\"/static/abf7941ca1542e7b411cca66cfd331cd/00d43/figure1.png\"\n        srcset=\"/static/abf7941ca1542e7b411cca66cfd331cd/63868/figure1.png 250w,\n/static/abf7941ca1542e7b411cca66cfd331cd/0b533/figure1.png 500w,\n/static/abf7941ca1542e7b411cca66cfd331cd/00d43/figure1.png 1000w,\n/static/abf7941ca1542e7b411cca66cfd331cd/aa440/figure1.png 1500w,\n/static/abf7941ca1542e7b411cca66cfd331cd/3e992/figure1.png 1902w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The code is simple and nice, but the key things is I want get the exactly coodinates of these fragments.</p>\n<p>And also QSEA provided a function to draw PCA plot, which is nice and helps me to make sure everything is correct.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">data<span class=\"token punctuation\">(</span>annotation<span class=\"token punctuation\">,</span> package<span class=\"token operator\">=</span><span class=\"token string\">\"MEDIPSData\"</span><span class=\"token punctuation\">)</span>\nCGIprom<span class=\"token operator\">=</span>intersect<span class=\"token punctuation\">(</span>ROIs<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"CpG Island\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> ROIs<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"TSS\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>ignore.strand<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">)</span>\npca_cgi<span class=\"token operator\">=</span>getPCA<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">,</span> ROIs<span class=\"token operator\">=</span>CGIprom<span class=\"token punctuation\">)</span>\nmyCol <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"#f4bb4a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#0892a5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#30475e\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#e84855\"</span><span class=\"token punctuation\">)</span>\nnames<span class=\"token punctuation\">(</span>myCol<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NL\"</span><span class=\"token punctuation\">)</span>\nmyCol <span class=\"token operator\">&lt;-</span> myCol<span class=\"token punctuation\">[</span>substr<span class=\"token punctuation\">(</span>SampleSheet<span class=\"token operator\">$</span>sample_name<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nplotPCA<span class=\"token punctuation\">(</span>pca_cgi<span class=\"token punctuation\">,</span> bg<span class=\"token operator\">=</span>myCol<span class=\"token punctuation\">,</span> main<span class=\"token operator\">=</span><span class=\"token string\">\"PCA plot based on CpG Island Promoters\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 634px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a0cb0aeab58f2cda6a80c08457bf495/374ac/figure2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 101.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACIklEQVQ4y41U207jMBDN///FirddIZ7R7tM+LBKqBPRCSkorqlxom5I2TZPm2oOPqYMbErQjObbj8ZkzF49xPB6hy+FwwGg0gmVZGI/H6Pf7mM1mmEwmGA6HGAwGME1TnnE/nU6hYxj88EdRFCjLElmWYbPZyLHdbhEEAXa7HcIwlGv1n4NrnvGuui8Budjv9xIsTdNaQY08z8/21K8EiepEhHd4l0aNqqqkNbr6v0Kg0F8jEgz1gMVx/MGQVpIkgXL/u0Eho8XrK1bLJXJx9wyQSnRXB1Qi1wRqGGqK+lcDEqwJqM9NkC7mtct0oZPhSTLhRZHldcw6AZXL3HQx8xwH9/9u4HmezHCXYQkYRZFMig6ogxGAwfdcF3ESd4alBqS7BG0CNll0JeILYFvZ6PNBGFRu+us1bMeV+ufeVJ+ALGxWeBvDvWBummMsVyvkQo9Pb7FYdD4CkvrCUJdSgJTi7EE0g7vRI1INiEZJhiOJAuRZ+vH0eMAYUtkR2fx724Pv+5Kd9TKH9fyMyXSG+Xwu36sutm3j8ucFrn79kF2J9+vCpstLkU22I75txo1GmDRdCvE/CgOE2zc8PVn48/savV5PYjAU0mVabnO5TdI0E+/YhevYIlTl2VmdFBY2B9mwvzEE3HNmXNS5OqOe0tX12R+NuiUxAcIdxi89lQpnZpZJY2i450XVFxkaekZd9syVqAaj+fjbGgGFwKq0viv2d26GFcO9LKK2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PCA\"\n        title=\"PCA\"\n        src=\"/static/9a0cb0aeab58f2cda6a80c08457bf495/374ac/figure2.png\"\n        srcset=\"/static/9a0cb0aeab58f2cda6a80c08457bf495/63868/figure2.png 250w,\n/static/9a0cb0aeab58f2cda6a80c08457bf495/0b533/figure2.png 500w,\n/static/9a0cb0aeab58f2cda6a80c08457bf495/374ac/figure2.png 634w\"\n        sizes=\"(max-width: 634px) 100vw, 634px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>4. Export expected</h2>\n<p>The export solution is what I like, very simple and directly, but seems the CNV's name is wrong, and beta export failed because of CpG density calculation failed I think...</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">M <span class=\"token operator\">&lt;-</span> makeTable<span class=\"token punctuation\">(</span>qs<span class=\"token operator\">=</span>qseaSet<span class=\"token punctuation\">,</span> samples<span class=\"token operator\">=</span>getSampleNames<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> groupMeans<span class=\"token operator\">=</span>getSampleGroups<span class=\"token punctuation\">(</span>qseaSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> CNV<span class=\"token operator\">=</span><span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> norm_method<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"counts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nrpm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>So sad... I have a feeling that this package is what I want, but there are seems too many bugs in it.</p>","frontmatter":{"date":"August 02, 2021","slug":"/notes/QSEA-package-for-hMeDIP-seq-preprocess","title":"QSEA package for hMeDIP-seq preprocess","tags":["MeDIP-seq","Preprocess"],"abstract":"I am working on some hMeDIP-seq data. Previously I have used MACS2 + DiffBind pipeline, but eventually I got some un-expected results. I think the reason could be filtering of peaks during the preprocessing stage. So I found QSEA R package, who reads BAM files for analysis."}}},"pageContext":{"slug":"/notes/QSEA-package-for-hMeDIP-seq-preprocess"}}}