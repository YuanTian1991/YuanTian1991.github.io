{"componentChunkName":"component---src-templates-note-template-js","path":"/notes/MAnorm2-package-for-hMeDIP-seq-2:-Normalisation-&-Analysis","result":{"data":{"markdownRemark":{"html":"<p>After <a href=\"https://yuantian1991.github.io/notes/MAnorm2-package-for-hMeDIP-seq-data\">preparation work with MAnorm2_utils</a>, now I can load the data into MAnorm2 for analysis. The vignette I found is by open it locally on my computer as:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">browseVignettes<span class=\"token punctuation\">(</span><span class=\"token string\">\"MAnorm2\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>1. Normalisation</h2>\n<p>To load the data into MAnorm2, I just need to read the prepared file (prepared<em>profile</em>bins.csv) into R. However, I don't know why the loading function is not working, thus I have to re-save it into csv, then use read.csv(). Not a big deal.</p>\n<blockquote>\n<p>Note that the author told me <strong>the xls file is actually a text document</strong>, that can be read by read.table() or read.csv() directly.</p>\n</blockquote>\n<p>The code for loading is this one</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"MAnorm2\"</span>\n<span class=\"token comment\"># The excel file can't be read by readxl, so I re-saved it into csv.</span>\npb <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span><span class=\"token string\">\"./prepared_profile_bins.csv\"</span><span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>1.1 One-step normalisation</h3>\n<p>So as far as I know, I can do <strong>one-step normalisation</strong>, or <strong>two-step normalisation</strong>. One-step normalisation means it will take one sample (or calcualte average across all samples) as \"baseline\", then remove the overall M-A trend associated with their common peak regions between each sample against the baseline. I personally think it's easy to implement, <strong>but did not consider group condition</strong>. But anyway, the code is below:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\"># One-step normalisation</span>\none_step_norm <span class=\"token operator\">&lt;-</span> normalize<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> grep<span class=\"token punctuation\">(</span><span class=\"token string\">'cnt'</span><span class=\"token punctuation\">,</span>colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> occupancy <span class=\"token operator\">=</span> grep<span class=\"token punctuation\">(</span><span class=\"token string\">'occupancy'</span><span class=\"token punctuation\">,</span>colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> baseline<span class=\"token operator\">=</span><span class=\"token string\">\"pseudo-reference\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Seems only one-step normalisation can plot below</span>\nplot<span class=\"token punctuation\">(</span>attr<span class=\"token punctuation\">(</span>one_step_norm<span class=\"token punctuation\">,</span> <span class=\"token string\">\"MA.cor\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> symbreaks <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> margins <span class=\"token operator\">=</span> c<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cexRow <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> cexCol <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>After normalisation, samples are comparable between each other. And the MA.cor plot (I don't know the more professional name...) blow indicates the effect of normalisation. According to the vigentte, the lighter color the better. <strong>This is not a correlation plot</strong>, just indicates the variance (difference) should be normalised between samples.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 746px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9a9f702aa7278d072d6b49209215a65/62de4/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 126.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MA_cor_heatmap\"\n        title=\"MA_cor_heatmap\"\n        src=\"/static/a9a9f702aa7278d072d6b49209215a65/62de4/figure1.png\"\n        srcset=\"/static/a9a9f702aa7278d072d6b49209215a65/63868/figure1.png 250w,\n/static/a9a9f702aa7278d072d6b49209215a65/0b533/figure1.png 500w,\n/static/a9a9f702aa7278d072d6b49209215a65/62de4/figure1.png 746w\"\n        sizes=\"(max-width: 746px) 100vw, 746px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Then I manually calcualted the correlation heatmap below. It looks reasonable to me, I already know that LT51 and LT49 are two contaiminated samples. Suprisingly, I found NC49, which was identified as a sample not clustering with most NC samples because of preprocessing batch and quality issue, are now clearly groups with NC groups, this is a shocking result to me, because both DiffBind and QSEA can't give me this. The first side is the raw count's clustering heatmap, honestly much worse than the second one.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5beacf4e86ae8a7e04b202d5da8762d4/d6a46/figure2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAEYklEQVQ4y02UW29UVRiG+2v8C3rnDzDeEBO90GhMuEGvaIzGeKExFSEhgIYUjAUkIShCKiRFpRFa6IF2emLaaTuH7pl9nD37fJg95/L4zTQVV7L3OmStd33r/d73G3v58iXD1u0f0u0dkrU6pGlGFKVUKgrVqoqqatRqKs1mm06nR78/oNvpcnh4yH/tCIax4a8pB0Jjj9ir0EocAbPwXRm3PAHw6Q/axElAFFukiU2UBjiBN1obDHoM5IIh3mGzyVhXBvUHU9Qn3qMzM46+9At6uEOSLlL1ytjRNuuawuyeSsk5oOwoTK/ucOtZgfmKwYGuo9VqRFmbQW2HsUwQ4/ID3DPvYL37BqXJCQ5iBT9aYVU12W84KG6ZlaqO6m3jZwX+WMox+XCHubKN4fgEvidUCVDfZixt9Uirc7j3vkQ5eYL18XFqYRWvvc9qtcaW6WKnZfSoTpBt0hus8SS/wpVHRV7UPcyGjaIoQlNE1usyFgQRQaKxreYpByo7C3MUr1zENR8RxM9wnDl0v4ARFAmiRaIkx7qS426uTNExaHiW7BGu2xk1Rzh0vZjIyxE1l0myHO5AxV28inXpYzLzNm33Fp30IVkwTbt+g0PnZ4lohoKxRdrOYTsahmESxxFDwYwlcVMiUdizK2wIwXl1n6wzT5i7jDX1Fal+WyLcwPfmSYJZQucJNfM5hXpVKMhjNyoCaI0AR7JpSVbCuIjqF8lbIZsCmjgztPxfifNX0S99wr5SQus28Fov8PsVNuu7PJasHwRD+bi4jkszax4BDgXaiGxy6gFus4QaKDjxBu3oAWq0Q3F7g+rE5wQzZ0ienSO+eJK9uz8yW9IkuwsYVmUkfs/zjgAjuaXWsLi/VaXsGqI9ITrOk3m/4/or6J06/vTXHJx4nej6Kbwv3sadPC2JXKK19j2ht48fxGTHEUZRQiOosGNJhMkGTrJFEj2mZVwTXp7iNdeJ/5kgunEK67sPic6/j3PvLEa4TVebwjbzEqGObdfp9Xoi7GYLL6qy76ji53WSdp5W8yn9+k8EwXOCToH43Ee4n71FcvEDlDdfo/jNaSpZg1btGp67L88NRYeheLzPWL/bZdfQmPxzjTvzS9xfWWW5uMJe6RFF8wWLlTzr09fxfvuW+l9X2btyntKFs5ibD+noU7j2LrpuEYbB0ZObScK+aXJjfpc7y1VuLijMlxQ0b028q7J4YLJcU6RwzOKIHdVUqNFFOpfGCZ//gJ9U0TWTJImPAAcSpiWp/7sgNrN8dup1tFAjbq7gpQUU8WnkPyXbvEBbu06m3aRdmyLR72Fd/pTG+gJOGEkVil+Vr1DebzuOSKA+Ct20dMmci2HW8GVumKrssTENRXi1scwqYSo+VoqihkD83R/x9wowDMUJHoaIejjWNV0OhqPCOpwPe9f10TRDEhDIXC70fHSzTv//RfYYsCuJabXbUqlT2tInwmunc9x3RD7xaN33/dHa8b5UxoOBFFcx8fH3L14BWtm/fqoAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"raw_count_heatmap\"\n        title=\"raw_count_heatmap\"\n        src=\"/static/5beacf4e86ae8a7e04b202d5da8762d4/00d43/figure2.png\"\n        srcset=\"/static/5beacf4e86ae8a7e04b202d5da8762d4/63868/figure2.png 250w,\n/static/5beacf4e86ae8a7e04b202d5da8762d4/0b533/figure2.png 500w,\n/static/5beacf4e86ae8a7e04b202d5da8762d4/00d43/figure2.png 1000w,\n/static/5beacf4e86ae8a7e04b202d5da8762d4/d6a46/figure2.png 1008w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15d79e4396551cdbb2899a58354cdd75/d6a46/figure3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAEdUlEQVQ4y2WUW08bVxSF+XlVX/sLqqrpSys1bdQmUS9qm0DaivRCIkUJCaBAmkIgEJKSOmDAFzAGDBgb2+PL2GPPeHwb323AwNdtB/rQjnRmnxkd7bP2XmuvvrOzM7rPaXfJtiObaq1OJBJFz2SIRxXURJxIOIKW0mg1G3SOjzjpdODslP8+fd1XU0tTSQYp5RSs9AFVK8vhUYVitUrCKGFaVertJqVKCaNgoRoF9HwBzSzSbB9xenpC5+SE41qNvu4d2Yk7GN+8Rzt5j5bvBkbKTfnwgLEVL1dGNnjijeNQVPZ0k+FVhR+mfMzuphhfj+Pei2LqabJFi2bER59cQCVtozB3FWPwEg3nt+SSS3Kzk1H7Gh/+7uCuPcSbgIJHNRhxKozKWo8buGRF0yYVq0SjeSj9MumrNTtUwrN0QjcoD1/CuPwulfgcZyzyZNnFx/fXeeSO4VQUdgXhjE+QeeLsZ0tspkvsRZOkU0mKhSL1o7YkrLextG2M4DOs6AzG3G0Sw/1YRSfzewFuze4ythZlVUgKZnMshzO8kHJXFR1bKMNBUscqFXtkpfINSVhtUGunKbcDwp5D2HaQ35klNzbAlMvHtWcBKTnKYkjDGcsKQhVHzGRFkWS5HKmsKWoQUisVUckZfceHRwRSCSbdbl5tuljwrLCixng1/xe272/i9q0QKewQ0kMsKQZTWypPN1Vmd1TpZYTtcArT0KmIInqyaVYtXmyofCDNvzTk4tOHG/w0t8f15wf43bNYDy5zFL1LUHXxyBlnyOZnYG6Xzx66eP9XO0tehXrFolavnyesVfDGszwQ5oYWQ4y6ozyUdW9ZIVPfor39I/mr7xBemWZ40+TauIcvHnv58vEGl0c8LDiDZHWNkmW9TdhqNlELed4cxFg6iOJSIixHVOxSSsQIEkysEl6cZPXmzyw53EwIohF7gCfOAIMv/XiDKRoCqil5egkr5TJaMY8naeBNZfHrBnsyCd2m28IGD1Zj3PdmWXStoQ0PsrMbYC6cwxZM0i+tWfPHyWgim1LpvOR6lXVp9u2FfSY8CWExiT2SYXo7wZ9bCX557e+VOS7INqWKv7/uZ3LWwbxSZGBmm+1ImmpZhN04R3hy2MImjN2Y9vWSPd2IsRDMCEKjJ+Dvprb4fNTDmH2fl2GRjWOfua/6mZ+3MSNIQ4nMv7J528N6jd2kyfPdZE/9fjGDRSm1O2bjazE+ue/k+h+bTDgPRCoJnvkNJl1+4vekpwurInYxDz1D9UI2nBzjiWZ57I6wpeVxyH4xlCaSN7nzep+PfrNz5dEag/N73BK5DExv8Xw/w4IvxvbQXfSdHQrCQ02c5l/7MgslVBnyhJYhYxaIp9LkSxYhmdOokOUPJUhmcigJjXS2gCq+qJcqaKpKu1jkWKyr0/XHi4TVSplSsUAqmaQszqGlUhIt6Y1GXSRhZvXeGaNbmkRdYlnmN6PrYshn/zfY7tjUG40e7FarJY5do91u99TfOo/d7/pFlLO9/3LuRNB1Xf9i/QPW7Damh5qDxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"normed_count\"\n        title=\"normed_count\"\n        src=\"/static/15d79e4396551cdbb2899a58354cdd75/00d43/figure3.png\"\n        srcset=\"/static/15d79e4396551cdbb2899a58354cdd75/63868/figure3.png 250w,\n/static/15d79e4396551cdbb2899a58354cdd75/0b533/figure3.png 500w,\n/static/15d79e4396551cdbb2899a58354cdd75/00d43/figure3.png 1000w,\n/static/15d79e4396551cdbb2899a58354cdd75/d6a46/figure3.png 1008w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Without digging into code, I can't clearly say that MAnorm2's normalisation is better than QSEA or DiffBind, but to me, it's indeed grouped samples in same pheno togather, with just one-step normalisation.</p>\n<h2>1.2 Two-step normalisation</h2>\n<p>As the vignette recommanded, I prefer to use two-step normalisation method. It will fistly do normalisation within-group, to remove variance for samples in samde phenotype. Then do between-group normalisation. Sounds like suitable for samples have high variance, like mine.</p>\n<p>I wrote a look to solve it, so the <code class=\"language-text\">norm</code> object will save each time's within-group normalisation results. Then the result will be organized into <code class=\"language-text\">conds</code> with <code class=\"language-text\">bioConds()</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\"># Firstly perform one-step normalisation for each group, in my case 4 pheno.</span>\nconds <span class=\"token operator\">&lt;-</span> list<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    message<span class=\"token punctuation\">(</span><span class=\"token string\">\"within-group normalization for \"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span>\n\n    countIndex <span class=\"token operator\">&lt;-</span> intersect<span class=\"token punctuation\">(</span>grep<span class=\"token punctuation\">(</span><span class=\"token string\">\"cnt\"</span><span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> grep<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    occupancyIndex <span class=\"token operator\">&lt;-</span> intersect<span class=\"token punctuation\">(</span>grep<span class=\"token punctuation\">(</span><span class=\"token string\">\"occupancy\"</span><span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> grep<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> colnames<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        norm <span class=\"token operator\">&lt;-</span> normalize<span class=\"token punctuation\">(</span>pb<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> countIndex<span class=\"token punctuation\">,</span> occupancy <span class=\"token operator\">=</span> occupancyIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        norm <span class=\"token operator\">&lt;-</span> normalize<span class=\"token punctuation\">(</span>norm<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> countIndex<span class=\"token punctuation\">,</span> occupancy <span class=\"token operator\">=</span> occupancyIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    conds<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;-</span> bioCond<span class=\"token punctuation\">(</span>norm<span class=\"token punctuation\">[</span>countIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> norm<span class=\"token punctuation\">[</span>occupancyIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> i<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note that a very useful feature is <code class=\"language-text\">summary(conds[[x]])</code> could check the pheno's status. Like how much genomic intervals occupied by the condition, and stats like mean and median. So I quickly checked my 4 phenotypes:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> summary<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"NC\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nBiological condition NC<span class=\"token operator\">:</span>\n<span class=\"token number\">570869</span> genomic intervals with <span class=\"token number\">8</span> profiles\n\nOccupancy states<span class=\"token operator\">:</span>\n<span class=\"token number\">343207</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60.1</span>%<span class=\"token punctuation\">)</span> of the genomic intervals occupied by the condition\n\nSummary of mean signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n <span class=\"token operator\">-</span><span class=\"token number\">1.353</span>   <span class=\"token number\">1.373</span>   <span class=\"token number\">2.304</span>   <span class=\"token number\">2.403</span>   <span class=\"token number\">3.353</span>   <span class=\"token number\">8.751</span>\n\n<span class=\"token ellipsis\">...</span>\n\n<span class=\"token operator\">></span> summary<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"TC\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nBiological condition TC<span class=\"token operator\">:</span>\n<span class=\"token number\">570869</span> genomic intervals with <span class=\"token number\">7</span> profiles\n\nOccupancy states<span class=\"token operator\">:</span>\n<span class=\"token number\">147812</span> <span class=\"token punctuation\">(</span><span class=\"token number\">25.9</span>%<span class=\"token punctuation\">)</span> of the genomic intervals occupied by the condition\n\nSummary of mean signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n<span class=\"token operator\">-</span><span class=\"token number\">0.7186</span>  <span class=\"token number\">0.4843</span>  <span class=\"token number\">1.1652</span>  <span class=\"token number\">1.3228</span>  <span class=\"token number\">2.0252</span>  <span class=\"token number\">6.7152</span>\n\nSummary of standard deviations of signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n <span class=\"token number\">0.0723</span>  <span class=\"token number\">0.8007</span>  <span class=\"token number\">1.0446</span>  <span class=\"token number\">1.0497</span>  <span class=\"token number\">1.2819</span>  <span class=\"token number\">3.2681</span>\n\n<span class=\"token ellipsis\">...</span>\n\n<span class=\"token operator\">></span> summary<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"LT\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nBiological condition LT<span class=\"token operator\">:</span>\n<span class=\"token number\">570869</span> genomic intervals with <span class=\"token number\">5</span> profiles\n\nOccupancy states<span class=\"token operator\">:</span>\n<span class=\"token number\">243718</span> <span class=\"token punctuation\">(</span><span class=\"token number\">42.7</span>%<span class=\"token punctuation\">)</span> of the genomic intervals occupied by the condition\n\nSummary of mean signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n<span class=\"token operator\">-</span><span class=\"token number\">0.9125</span>  <span class=\"token number\">0.4808</span>  <span class=\"token number\">1.1856</span>  <span class=\"token number\">1.2917</span>  <span class=\"token number\">2.0129</span>  <span class=\"token number\">6.1973</span>\n\nSummary of standard deviations of signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n<span class=\"token number\">0.04139</span> <span class=\"token number\">0.75732</span> <span class=\"token number\">1.04839</span> <span class=\"token number\">1.05869</span> <span class=\"token number\">1.35746</span> <span class=\"token number\">2.84766</span>\n\n<span class=\"token ellipsis\">...</span>\n\n<span class=\"token operator\">></span> summary<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"NL\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nBiological condition NL<span class=\"token operator\">:</span>\n<span class=\"token number\">570869</span> genomic intervals with <span class=\"token number\">3</span> profiles\n\nOccupancy states<span class=\"token operator\">:</span>\n<span class=\"token number\">212115</span> <span class=\"token punctuation\">(</span><span class=\"token number\">37.2</span>%<span class=\"token punctuation\">)</span> of the genomic intervals occupied by the condition\n\nSummary of mean signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n   Min. <span class=\"token number\">1</span>st Qu.  Median    Mean <span class=\"token number\">3</span>rd Qu.    Max.\n<span class=\"token operator\">-</span><span class=\"token number\">0.8845</span>  <span class=\"token number\">0.5077</span>  <span class=\"token number\">1.6349</span>  <span class=\"token number\">1.6685</span>  <span class=\"token number\">2.7150</span>  <span class=\"token number\">6.6694</span>\n\nSummary of standard deviations of signal intensities at the genomic intervals<span class=\"token operator\">:</span>\n     Min.   <span class=\"token number\">1</span>st Qu.    Median      Mean   <span class=\"token number\">3</span>rd Qu.      Max.\n<span class=\"token number\">0.0006521</span> <span class=\"token number\">0.3655651</span> <span class=\"token number\">0.6997107</span> <span class=\"token number\">0.7495489</span> <span class=\"token number\">1.0379378</span> <span class=\"token number\">3.0839296</span></code></pre></div>\n<p>Well, here I have a question for ChIP-seq, for example in my case, when \"LT\" has 42.7% occupancy, higher than TC (25.9%) or NL (37.2%), why it's mean value seems lower than the rest two?</p>\n<p>Then perform two-step normalisation as:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\"># Then perform two-step normalisation between groups.</span>\nconds <span class=\"token operator\">&lt;-</span> normBioCond<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">,</span> baseline<span class=\"token operator\">=</span><span class=\"token string\">\"pseudo-reference\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note that I suggest to use <strong>baseline=\"pseudo-reference\"</strong>, if you have more than five samples. Because based on my test, without setting this, the data distribution was changed hugely.</p>\n<p>So I believe this the result of two-step norm. I checked bit, seem the normalised result is still stored in <code class=\"language-text\">conds</code> object, instead of returned. So I fetched it myself out, so does the occupancy information for each pheno.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">myNorm <span class=\"token operator\">&lt;-</span> do.call<span class=\"token punctuation\">(</span><span class=\"token string\">\"cbind\"</span><span class=\"token punctuation\">,</span> lapply<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> x<span class=\"token operator\">$</span>norm.signal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmyOccupancy <span class=\"token operator\">&lt;-</span> do.call<span class=\"token punctuation\">(</span><span class=\"token string\">\"cbind\"</span><span class=\"token punctuation\">,</span> lapply<span class=\"token punctuation\">(</span>conds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> x<span class=\"token operator\">$</span>occupancy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Also I checked the correlation heatmap, it's nearly similar to the one-step norm. Until this step, I got the normalised matrix for visualisation.</p>","frontmatter":{"date":"August 05, 2021","slug":"/notes/MAnorm2-package-for-hMeDIP-seq-2:-Normalisation-&-Analysis","title":"MAnorm2 package for hMeDIP-seq 2: Normalisation & Analysis","tags":["MAnorm2","MeDIP-seq"],"abstract":"After preparation work with MAnorm2_utiles, I go the read counts and occupancy matrix, then I can try read it into MAnorm2. Based on my test, it gave me the best normalisation result, the more easy-to-plot distribution."}}},"pageContext":{"slug":"/notes/MAnorm2-package-for-hMeDIP-seq-2:-Normalisation-&-Analysis"}}}