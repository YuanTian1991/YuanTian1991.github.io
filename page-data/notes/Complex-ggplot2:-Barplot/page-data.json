{
    "componentChunkName": "component---src-templates-note-template-js",
    "path": "/notes/Complex-ggplot2:-Barplot",
    "result": {"data":{"markdownRemark":{"html":"<p>Here are some nice figure I draw with ggplot2, I collect them here for future copy-paste.</p>\n<h2>Basic Barplot</h2>\n<p>Below is an example of quick and simply barplot, which:</p>\n<p>A good example for me to copy-paste in the future.</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> df\n           V1           V2      V3 Genes\n<span class=\"token number\">1</span> <span class=\"token number\">0.038144115</span> <span class=\"token number\">0.0015615045</span> GM12878  IGF2\n<span class=\"token number\">2</span> <span class=\"token number\">0.063070041</span> <span class=\"token number\">0.0076605731</span> GM12878   H19\n<span class=\"token number\">3</span> <span class=\"token number\">1.032926070</span> <span class=\"token number\">0.0630352717</span>  IMR<span class=\"token operator\">-</span><span class=\"token number\">90</span>  IGF2\n<span class=\"token number\">4</span> <span class=\"token number\">0.003074519</span> <span class=\"token number\">0.0004062534</span>  IMR<span class=\"token operator\">-</span><span class=\"token number\">90</span>   H19\n<span class=\"token number\">5</span> <span class=\"token number\">1.215367031</span> <span class=\"token number\">0.0874954574</span>     HB2  IGF2\n<span class=\"token number\">6</span> <span class=\"token number\">2.305351688</span> <span class=\"token number\">0.1178677524</span>     HB2   H19\n<span class=\"token number\">7</span> <span class=\"token number\">0.538315946</span> <span class=\"token number\">0.0097037059</span> H1<span class=\"token operator\">-</span>hESC  IGF2\n<span class=\"token number\">8</span> <span class=\"token number\">0.350083002</span> <span class=\"token number\">0.1079638997</span> H1<span class=\"token operator\">-</span>hESC   H19\n<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggplot2\"</span><span class=\"token punctuation\">)</span>\n\ndf <span class=\"token operator\">&lt;-</span> read.csv<span class=\"token punctuation\">(</span><span class=\"token string\">\"./data1.csv\"</span><span class=\"token punctuation\">,</span> head<span class=\"token operator\">=</span>F<span class=\"token punctuation\">,</span> sep<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\ndf<span class=\"token operator\">$</span>V1 <span class=\"token operator\">&lt;-</span> df<span class=\"token operator\">$</span>V1 <span class=\"token operator\">*</span> <span class=\"token number\">10000</span>\ndf<span class=\"token operator\">$</span>V2 <span class=\"token operator\">&lt;-</span> df<span class=\"token operator\">$</span>V2 <span class=\"token operator\">*</span> <span class=\"token number\">10000</span>\ndf<span class=\"token operator\">$</span>V3 <span class=\"token operator\">&lt;-</span> factor<span class=\"token punctuation\">(</span>df<span class=\"token operator\">$</span>V3 <span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"GM12878\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IMR-90\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HB2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"H1-hESC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ndf<span class=\"token operator\">$</span>V4 <span class=\"token operator\">&lt;-</span> factor<span class=\"token punctuation\">(</span>df<span class=\"token operator\">$</span>V4<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"IGF2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"H19\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncolnames<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"Genes\"</span>\n\np <span class=\"token operator\">&lt;-</span> ggplot<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">,</span> aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>V3<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>V1<span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span>Genes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     geom_bar<span class=\"token punctuation\">(</span>stat<span class=\"token operator\">=</span><span class=\"token string\">\"identity\"</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">=</span>position_dodge<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"black\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     geom_errorbar<span class=\"token punctuation\">(</span>aes<span class=\"token punctuation\">(</span>ymin<span class=\"token operator\">=</span>V1<span class=\"token operator\">-</span>V2<span class=\"token punctuation\">,</span> ymax<span class=\"token operator\">=</span>V1<span class=\"token operator\">+</span>V2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">.2</span><span class=\"token punctuation\">,</span> position<span class=\"token operator\">=</span>position_dodge<span class=\"token punctuation\">(</span><span class=\"token number\">.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     xlab<span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> ylab<span class=\"token punctuation\">(</span><span class=\"token string\">\"Relative Expression (x10^4)\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     theme<span class=\"token punctuation\">(</span>strip.text.x <span class=\"token operator\">=</span> element_blank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     theme_bw<span class=\"token punctuation\">(</span>base_size<span class=\"token operator\">=</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span>\n\npdf<span class=\"token punctuation\">(</span><span class=\"token string\">\"BaiscBarplot.pdf\"</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\nprint<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\ndev.off<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 803px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f186f9545e864deed35f6b1769dbd78c/e1031/figure2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACNklEQVQoz2WTTWsTURSGgxvbHyH+I4vFneBGi7gpuBGKgpSAtaAWdCEuUnSjoFtdKa1CFaVpmqamNqZppklDkqbJfGY+MnPnkXuTiakeOMy9c895zpn3nkkBdLtd+v0+g8GAIAjUM1krH+17tk3bMM7EJXnS4jgm1Ww28Txv/FIIoQ6kJ+sojtXZ9VyBC5++YPn+GJCAx8D9/X16vZ46UMlRpEDSk3UohIxmJlfg3NoGet9V+0gIfN8/C6zX6ziOMwYmXf0HJObK9i5T618xXFftxT8dSkuVSiV0Xf/b4QioKo4kSMIvK+DGEDgqKvN8z+OoUkHTNFLFYhHTNFWVyQ6dVot+u62gTqWMv7zIzNt3TH3Lotu2rKSKh2GIoet8Xl9jM5sddiiBk588EAJj6T7600dEgL2Tg7mrzK6ucv57DjMIVMeB1DAIcHyfqmVhmyapcrmMYRgKKKJI6eZJT9/FebJEKIG7OzB/g9mXr5j+kad1WGFQOxrqEIaEkxrm83kFDKOISXMXF3AeP0BehyOBt65xKZMhtb1Hc2WZ9p150lvbvK8dg4jUaKlbloNpOw5mp4N1XCfbaLDZPsFaeYj+4hmOiOkV8oQLt5l7/YaLuZ+cZp5zkL7H9IeP3NzagVgoaRRQdtN3XWzDQPtdYnPvF4edDna3i1Yu02q18F0X86TNQbXKqYzVdRqaxkGthm5ZSvfxHCYjIs2Tv5maseHIuHJoRxcgU+R4JGfyd/RHsQlMavgHPOh5xLQ54hYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BasicBarplot\"\n        title=\"BasicBarplot\"\n        src=\"/static/f186f9545e864deed35f6b1769dbd78c/e1031/figure2.png\"\n        srcset=\"/static/f186f9545e864deed35f6b1769dbd78c/63868/figure2.png 250w,\n/static/f186f9545e864deed35f6b1769dbd78c/0b533/figure2.png 500w,\n/static/f186f9545e864deed35f6b1769dbd78c/e1031/figure2.png 803w\"\n        sizes=\"(max-width: 803px) 100vw, 803px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Barplot with both Stack and Besides</h2>\n<p>In my project, I need to draw a barplot with both Stack and Besides bars. I never thought it's so hard but eventually I made it work. And also I added pattern on it.</p>\n<p>The input is a data frame <code class=\"language-text\">df</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token operator\">></span> head<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span>\n     TranscriptType      Feature Count PhenoType\nNC.<span class=\"token number\">1</span>         coding         Exon    <span class=\"token number\">77</span>        NC\nNC.<span class=\"token number\">2</span>      nonCoding         Exon     <span class=\"token number\">0</span>        NC\nNC.<span class=\"token number\">3</span>           none         Exon     <span class=\"token number\">0</span>        NC\nNC.<span class=\"token number\">4</span>         pseudo         Exon     <span class=\"token number\">0</span>        NC\nNC.<span class=\"token number\">5</span>         coding Intergenetic     <span class=\"token number\">0</span>        NC\nNC.<span class=\"token number\">6</span>      nonCoding Intergenetic     <span class=\"token number\">0</span>        NC</code></pre></div>\n<p>Some key points in this figure:</p>\n<ul>\n<li>Draw patterns on stacks.</li>\n<li>Use <code class=\"language-text\">facet_grid</code> to join barplots.</li>\n<li>How to remove text border/strip after joined facet figure.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">library<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggplot2\"</span><span class=\"token punctuation\">)</span>\nlibrary<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggpattern\"</span><span class=\"token punctuation\">)</span>\n\nggplot<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>df<span class=\"token punctuation\">,</span> aes<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span>PhenoType<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span>Count<span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span>PhenoType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     geom_bar<span class=\"token punctuation\">(</span>stat<span class=\"token operator\">=</span><span class=\"token string\">\"identity\"</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"black\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     scale_fill_manual<span class=\"token punctuation\">(</span>values<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"#f4bb4a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#0892a5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#30475e\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     <span class=\"token comment\"># Below three lines are for patterns.</span>\n     geom_bar_pattern<span class=\"token punctuation\">(</span>aes<span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">=</span> TranscriptType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> stat <span class=\"token operator\">=</span> <span class=\"token string\">\"identity\"</span><span class=\"token punctuation\">,</span>\n                   pattern_color <span class=\"token operator\">=</span> <span class=\"token string\">\"white\"</span><span class=\"token punctuation\">,</span> color <span class=\"token operator\">=</span> <span class=\"token string\">\"black\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     scale_pattern_manual<span class=\"token punctuation\">(</span>values <span class=\"token operator\">=</span> c<span class=\"token punctuation\">(</span>coding <span class=\"token operator\">=</span> <span class=\"token string\">\"stripe\"</span><span class=\"token punctuation\">,</span> nonCoding <span class=\"token operator\">=</span> <span class=\"token string\">\"circle\"</span><span class=\"token punctuation\">,</span> pseudo<span class=\"token operator\">=</span><span class=\"token string\">\"crosshatch\"</span><span class=\"token punctuation\">,</span> none<span class=\"token operator\">=</span><span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                          labels <span class=\"token operator\">=</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"Protein Coding\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Non-Coding\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Pseudo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"None\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     guides<span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">=</span> guide_legend<span class=\"token punctuation\">(</span>override.aes <span class=\"token operator\">=</span> list<span class=\"token punctuation\">(</span>fill <span class=\"token operator\">=</span> <span class=\"token string\">\"grey\"</span><span class=\"token punctuation\">,</span>\n                                                       pattern<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"stripe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"circle\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"crosshatch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                                       pattern_spacing<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token comment\"># The \"pattern_spacing\" is vital here, otherwise the legend is wrong.</span>\n     theme_bw<span class=\"token punctuation\">(</span>base_size<span class=\"token operator\">=</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> xlab<span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> ylab<span class=\"token punctuation\">(</span><span class=\"token string\">\"Count of 5hmC Peaks\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     facet_grid<span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>Feature<span class=\"token punctuation\">,</span> switch<span class=\"token operator\">=</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n     <span class=\"token comment\"># strip parameters in theme function is used to remove box for groups draw by facet.</span>\n     theme<span class=\"token punctuation\">(</span>axis.title.x<span class=\"token operator\">=</span>element_blank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> axis.text.x<span class=\"token operator\">=</span>element_blank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> axis.ticks.x<span class=\"token operator\">=</span>element_blank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> axis.line.x.bottom<span class=\"token operator\">=</span>element_blank<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           strip.text <span class=\"token operator\">=</span> element_text<span class=\"token punctuation\">(</span>size<span class=\"token operator\">=</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> colour<span class=\"token operator\">=</span><span class=\"token string\">\"black\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> strip.background <span class=\"token operator\">=</span> element_rect<span class=\"token punctuation\">(</span>colour<span class=\"token operator\">=</span><span class=\"token string\">\"white\"</span><span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span><span class=\"token string\">\"white\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Below is the nice plot.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20995544b708e15dc7df9f830de78342/8698d/figure1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVQoz3WSS2/TUBBG8/cRYsEOduzYABEQFYEACagaNWnSAI7cJmloHk5i14/4+nX9POg6j5YFI9lzPXd09M03blSAu5kQbQakOdh6k1wKolhSliVpmiJlQlVVhGGIiiRJyLKsvlf5YTTCKEWYV0SL78gcvHGLXAZEcXIEKsABqLL6VnV1juMY27axLAvDMGj8mS3J/Dnh4kcNdEfv/w8Mgj0wJq1VgxACTftNt9tF13Uas8UKb60TLU9JlMLRQ4XFbuQ0o6rK2obdyJKsYFeLYubzOaZp7kY21haZWBDsFTrX7/Ye7hRKKRGehfLa24zJE5co9BGrPmUFMonxPQ/HccjzXClcszUG+KMmSQFm/xmF3JLItAZGocAdtchKMK8/Et3pCNfAvXhECaysBRe/Ovhbn6IsaESyJFxfkk5f1yoC7TnCXWHa23qEOBL441Z99kZvKT2NLPYQg6d1bWU7TJbG/ZbVK9ho3F6+5M3nDsv2E16dtPj0rV03bD0H+6rJdO0yPX/BQv9Cr3eO03/M2Lgjkztf1bLU01CqZGAz1M742u6zue3x4azN5OYGzzFxXRdrNaavjzHnQ4bDHr3BT2bTLienHYIguAfWCtXugVT91YcoiuM2VaMyv8zzf/riOKPKsyPskP8CoJ70QjUXEYEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Barplot with both stack and beside\"\n        title=\"Barplot with both stack and beside\"\n        src=\"/static/20995544b708e15dc7df9f830de78342/00d43/figure1.png\"\n        srcset=\"/static/20995544b708e15dc7df9f830de78342/63868/figure1.png 250w,\n/static/20995544b708e15dc7df9f830de78342/0b533/figure1.png 500w,\n/static/20995544b708e15dc7df9f830de78342/00d43/figure1.png 1000w,\n/static/20995544b708e15dc7df9f830de78342/8698d/figure1.png 1239w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"date":"April 07, 2022","slug":"/notes/Complex-ggplot2:-Barplot","title":"Complex ggplot2: Barplot","tags":["visualisation","ggplot2"],"abstract":"ggplot2 is nice, but can be quite complex...Here are some nice ggplot2 barplots I have drawn."}}},"pageContext":{"slug":"/notes/Complex-ggplot2:-Barplot"}},
    "staticQueryHashes": ["63159454"]}