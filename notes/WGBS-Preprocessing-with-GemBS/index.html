<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.625 -apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}h1{margin-left:0;margin-right:0;margin-top:2.4375rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.21875rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h2{margin-left:0;margin-right:0;margin-top:1.625rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.40625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:hsla(0,0%,0%,0.53);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}ul{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:0.85rem;line-height:1.625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:1rem;line-height:1.625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:calc(0.8125rem - 1px);padding-right:0;padding-top:0;margin-bottom:0.8125rem;border-left:4px solid hsla(0,0%,0%,0.13);color:hsla(0,0%,0%,0.53);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(0.8125rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}b{font-weight:600;}strong{font-weight:600;}dt{font-weight:600;}th{font-weight:600;}li{margin-bottom:calc(0.8125rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}li > ul{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(0.8125rem / 2);}code{font-size:0.85rem;line-height:1.625rem;}kbd{font-size:0.85rem;line-height:1.625rem;}samp{font-size:0.85rem;line-height:1.625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.08333rem;padding-right:1.08333rem;padding-top:0.8125rem;padding-bottom:calc(0.8125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h3,h4,h5,h6{margin-bottom:0.8125rem;margin-top:1.625rem;}ol,ul{margin-left:2.03125rem;}li>ol,li>ul{margin-left:2.03125rem;}a{color:#4078c0;text-decoration:none;}a:hover,a:active{text-decoration:underline;}h1,h2,h3,h4,h5,h6{color:hsla(0,0%,0%,0.9);margin-top:0.8em;margin-bottom:0.8em;line-height:1.3;}</style><style data-href="/styles.89d563c7e2790e8b28b1.css">html{background-color:#fff;font-family:Helvetica}::selection{background:rgba(254,217,10,.7)}code[class*=language-],pre[class*=language-]{color:#fff;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:.95em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;border-radius:4px;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-text]{color:"red"}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:2em,0,2em,0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272c34}:not(pre)>code[class*=language-]{padding:0 .1em;border-radius:.1em;white-space:normal;background:#eee;color:red;font-size:.85em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.10"/><style id="jss-server-side">.jss11{margin-top:8px;margin-bottom:8px}.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.167;letter-spacing:-.01562em}.MuiTypography-h2{font-size:3.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.2;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.167;letter-spacing:0}.MuiTypography-h4{font-size:2.125rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.235;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.5rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.334;letter-spacing:0}.MuiTypography-h6{font-size:1.25rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#3f51b5}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}.MuiContainer-root{width:100%;display:block;box-sizing:border-box;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiContainer-root{padding-left:24px;padding-right:24px}}.MuiContainer-disableGutters{padding-left:0;padding-right:0}@media (min-width:600px){.MuiContainer-fixed{max-width:600px}}@media (min-width:960px){.MuiContainer-fixed{max-width:960px}}@media (min-width:1280px){.MuiContainer-fixed{max-width:1280px}}@media (min-width:1920px){.MuiContainer-fixed{max-width:1920px}}@media (min-width:0px){.MuiContainer-maxWidthXs{max-width:444px}}@media (min-width:600px){.MuiContainer-maxWidthSm{max-width:600px}}@media (min-width:960px){.MuiContainer-maxWidthMd{max-width:960px}}@media (min-width:1280px){.MuiContainer-maxWidthLg{max-width:1280px}}@media (min-width:1920px){.MuiContainer-maxWidthXl{max-width:1920px}}.MuiToolbar-root{display:flex;position:relative;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}.jss2{margin-left:auto}.jss3{color:#000;font-weight:700;text-decoration:none}.jss3:hover{color:#000;text-decoration:none}.jss4{color:#000;cursor:pointer;font-weight:900}.jss5{display:flex}.jss5>*{margin:8px}.jss6{cursor:pointer;padding-right:24px}.jss7{width:50px;height:50px;margin-top:1em;border-radius:25px}.jss8{width:60px;height:60px;border-radius:30px}.jss9{right:2em;width:5em;bottom:-2em;height:5em;padding:.2em;position:absolute}.jss10{height:0;display:flex;align-items:center;justify-content:center;background-color:rgba(245,245,245,0)}</style><title data-react-helmet="true"></title><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-b8c437ecf4ac32ba13ed.js"/><link as="script" rel="preload" href="/framework-8dcecaaefd71e2213eb2.js"/><link as="script" rel="preload" href="/styles-fa79fef4936efa84b233.js"/><link as="script" rel="preload" href="/app-38bdaf9a6a585992bb62.js"/><link as="script" rel="preload" href="/commons-cfae17e808a6b60fd79c.js"/><link as="script" rel="preload" href="/component---src-templates-note-template-js-02811cc91cc3855c3024.js"/><link as="fetch" rel="preload" href="/page-data/notes/WGBS-Preprocessing-with-GemBS/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="blog-post-container"><div class="MuiContainer-root MuiContainer-maxWidthLg"><div class="MuiBox-root jss11"><div class="MuiToolbar-root MuiToolbar-regular jss1 MuiToolbar-gutters"><div class="jss5"><a class="jss3" href="/">Tian</a></div><div class="jss2"></div></div></div><div class="MuiContainer-root MuiContainer-maxWidthMd"><main><p style="margin-top:1em;font-weight:100">September 07, 2020</p><h1 style="font-size:2.5em;font-weight:700">WGBS Preprocessing with GemBS</h1><div class="blog-post-content"><p>Recently I need to work on some WGBS (whole genome bisulfite sequencing) data, more specificly this one <a href="https://trace.ddbj.nig.ac.jp/DRASearch/study?acc=SRP020633">SRP020633</a>. It's an old data set (2013), which used Illumina Genome Analyzer IIx machine to generate WGBS data. Previously I have experience on Illumina Human Methylation Array, MeDIP-seq, RRBS, and now finally it's my time to try WGBS. If I can crack this one, I will then have experience on all 4 format of data. In nowadays, for every data, there are many many parameters need to be tuned. So "having experience" does not mean I am capable to deal with all these data's related problem confidently, but it's a good start to go through their pipelines, get some general results, and collect some scripts and code for them</p>
<p>It's my first time to deal with Whole WGBS data. Merely I want to at least couple things from my WGBS data.</p>
<ul>
<li>One is the beta value for each CpGs sites (and their location)</li>
<li>Differential CpG Sites between two status, in this case the Stem Cell and Differentialed Cell.</li>
<li>Differential Methylated Regions</li>
</ul>
<h2>1. Software Installation</h2>
<p>After chating with lab members,  I decide to start with gemBS software, it' s python based software, requires you to input data, and relies on your compiled configuration to work. Firstly I need to install is based on it's <a href="http://statgen.cnag.cat/gemBS/UserGuide/_build/html/installation.html">instruction</a>. Since I always have Python version 3.7 installed, I can directly install the Python Library it requires.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">pip install matplotlib multiprocess</code></pre></div>
<p>Then in my personal software folder, I install the software:</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">git clone <span class="token operator">-</span><span class="token operator">-</span>recursive https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github.com<span class="token operator">/</span>heathsc<span class="token operator">/</span>gemBS.git
cd gemBS<span class="token operator">/</span>
python3 setup.py install <span class="token operator">-</span><span class="token operator">-</span>user</code></pre></div>
<h2>2. Perpare Data and Configuration</h2>
<p>After installation, I need to prepare data (fastq files) and configurations for this for this software. In my case, my <strong>base analysis folder</strong> is <code class="language-text">..../BS_Analysis</code> . The base means where I am going to run the software, this parameter will be used in configuration later. </p>
<h3>2.1. Fastq Files (Zipped)</h3>
<p>Then firstly I created a folder called BSin this folder, with all downloaded fastq file insides. Like below. We can see roughly one WGBS file size is 10+ GB before unzip. Note that trhe compress method here is <code class="language-text">bunzip2</code>, it's a quite good compress algorithm, could compress large files into much smaller size.</p>
<p>Importantly, <strong>GemBS could deal with .bz2 compressed fastq, so there is no need to unzip them</strong>. I tried once that the unfolder them, the size for one fastq file is 80+GB.</p>
<p>Note that in below code blox, the DownloadFastQ.R script and .xlsx files are not needed, they are just my personal helper scripts. So in short, we just need to put all fastq files (or their zipped files) in one folder in base directory.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> regmtyu<span class="token operator">@</span>SLMSICANBECK01<span class="token operator">:</span><span class="token operator">/</span>Data<span class="token operator">/</span>Tian<span class="token operator">/</span>Postdoc<span class="token operator">/</span>Mouse<span class="token operator">-</span>Intentinal<span class="token operator">-</span>Development<span class="token operator">/</span>BS_Analysis<span class="token operator">/</span>BS<span class="token operator">$</span> ls <span class="token operator">-</span>lha
total <span class="token number">154</span>G
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x.  <span class="token number">2</span> regmtyu domain users <span class="token number">4.0</span>K Aug <span class="token number">27</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">50</span> .
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x. <span class="token number">10</span> regmtyu domain users <span class="token number">4.0</span>K Aug <span class="token number">29</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">15</span> ..
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users <span class="token number">1.7</span>K Aug <span class="token number">27</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">55</span> DownloadFastQ.R
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users <span class="token number">8.8</span>K Aug <span class="token number">11</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">02</span> SRP020633.xlsx
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">17</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">50</span> SRR822931_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">17</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">57</span> SRR822931_2.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">14</span>G Aug <span class="token number">27</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">21</span> SRR822934_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">14</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">49</span> SRR822934_2.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">13</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">28</span> SRR823439_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">13</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">47</span> SRR823439_2.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">14</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">34</span> SRR823515_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">14</span>G Aug <span class="token number">27</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">06</span> SRR823515_2.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users <span class="token number">9.3</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">39</span> SRR823531_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users <span class="token number">5.7</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">25</span> SRR823531_2.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users  <span class="token number">16</span>G Aug <span class="token number">27</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">24</span> SRR823536_1.fastq.bz2
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>.  <span class="token number">1</span> regmtyu domain users <span class="token number">9.5</span>G Aug <span class="token number">27</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">38</span> SRR823536_2.fastq.bz2 </code></pre></div>
<h3>2.2. Sample Metadata CSV</h3>
<p>Then I need to prepare other two files. One is <a href="http://statgen.cnag.cat/GEMBS/UserGuide/_build/html/pipelineConfig.html#sample-metadata-file">sample metadata file</a>, the other is a <a href="http://statgen.cnag.cat/GEMBS/UserGuide/_build/html/pipelineConfig.html#pipeline-configuration-file">configuration file</a> for GemBS software. The sample metadata is a csv file, which included sample information, tell software how to match each sample to their corresponding fastq file.</p>
<p>Note that:</p>
<ol>
<li>The last column indicates sample phenotypes, that they are Stem_Cell, or thet are Villus.</li>
<li>This is only for paired sample.</li>
</ol>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># SampleSheet.csv in base BS_Analysis folder</span>
Barcode<span class="token punctuation">,</span>file_id<span class="token punctuation">,</span>end_1<span class="token punctuation">,</span>end_2<span class="token punctuation">,</span>name
SRR822931<span class="token punctuation">,</span>SRR822931<span class="token punctuation">,</span>SRR822931_1.fastq.bz2<span class="token punctuation">,</span>SRR822931_2.fastq.bz2<span class="token punctuation">,</span>Stem_Cell_GFP_High
SRR822934<span class="token punctuation">,</span>SRR822934<span class="token punctuation">,</span>SRR822934_1.fastq.bz2<span class="token punctuation">,</span>SRR822934_2.fastq.bz2<span class="token punctuation">,</span>Stem_Cell_GFP_High
SRR823439<span class="token punctuation">,</span>SRR823439<span class="token punctuation">,</span>SRR823439_1.fastq.bz2<span class="token punctuation">,</span>SRR823439_2.fastq.bz2<span class="token punctuation">,</span>Stem_Cell_GFP_Low
SRR823515<span class="token punctuation">,</span>SRR823515<span class="token punctuation">,</span>SRR823515_1.fastq.bz2<span class="token punctuation">,</span>SRR823515_2.fastq.bz2<span class="token punctuation">,</span>Stem_Cell_GFP_Low
SRR823531<span class="token punctuation">,</span>SRR823531<span class="token punctuation">,</span>SRR823531_1.fastq.bz2<span class="token punctuation">,</span>SRR823531_2.fastq.bz2<span class="token punctuation">,</span>Villus
SRR823536<span class="token punctuation">,</span>SRR823536<span class="token punctuation">,</span>SRR823536_1.fastq.bz2<span class="token punctuation">,</span>SRR823536_2.fastq.bz2<span class="token punctuation">,</span>Villus</code></pre></div>
<h3>2.3. Configureation File</h3>
<p>In short, configuration file is used to instruct the soft, setting parameters. etc. Configuration file need to be created by me, for example use vim to create a file named <code class="language-text">myBS.conf</code> in the base directory.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># Required section</span>
<span class="token comment">#</span>
<span class="token comment"># Note that the index and contig_sizes files are generated from the</span>
<span class="token comment"># reference file if they do not already exist</span>
<span class="token comment">#</span>
reference <span class="token operator">=</span> .<span class="token operator">/</span>reference<span class="token operator">/</span>Mus_musculus.GRCm38.dna.primary_assembly.fa.gz
index_dir <span class="token operator">=</span> indexes

<span class="token comment"># Directory definitions</span>
<span class="token comment">#</span>
<span class="token comment"># Note that we can use environment variables ($HOME in this case)</span>
<span class="token comment"># and previously defined variables can be used in subsequent definitions</span>

base <span class="token operator">=</span> .

sequence_dir <span class="token operator">=</span> <span class="token operator">$</span><span class="token punctuation">{</span>base<span class="token punctuation">}</span><span class="token operator">/</span>BS    <span class="token comment"># @SAMPLE and @BARCODE are special</span>
bam_dir <span class="token operator">=</span> <span class="token operator">$</span><span class="token punctuation">{</span>base<span class="token punctuation">}</span><span class="token operator">/</span>mapping<span class="token operator">/</span><span class="token operator">@</span>BARCODE      <span class="token comment"># variables that are replaced with</span>
bcf_dir <span class="token operator">=</span> <span class="token operator">$</span><span class="token punctuation">{</span>base<span class="token punctuation">}</span><span class="token operator">/</span>calls<span class="token operator">/</span><span class="token operator">@</span>BARCODE        <span class="token comment"># the sample name or barcode being</span>
extract_dir <span class="token operator">=</span> <span class="token operator">$</span><span class="token punctuation">{</span>base<span class="token punctuation">}</span><span class="token operator">/</span>extract<span class="token operator">/</span><span class="token operator">@</span>BARCODE  <span class="token comment"># worked on during gemBS operation</span>
report_dir <span class="token operator">=</span> <span class="token operator">$</span><span class="token punctuation">{</span>base<span class="token punctuation">}</span><span class="token operator">/</span>report

<span class="token comment"># General project info</span>
project <span class="token operator">=</span> Mouse_Intestinal
species <span class="token operator">=</span> Mouse

<span class="token comment"># Default parameters</span>
threads <span class="token operator">=</span> <span class="token number">30</span>
jobs <span class="token operator">=</span> <span class="token number">4</span>

<span class="token punctuation">[</span>mapping<span class="token punctuation">]</span> <span class="token comment"># Begin mapping specific section</span>

<span class="token comment"># Include a standard configuration file with parameters</span>
<span class="token comment"># defined for the IHEC WGBS pipeline</span>
include IHEC_standard.conf

<span class="token punctuation">[</span>extract<span class="token punctuation">]</span> <span class="token comment"># extract specific section</span>

make_cpg <span class="token operator">=</span> True
make_non_cpg <span class="token operator">=</span> True
make_bedmethyl <span class="token operator">=</span> True
make_bigwig <span class="token operator">=</span> True</code></pre></div>
<p>Basically these parameters are self-explainary, note that the <code class="language-text">base</code> parameter <code class="language-text">.</code> means current folder. The sequence_dir may be different for various projects, because in my project, all fastq.bz2 files are located in the same directory, other projects may have their code splitted in different folders.</p>
<p>I did not quite figure out the difference between threads and jobs for now, but I am using a super good server, so 30 thread is not a problem for me. In the mapping stage, the default parameter is to included <code class="language-text">IHEC_standard.conf</code> file. According to the instruction, the point is to <strong><em>make it simpler to use the correct parameter settings</em></strong>, so I included it. Actually, there are not too many parameters needs to be tuned.</p>
<h3>2.4. Reference Genome</h3>
<p>Finally, I need to prepare the reference genome to be mapped. Here I downloaded the mouse genome from <a href="ftp://ftp.ensembl.org/pub/">ensembl official website</a>. In my case, I downloaded the the mouse genome from <a href="ftp://ftp.ensembl.org/pub/release-101/fasta/mus_musculus/dna/">this link</a>. I created a folder called reference in base folder to only put this fastq file in.</p>
<p>That's all, above 4 files are needs to be prepared.</p>
<h2>3. GemBS Pipeline</h2>
<p>After installation, now it's time to run GemBS. <strong>Note that all below commands needs to be run in the base folder.</strong></p>
<h3>3.1. Prepare, Index, Alignment</h3>
<p>These 3 steps are basically one line command job, there are not much parameter needs to be tuned.  First command is gemBS prepare, It's merely for check the files you provided, make sure they are in accord with the requirement of the software.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">gemBS prepare <span class="token operator">-</span>c myBS.conf <span class="token operator">-</span>t SampleSheet.csv</code></pre></div>
<p>Then if everything is correct, below command could be used to create index of the reference genome I provided. Below command would generate a folder called <code class="language-text">indexes</code> in the base folder, with files with wired postfix like .gem, .ref, ref.fai .etc. I don't think I need to care about them.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">gemBS index</code></pre></div>
<p>If you encounter a libcudart.so.7.5 error. After searching online, I can add below two code in <code class="language-text">~/.bashrc</code> to solve this issue.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">export LD_LIBRARY_PATH<span class="token operator">=</span><span class="token string">"$LD_LIBRARY_PATH:/usr/local/cuda/lib64"</span>
export CUDA_HOME<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>cuda</code></pre></div>
<p>Seems these command are meant to employ GPU computing, but my server does not corresponding GPU... Then it works! Amazing! It would take maybe half an hour to prepare the index genome.</p>
<p>It above index step is finished, below command would be used to do alignment. The alignment algorithm is GEM3.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">gemBS map</code></pre></div>
<p>Below is some output of mapping, so apparently it run alignment for samples one by one. If I open 30 thread, it would take about 3 hour to finish one sample. I have 6 samples in total.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token operator">:</span> Command map started at <span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">44.743762</span>
<span class="token operator">:</span>
<span class="token operator">:</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> Mapping Parameters <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">:</span> Sample barcode    <span class="token operator">:</span> SRR823536
<span class="token operator">:</span> Data set          <span class="token operator">:</span> SRR823536
<span class="token operator">:</span> No. threads       <span class="token operator">:</span> <span class="token number">30</span>
<span class="token operator">:</span> Index             <span class="token operator">:</span> indexes<span class="token operator">/</span>Mus_musculus.GRCm38.dna.primary_assembly.BS.gem
<span class="token operator">:</span> Paired            <span class="token operator">:</span> True
<span class="token operator">:</span> Read non stranded <span class="token operator">:</span> False
<span class="token operator">:</span> Reverse conversion<span class="token operator">:</span> None
<span class="token operator">:</span> Type              <span class="token operator">:</span> PAIRED
<span class="token operator">:</span> Input Files       <span class="token operator">:</span> .<span class="token operator">/</span>BS<span class="token operator">/</span>SRR823536_1.fastq.bz2<span class="token punctuation">,</span>.<span class="token operator">/</span>BS<span class="token operator">/</span>SRR823536_2.fastq.bz2
<span class="token operator">:</span> Output dir        <span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823536
<span class="token operator">:</span>
<span class="token operator">:</span> Bisulfite Mapping<span class="token ellipsis">...</span>
<span class="token operator">:</span> Bisulfite Mapping done. Output File<span class="token operator">:</span> <span class="token operator">/</span>mnt<span class="token operator">/</span><span class="token number">254</span>b78b9<span class="token operator">-</span><span class="token number">76</span>b4<span class="token operator">-</span><span class="token number">422</span>d<span class="token operator">-</span><span class="token number">84</span>b1<span class="token operator">-</span>cc632bff60f7<span class="token operator">/</span>Tian<span class="token operator">/</span>Postdoc<span class="token operator">/</span>Mouse<span class="token operator">-</span>Intentinal<span class="token operator">-</span>Development<span class="token operator">/</span>BS_Analysis<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823536<span class="token operator">/</span>SRR823536.bam
<span class="token operator">:</span> Merging process done <span class="token keyword">for</span> SRR823536. Output files generated<span class="token operator">:</span> <span class="token operator">/</span>mnt<span class="token operator">/</span><span class="token number">254</span>b78b9<span class="token operator">-</span><span class="token number">76</span>b4<span class="token operator">-</span><span class="token number">422</span>d<span class="token operator">-</span><span class="token number">84</span>b1<span class="token operator">-</span>cc632bff60f7<span class="token operator">/</span>Tian<span class="token operator">/</span>Postdoc<span class="token operator">/</span>Mouse<span class="token operator">-</span>Intentinal<span class="token operator">-</span>Development<span class="token operator">/</span>BS_Analysis<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823536<span class="token operator">/</span>SR
R823536.csi</code></pre></div>
<p>The mapping results would be put in a folder called <code class="language-text">mapping</code>, with each sample in one folder inside. In each folder, I can see the bam file, which is quite large (41 GB).</p>
<h3>3.2. Methylation Calling and Extract</h3>
<p>Now this is the important step, to do methylation calling. As I said before, one key point to do methylation (and possibly all biology research) is to get the matrix, as it's important to do typical downstream analysis like PCA, Deconvolution, Mapping .etc.</p>
<p>The methylation calling step employ <code class="language-text">bas_call</code> to do methylation calling.  After calling, a large BCF file (binary version of VCF file) would be generated for each sample.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token operator">$</span> gemBS call
<span class="token operator">:</span>
<span class="token operator">:</span> Command call started at <span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">46.298953</span>
<span class="token operator">:</span>
<span class="token operator">:</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> Methylation Calling <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">:</span> Reference       <span class="token operator">:</span> indexes<span class="token operator">/</span>Mus_musculus.GRCm38.dna.primary_assembly.gemBS.ref
<span class="token operator">:</span> Species         <span class="token operator">:</span> Mouse
<span class="token operator">:</span> Right Trim      <span class="token operator">:</span> <span class="token number">0</span>
<span class="token operator">:</span> Left Trim       <span class="token operator">:</span> <span class="token number">5</span>
<span class="token operator">:</span> Chromosomes     <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'14'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">,</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token string">'15'</span><span class="token punctuation">,</span> <span class="token string">'16'</span><span class="token punctuation">,</span> <span class="token string">'17'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">,</span> <span class="token string">'19'</span><span class="token punctuation">,</span> <span class="token string">'@pool_1'</span><span class="token punctuation">]</span>
<span class="token operator">:</span> Threads         <span class="token operator">:</span> <span class="token number">30</span>
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR822931    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR822931<span class="token operator">/</span>SRR822931.bam
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR822934    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR822934<span class="token operator">/</span>SRR822934.bam
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR823439    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823439<span class="token operator">/</span>SRR823439.bam
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR823515    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823515<span class="token operator">/</span>SRR823515.bam
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR823531    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823531<span class="token operator">/</span>SRR823531.bam
<span class="token operator">:</span> Sample<span class="token operator">:</span> SRR823536    Bam<span class="token operator">:</span> .<span class="token operator">/</span>mapping<span class="token operator">/</span>SRR823536<span class="token operator">/</span>SRR823536.bam
<span class="token operator">:</span>
<span class="token operator">:</span> Methylation Calling<span class="token ellipsis">...</span>
<span class="token operator">:</span> Methylation call done<span class="token punctuation">,</span> samples performed<span class="token operator">:</span> SRR822931 SRR822934 SRR823439 SRR823515 SRR823531 SRR823536</code></pre></div>
<p>In below code block, I use bcftool to check the status of these bcf files. BCF file is a standard format of file to record variant information. So it's maybe a bit hard to understand. That's why they provided one more function <code class="language-text">extract</code>to get readable results. </p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">BS_Analysis<span class="token operator">/</span>calls<span class="token operator">$</span> ls
SRR822931  SRR822934  SRR823439  SRR823515  SRR823531  SRR823536
<span class="token punctuation">(</span>BS_Analysis<span class="token operator">/</span>calls<span class="token operator">$</span> cd SRR822931
BS_Analysis<span class="token operator">/</span>calls<span class="token operator">/</span>SRR822931<span class="token operator">$</span> ls <span class="token operator">*</span>.bcf <span class="token operator">-</span>lha
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>. <span class="token number">1</span> regmtyu domain users <span class="token number">17</span>G Aug <span class="token number">29</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">33</span> SRR822931.bcf
BS_Analysis<span class="token operator">/</span>calls<span class="token operator">/</span>SRR822931<span class="token operator">$</span> bcftools view SRR822931.bcf <span class="token operator">|</span> head <span class="token operator">-</span>n <span class="token number">20</span>
<span class="token ellipsis">...</span>
<span class="token ellipsis">...</span> <span class="token comment"># skipped some head meta data</span>
<span class="token comment">##FORMAT=&lt;ID=FS,Number=1,Type=Integer,Description="Phred scaled log p-value from Fishers exact test of strand bias"></span>
<span class="token comment">##bcftools_viewVersion=1.9+htslib-1.9</span>
<span class="token comment">##bcftools_viewCommand=view SRR822931.bcf; Date=Thu Sep  3 00:10:43 2020</span>
<span class="token comment">#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	SRR822931</span>
<span class="token number">1</span>	<span class="token number">3000156</span>	.	C	.	<span class="token number">1</span>	fail	CX<span class="token operator">=</span>TTCTT	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.545794</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">+</span><span class="token operator">:</span>N<span class="token operator">:</span>NNCTT
<span class="token number">1</span>	<span class="token number">3000161</span>	.	G	.	<span class="token number">2</span>	fail	CX<span class="token operator">=</span>TAGGG	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.327373</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">-</span><span class="token operator">:</span>N<span class="token operator">:</span>TAGGG
<span class="token number">1</span>	<span class="token number">3000162</span>	.	G	.	<span class="token number">2</span>	fail	CX<span class="token operator">=</span>AGGGG	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.327373</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">-</span><span class="token operator">:</span>N<span class="token operator">:</span>AGGGG
<span class="token number">1</span>	<span class="token number">3000163</span>	.	G	.	<span class="token number">2</span>	fail	CX<span class="token operator">=</span>GGGGA	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.327373</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">-</span><span class="token operator">:</span>N<span class="token operator">:</span>GGGGA
<span class="token number">1</span>	<span class="token number">3000164</span>	.	G	.	<span class="token number">2</span>	fail	CX<span class="token operator">=</span>GGGAA	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.327373</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">-</span><span class="token operator">:</span>N<span class="token operator">:</span>GGGAA
<span class="token number">1</span>	<span class="token number">3000169</span>	.	G	.	<span class="token number">2</span>	fail	CX<span class="token operator">=</span>ATGGG	GT<span class="token operator">:</span>FT<span class="token operator">:</span>DP<span class="token operator">:</span>MQ<span class="token operator">:</span>GQ<span class="token operator">:</span>QD<span class="token operator">:</span>GL<span class="token operator">:</span>MC8<span class="token operator">:</span>AMQ<span class="token operator">:</span>CS<span class="token operator">:</span>CG<span class="token operator">:</span>CX	<span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span>q20<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">0.327373</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token operator">-</span><span class="token operator">:</span>N<span class="token operator">:</span>ATGGG</code></pre></div>
<p>Then I run <code class="language-text">gemBS extract</code> just couple seconds all files are generated in <code class="language-text">extract</code> folder. In them I think the most important file is <code class="language-text">_cpg.txt.gz</code> . I can use zcat to check it, now it looks much readable. <strong>The 7th column is exactly the beta value I am looking for! Finally!!</strong></p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">BS_Analysis<span class="token operator">/</span>extract<span class="token operator">/</span>SRR822931<span class="token operator">$</span> zcat SRR822931_cpg.txt.gz <span class="token operator">|</span> head
Contig	Pos0	Pos1	Ref	SRR822931<span class="token operator">:</span>Call	SRR822931<span class="token operator">:</span>Flags	SRR822931<span class="token operator">:</span>Meth	SRR822931<span class="token operator">:</span>non_conv	SRR822931<span class="token operator">:</span>conv	SRR822931<span class="token operator">:</span>support_call	SRR822931<span class="token operator">:</span>total
<span class="token number">1</span>	<span class="token number">3000828</span>	<span class="token number">3000829</span>	G	G	GQ<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">60</span>	<span class="token number">1.000</span>	<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">9</span>	<span class="token number">9</span>
<span class="token number">1</span>	<span class="token number">3001008</span>	<span class="token number">3001009</span>	G	G	GQ<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">59</span>	<span class="token number">1.000</span>	<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">12</span>	<span class="token number">12</span>
<span class="token number">1</span>	<span class="token number">3001019</span>	<span class="token number">3001020</span>	G	G	GQ<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">59</span>	<span class="token number">1.000</span>	<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">11</span>	<span class="token number">11</span>
<span class="token number">1</span>	<span class="token number">3003886</span>	<span class="token number">3003887</span>	G	G	GQ<span class="token operator">=</span><span class="token number">17</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">60</span>	<span class="token number">1.000</span>	<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token number">7</span>
<span class="token number">1</span>	<span class="token number">3003899</span>	<span class="token number">3003900</span>	G	G	GQ<span class="token operator">=</span><span class="token number">17</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">60</span>	<span class="token number">1.000</span>	<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token number">7</span>
<span class="token number">1</span>	<span class="token number">3004531</span>	<span class="token number">3004532</span>	G	G	GQ<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">60</span>	<span class="token number">0.521</span>	<span class="token number">1</span>	<span class="token number">1</span>	<span class="token number">6</span>	<span class="token number">6</span>
<span class="token number">1</span>	<span class="token number">3006188</span>	<span class="token number">3006189</span>	G	G	GQ<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">53</span>	<span class="token number">1.000</span>	<span class="token number">9</span>	<span class="token number">0</span>	<span class="token number">11</span>	<span class="token number">11</span>
<span class="token number">1</span>	<span class="token number">3006882</span>	<span class="token number">3006883</span>	G	G	GQ<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">52</span>	<span class="token number">0.841</span>	<span class="token number">4</span>	<span class="token number">1</span>	<span class="token number">8</span>	<span class="token number">8</span>
<span class="token number">1</span>	<span class="token number">3007431</span>	<span class="token number">3007432</span>	G	G	GQ<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>MQ<span class="token operator">=</span><span class="token number">58</span>	<span class="token number">0.840</span>	<span class="token number">4</span>	<span class="token number">1</span>	<span class="token number">10</span>	<span class="token number">10</span></code></pre></div>
<h3>3.3. Generate Report</h3>
<p>Finally, by simply run <code class="language-text">gemBS map-report</code> and <code class="language-text">gemBS call-report</code>, the software would automatically generate report for mapping and variant calling. The two reports are html based, could be easily see via browser.Below is the screenshort for Variant Report, it indicates that the read depth is roughtly 6X, seems now my collegues' data quality are 100X?</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5e300298180beac026482ddb0f0932e4/29114/figure1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA2klEQVQY00VQ63aDIBjz/V9xO93WdXVeQC5alVsaPu32Iych4YNAY33A5HZUrjDuYL9EXFuP96vF25fF5dtB213y1x5zztT5mfu3PaFp+x2/AzEGtORBJyibRff01JQw2QI7Q7JORSiT0ZNHcvU+flZcbg+4OaPRNvLGJJhsolnYDqIF7t+zPgvmx6H9UiS79xtu3YZl5YG1XccmAup6u3Hlbz3oyKfS88DIthUvrdlcmYTP+yot/cID1y3x7fkA9R4KYiwQ/8wC1zGBWRbESH36IdTvOP6zzj0Bi+6BZ/NDruwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Call Report Sceenshot from GemBS"
        title="Call Report Sceenshot from GemBS"
        src="/static/5e300298180beac026482ddb0f0932e4/5a190/figure1.png"
        srcset="/static/5e300298180beac026482ddb0f0932e4/772e8/figure1.png 200w,
/static/5e300298180beac026482ddb0f0932e4/e17e5/figure1.png 400w,
/static/5e300298180beac026482ddb0f0932e4/5a190/figure1.png 800w,
/static/5e300298180beac026482ddb0f0932e4/c1b63/figure1.png 1200w,
/static/5e300298180beac026482ddb0f0932e4/29007/figure1.png 1600w,
/static/5e300298180beac026482ddb0f0932e4/29114/figure1.png 1920w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Above are all work I have done with the GemBS analysis, it is easy to use, however the final result is not that I expected, so I need to find a way to extract the methylation into a large matrix myself.</p></div></main></div><div style="padding-top:3em;padding-bottom:3em;text-align:center"><p class="MuiTypography-root MuiTypography-body2 MuiTypography-colorTextSecondary MuiTypography-alignCenter">Copyright  <!-- -->Yuan Tian<!-- --> <!-- -->2020<!-- -->.</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/notes/WGBS-Preprocessing-with-GemBS";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-38bdaf9a6a585992bb62.js"],"component---src-pages-404-js":["/component---src-pages-404-js-852bd3a5faea7629c57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-8eb3bf3910a1dae9d113.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-ef8c063115e3c48e159a.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ccc63956d1d6da3ec2a1.js"],"component---src-templates-note-template-js":["/component---src-templates-note-template-js-02811cc91cc3855c3024.js"]};/*]]>*/</script><script src="/component---src-templates-note-template-js-02811cc91cc3855c3024.js" async=""></script><script src="/commons-cfae17e808a6b60fd79c.js" async=""></script><script src="/app-38bdaf9a6a585992bb62.js" async=""></script><script src="/styles-fa79fef4936efa84b233.js" async=""></script><script src="/framework-8dcecaaefd71e2213eb2.js" async=""></script><script src="/webpack-runtime-b8c437ecf4ac32ba13ed.js" async=""></script></body></html>